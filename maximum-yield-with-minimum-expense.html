<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Maximum yield with minimum expense for a static website - LAB</title><meta name="description" content="Great marketing quote, however i think we can better share a value that is always true... keep it simple, keep it safe. I would structure this article in few relevant topics Each of the above could be a specific topic that will fit others use&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://www.k8s.it/maximum-yield-with-minimum-expense.html"><link rel="amphtml" href="https://www.k8s.it/amp/maximum-yield-with-minimum-expense.html"><link rel="alternate" type="application/atom+xml" href="https://www.k8s.it/feed.xml"><link rel="alternate" type="application/json" href="https://www.k8s.it/feed.json"><meta property="og:title" content="Maximum yield with minimum expense for a static website - LAB "><meta property="og:image" content="https://www.k8s.it/media/posts/18/Screenshot-2020-12-26-at-16.43.11.png"><meta property="og:image:width" content="1090"><meta property="og:image:height" content="750"><meta property="og:site_name" content="LAB"><meta property="og:description" content="Great marketing quote, however i think we can better share a value that is always true... keep it simple, keep it safe. I would structure this article in few relevant topics Each of the above could be a specific topic that will fit others use&hellip;"><meta property="og:url" content="https://www.k8s.it/maximum-yield-with-minimum-expense.html"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://www.k8s.it/media/website/eth0.ico" type="image/x-icon"><link rel="stylesheet" href="https://www.k8s.it/assets/css/style.css?v=b86f16152980d3ca60d9c2da73b4b225"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.k8s.it/maximum-yield-with-minimum-expense.html"},"headline":"Maximum yield with minimum expense for a static website","datePublished":"2020-12-24T20:53","dateModified":"2020-12-28T09:58","image":{"@type":"ImageObject","url":"https://www.k8s.it/media/posts/18/Screenshot-2020-12-26-at-16.43.11.png","height":750,"width":1090},"description":"Great marketing quote, however i think we can better share a value that is always true... keep it simple, keep it safe. I would structure this article in few relevant topics Each of the above could be a specific topic that will fit others use&hellip;","author":{"@type":"Person","name":"lgirardi","url":"https://www.k8s.it/authors/lgirardi/"},"publisher":{"@type":"Organization","name":"lgirardi"}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-179496482-1"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-179496482-1');</script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://www.k8s.it/">LAB</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://www.linkedin.com/in/lgirardi/">linkedin</a></li><li><a href="https://services.k8s.it/grafana/?orgId&#x3D;2">live monitoring</a></li><li><a href="https://www.k8s.it/whoami.html">whoami</a></li><li><a href="https://www.k8s.it/hobbies.html" target="_self">hobbies</a></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"><div class="search__overlay-inner"><form action="https://www.k8s.it/search.html" class="search__form"><input class="search__input" type="search" name="q" placeholder="search..." aria-label="search..."></form><button class="search__close js-search-close" aria-label="Close">Close</button></div></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false"><use xlink:href="https://www.k8s.it/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://www.k8s.it/media/posts/18/Screenshot-2020-12-26-at-16.43.11.png" srcset="https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-16.43.11-xs.webp 300w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-16.43.11-sm.webp 480w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-16.43.11-md.webp 768w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-16.43.11-lg.webp 1024w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-16.43.11-xl.webp 1360w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-16.43.11-2xl.webp 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="750" width="1090" alt=""></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2020-12-24T20:53">24 Dec 2020</time></div><h1>Maximum yield with minimum expense for a static website</h1></div></header></div><div class="wrapper post__entry"><p>Great marketing quote, however i think we can better share a value that is always true...<br><em><span style="text-decoration: underline;">keep it simple, keep it safe.</span></em></p><p>I would structure this article in few relevant topics</p><ul><li>Static website</li><li>Tools</li><li>Security</li><li>Monitor</li></ul><p>Each of the above could be a specific topic that will fit others use cases</p><p><em>This is not a post about how to create a blog... this post will inspect into some technology that can simplify your life or your work with small but important concepts</em></p><p> </p><h3>Static website</h3><p>Among the famous open cms i tried probably all of those,  during my career.<br>Basically are a web application with sql database in most of the cases.</p><p>Now we can discuss about the meaning of content generation , that should be dynamic and be part of the user experience rather than a page generated, however today i will talk just about the usage of a cms for a static(tbd) reality.</p><p>If your goal is promote your company, your hobbies, your work ... you have already heard about wordpress, joomla, drupal etc etc ... that are good (if not directly exposed) but had a huge problem... since are open and used by a relevant number of people, are subjected of vulnerability, moreover , if you install plugins the situation could be dramatic.</p><p>As much you install <strong>plugins</strong> (and really some cms are not able to do anything with a plugin),<br>as much your website is bloat.<br>With the same ratio the <span style="text-decoration: underline;">performances will decrease.</span></p><p>On top of this, a <span style="text-decoration: underline;">huge</span> percentage of the plugins in the cms repository are old and out of date yet still available to install on your system.</p><p>So if you don't need something special (most of the blogs are wordpress only because it's easy to use) and you want to create a static website for your company, your business and so on , you can probably evaluate something different looking for , the first pillar mentioned, keep it simple.<br>Moreover the trend in a enterprise is moving from dynamic content to static as per the <strong>speed</strong> is the major KPI for a website</p><p>On a secondary binary in the last years the static cms are growth</p><ul><li>Jekyll</li><li>Gatsby</li><li>Siteleaf</li><li>Netlify</li><li>Hugo</li><li>$whatever-js (every day we have a new js framework)</li><li>etc etc</li></ul><p>However if you are not so nerd ... or your are tremendously lazy (like me)<br>a grate alternative is <a href="https://getpublii.com/">Publii</a></p><p>Publii includes a WYSIWYG (What You See Is What You Get) editor for content creation,<br>really easy to use , and the client is available for multiple platform (win,linux,mac)</p><p> </p><p> </p><p> </p><h3>Tools</h3><p>I mentioned Publii before, this tool is just a simple way for lazy people to create a static website, i'll not go in deep with this software since is well explained in its website however offer multiple possibility where store the files , the main ones are s3 bucket and github pages.<br>Publii is not a pretty collaborative tool but is not supposed to have this kind of interaction on a static website, is more close to a human interaction only.<br><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">On the opposite side Jekyll and the other families are more close to be collaborative based on a git project and part of a pipeline flow (runner/actions)</span></p><p> </p><p>Based on the backend for you html files, lets explore the <a href="https://pages.github.com/">github pages</a><br>This service is free with few limits<br><em>Published GitHub Pages sites may be no larger than 1 GB.</em><br><em>GitHub Pages sites have a soft bandwidth limit of 100GB per month.</em><br><em>GitHub Pages sites have a soft limit of 10 builds per hour.</em></p><p>It's really easy to use and demand the security on the github account (always 2fa)<br>They offer a dns based on your github account and you can manage paths,<br>moreover you have the TLS/SSL for free</p><p>With Publii configuration is quite easy and you can follow the instruction <a href="https://getpublii.com/docs/host-static-website-github-pages.html">here</a> </p><p> </p><p>Another solution is use s3 as a repository, this require a bit more stuff sometimes, however even if it's a cheeper option, why not use an s3 on-prem if it's available <br>(this is just an excuse to use kubernetes, i still suggest to use the github pages, however i like to have this kind of exercise)</p><p>So welcome <a href="https://min.io/">minio</a> , a kubernetes object storage<br>The configuration is quite simple, as usual you can start with the namespace creation<br><code>kind: "Namespace"<br>apiVersion: "v1"<br>metadata:<br>  name: "minio"<br>  labels:<br>    name: "minio"</code></p><p>The service (this is just a single instance so no StatefulSets set is needed)<br><code>apiVersion: v1<br>kind: Service<br>metadata:<br>  name: minio-svc<br>  namespace: minio<br>  labels:<br>    app: minio<br>spec:<br>  ports:<br>  - port: 9000<br>    protocol: TCP<br>  selector:<br>    app: minio</code></p><p>PersistentVolumeClaim (from microk8s host provisioner)<br><code>apiVersion: v1<br>kind: PersistentVolumeClaim<br>metadata:<br>  namespace: minio<br>  name: minio-pv-claim<br>  labels:<br>    app: minio-storage-claim<br>spec:<br>  storageClassName: microk8s-hostpath<br>  accessModes:<br>    - ReadWriteOnce<br>  resources:<br>    requests:<br>      storage: 1Gi</code></p><p>Deployment (remember to use secrets instead write directly into deployment)<br><code>kind: Deployment<br>metadata:<br>  name: minio-deployment<br>  namespace: minio<br>spec:<br>  selector:<br>    matchLabels:<br>      app: minio<br>  strategy:<br>    type: Recreate<br>  template:<br>    metadata:<br>      labels:<br>        app: minio<br>    spec:<br>      volumes:<br>      - name: storage<br>        persistentVolumeClaim:<br>          claimName: minio-pv-claim<br>      containers:<br>      - name: minio<br>        image: minio/minio:latest<br>        args:<br>        - server<br>        - /storage<br>        env:<br>        - name: MINIO_ACCESS_KEY<br>          value: "$something"<br>        - name: MINIO_SECRET_KEY<br>          value: "$somethingsecret"<br>        - name: MINIO_DOMAIN<br>          value: minio.h4x0r3d.lan<br>        ports:<br>        - containerPort: 9000<br>          hostPort: 9000<br>        volumeMounts:<br>        - name: storage<br>          mountPath: "/storage"</code></p><p>Ingress resource<br><code>kind: Ingress<br>metadata:<br>  name: minio-ingress<br>  namespace: minio<br>  annotations:<br>    kubernetes.io/ingress.class: nginx<br>    nginx.org/client-max-body-size: 1000m<br>    ingress.kubernetes.io/proxy-body-size: 1000m<br>spec:<br>  rules:<br>  - host: minio.h4x0r3d.lan<br>    http:<br>      paths:<br>      - path: /<br>        backend:<br>          serviceName: minio-svc<br>          servicePort: 9000</code></p><p>And at the end you will have something like this</p><figure class="post__image post__image--center"><img loading="lazy" src="https://www.k8s.it/media/posts/18/Screenshot-2020-12-26-at-13.55.38.png" alt="" width="1024" height="678" sizes="100vw" srcset="https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.55.38-xs.webp 300w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.55.38-sm.webp 480w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.55.38-md.webp 768w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.55.38-lg.webp 1024w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.55.38-xl.webp 1360w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.55.38-2xl.webp 1600w"></figure><p>you can configure Publii in this way</p><p>where bucket is the third level name of you dns and prefix "the bucket"</p><figure class="post__image post__image--center"><img loading="lazy" src="https://www.k8s.it/media/posts/18/Screenshot-2020-12-26-at-13.56.43.png" alt="" width="1024" height="811" sizes="100vw" srcset="https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.56.43-xs.webp 300w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.56.43-sm.webp 480w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.56.43-md.webp 768w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.56.43-lg.webp 1024w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.56.43-xl.webp 1360w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.56.43-2xl.webp 1600w"></figure><p>Btw an object storage is <strong>NOT</strong> a web server so you need an apache or nginx configuration<br>to have the site ready to be used<br><code>&lt;VirtualHost *:80&gt;<br>    ServerAdmin l@k8s.it<br>    DocumentRoot /usr/local/apache2/htdocs/<br>    ServerName www.k8s.it<br>    ErrorLog logs/www.k8s-error_log<br>    CustomLog logs/www.k8s-access_log combined<br>    LoadModule rewrite_module modules/mod_rewrite.so<br>    ProxyRequests Off<br>    ProxyPass / http://minio-svc.minio.svc.cluster.local:9000/blog/<br>    RewriteEngine on<br>    RewriteRule ^(.*)/$ /$1/index.html [PT,L]<br> &lt;/VirtualHost&gt;</code></p><p> </p><p>Again ... <strong>keep it simple</strong>... there no right solutions overall , there is the right way for you needs, in my case i'm still using github pages because are free, enough to cover my needs and <em>serverless</em></p><h3> </h3><h3>Security</h3><p>Even if the security is demanded to github, why not extend a sort of protection on top of it</p><p>Second pillar , <strong>keep it safe</strong></p><p>In my case i really appreciate Cloudflare and the free plan that give me the possibility to test and explore the functionality offered</p><p>I've already shared how to configure a website with Cloudflare with terraform <a href="https://www.k8s.it/terraform-your-free-claudflare-account.html" target="_blank" rel="noopener noreferrer">https://www.k8s.it/terraform-your-free-claudflare-account.html</a></p><p>Even if we are covered by attacks since it's static webpage ... and we also added the Cloudflare protection we can have some <em>cosmetics</em> feature that will share a better compliance with the security in 2020</p><p>As i said github pages and s3 are not webserver so ...<br>how we can introduce the security headers ?</p><figure class="post__image post__image--center"><img loading="lazy" src="https://www.k8s.it/media/posts/18/screencapture-securityheaders-2020-12-24-20_33_23.png" alt="" width="1024" height="1758" sizes="100vw" srcset="https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_33_23-xs.webp 300w, https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_33_23-sm.webp 480w, https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_33_23-md.webp 768w, https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_33_23-lg.webp 1024w, https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_33_23-xl.webp 1360w, https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_33_23-2xl.webp 1600w"></figure><p> </p><p>Again Cloudflare help us with the <a href="https://blog.cloudflare.com/cloudflare-workers-unleashed/" target="_blank" rel="noopener noreferrer">Workers</a> feature</p><figure class="post__image post__image--center"><img loading="lazy" src="https://www.k8s.it/media/posts/18/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-edit-security-headers-2020-12-24-20_38_25-2.png" alt="" width="1024" height="516" sizes="100vw" srcset="https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-edit-security-headers-2020-12-24-20_38_25-2-xs.webp 300w, https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-edit-security-headers-2020-12-24-20_38_25-2-sm.webp 480w, https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-edit-security-headers-2020-12-24-20_38_25-2-md.webp 768w, https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-edit-security-headers-2020-12-24-20_38_25-2-lg.webp 1024w, https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-edit-security-headers-2020-12-24-20_38_25-2-xl.webp 1360w, https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-edit-security-headers-2020-12-24-20_38_25-2-2xl.webp 1600w"></figure><p>The code (<a href="https://scotthelme.co.uk/security-headers-cloudflare-worker/" target="_blank" rel="noopener noreferrer">rif</a>.) is adding those headers with serverless function  for each request</p><p><code>const securityHeaders = {<br>        "Content-Security-Policy": "upgrade-insecure-requests",<br>        "Strict-Transport-Security": "max-age=3600",<br>        "X-Xss-Protection": "1; mode=block",<br>        "X-Frame-Options": "DENY",<br>        "X-Content-Type-Options": "nosniff",<br>        "Permissions-Policy": "geolocation=()",<br>        "Referrer-Policy": "strict-origin-when-cross-origin"<br>    };<br><br><br>async function addHeaders(req) {<br>    const response = await fetch(req),<br>        newHeaders = new Headers(response.headers),<br>        setHeaders = Object.assign({}, securityHeaders);<br><br>    if (newHeaders.has("Content-Type") &amp;&amp; !newHeaders.get("Content-Type").includes("text/html")) {<br>        return new Response(response.body, {<br>            status: response.status,<br>            statusText: response.statusText,<br>            headers: newHeaders<br>        });<br>    }<br><br>    Object.keys(setHeaders).forEach(name =&gt; newHeaders.set(name, setHeaders[name]));<br><br><br>    return new Response(response.body, {<br>        status: response.status,<br>        statusText: response.statusText,<br>        headers: newHeaders<br>    });<br>}<br><br>addEventListener("fetch", event =&gt; event.respondWith(addHeaders(event.request)));</code></p><p> </p><p>Now the website is better from this point of view, adding the worker to the main route</p><figure class="post__image post__image--center"><img loading="lazy" src="https://www.k8s.it/media/posts/18/Screenshot-2020-12-27-at-13.41.47.png" alt="" width="1024" height="476" sizes="100vw" srcset="https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.41.47-xs.webp 300w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.41.47-sm.webp 480w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.41.47-md.webp 768w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.41.47-lg.webp 1024w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.41.47-xl.webp 1360w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.41.47-2xl.webp 1600w"></figure><p>Results</p><figure class="post__image post__image--center"><img loading="lazy" src="https://www.k8s.it/media/posts/18/screencapture-securityheaders-2020-12-24-20_34_27.png" alt="" width="1024" height="1959" sizes="100vw" srcset="https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_34_27-xs.webp 300w, https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_34_27-sm.webp 480w, https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_34_27-md.webp 768w, https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_34_27-lg.webp 1024w, https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_34_27-xl.webp 1360w, https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_34_27-2xl.webp 1600w"></figure><p>Just a warning because Strict-Transport-Security has a low value , but it's something acceptable to me</p><p>Cloudflare details the usage of workers that is limited in the free account for 100k req/day and 1k/min</p><figure class="post__image post__image--center"><img loading="lazy" src="https://www.k8s.it/media/posts/18/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-view-security-headers-2020-12-27-13_42_52.png" alt="" width="1024" height="1954" sizes="100vw" srcset="https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-view-security-headers-2020-12-27-13_42_52-xs.webp 300w, https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-view-security-headers-2020-12-27-13_42_52-sm.webp 480w, https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-view-security-headers-2020-12-27-13_42_52-md.webp 768w, https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-view-security-headers-2020-12-27-13_42_52-lg.webp 1024w, https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-view-security-headers-2020-12-27-13_42_52-xl.webp 1360w, https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-view-security-headers-2020-12-27-13_42_52-2xl.webp 1600w"></figure><p>OKR </p><ul><li>website is managed with no database</li><li>we have serverless way to host it and with free options</li><li>overall protection from Cloudflare</li><li>security headers from Cloudflare workers, again another serveless option</li></ul><p> </p><p><code></code><code></code><code></code></p><div><div><code></code><code></code></div></div><h3>Monitor</h3><p>What is missing now ?</p><p>A bit of <strong>awareness</strong></p><p>Are we safe ? maybe but better an external opinion , around the online scanner there are multiple tools , however <a href="https://probely.com/" target="_blank" rel="noopener noreferrer">Probely</a> has a good free plan</p><figure class="post__image post__image--center"><img loading="lazy" src="https://www.k8s.it/media/posts/18/Screenshot-2020-12-26-at-14.58.41.png" alt="" width="1024" height="434" sizes="100vw" srcset="https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-14.58.41-xs.webp 300w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-14.58.41-sm.webp 480w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-14.58.41-md.webp 768w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-14.58.41-lg.webp 1024w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-14.58.41-xl.webp 1360w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-14.58.41-2xl.webp 1600w"></figure><p>Here some hints about sensitive data shared with their crowler</p><figure class="post__image post__image--center"><img loading="lazy" src="https://www.k8s.it/media/posts/18/Screenshot-2020-12-26-at-15.00.00.png" alt="" width="1024" height="512" sizes="100vw" srcset="https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.00.00-xs.webp 300w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.00.00-sm.webp 480w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.00.00-md.webp 768w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.00.00-lg.webp 1024w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.00.00-xl.webp 1360w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.00.00-2xl.webp 1600w"></figure><p>Nothing relevant in my case... but useful to know</p><p> </p><p>Is now time to know , how is performing the website to do this i already had a deepdive about website usability</p><p><a href="https://www.k8s.it/kubernetes-sitespeedio.html" target="_blank" rel="noopener noreferrer">https://www.k8s.it/kubernetes-sitespeedio.html</a></p><p>but again we have some other feature serverless style like <a href="https://github.com/upptime/upptime" target="_blank" rel="noopener noreferrer">upptime</a> ,with github actions you can create a monitoring system like this <a href="https://lorenzogirardi.github.io/status/" target="_blank" rel="noopener noreferrer">https://lorenzogirardi.github.io/status/</a></p><figure class="post__image post__image--center"><img loading="lazy" src="https://www.k8s.it/media/posts/18/Screenshot-2020-12-26-at-15.04.18.png" alt="" width="1024" height="774" sizes="100vw" srcset="https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.04.18-xs.webp 300w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.04.18-sm.webp 480w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.04.18-md.webp 768w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.04.18-lg.webp 1024w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.04.18-xl.webp 1360w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.04.18-2xl.webp 1600w"></figure><figure class="post__image post__image--center"><img loading="lazy" src="https://www.k8s.it/media/posts/18/Screenshot-2020-12-27-at-13.36.35.png" alt="" width="1024" height="859" sizes="100vw" srcset="https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.36.35-xs.webp 300w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.36.35-sm.webp 480w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.36.35-md.webp 768w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.36.35-lg.webp 1024w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.36.35-xl.webp 1360w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.36.35-2xl.webp 1600w"></figure><p>Another alternative is <a href="https://hetrixtools.com/" target="_blank" rel="noopener noreferrer">hetrixtools</a> , free up top 15 probes that give you the possibility to monitor your websites and smtp, and have an alerting system out of the box with a telegram bot email and sms (up to 50)</p><figure class="post__image post__image--center"><img loading="lazy" src="https://www.k8s.it/media/posts/18/screencapture-hetrixtools-report-uptime-c7596615176a822f81d67cfddc4aa179-2020-12-26-15_14_22.png" alt="" width="1024" height="1620" sizes="100vw" srcset="https://www.k8s.it/media/posts/18/responsive/screencapture-hetrixtools-report-uptime-c7596615176a822f81d67cfddc4aa179-2020-12-26-15_14_22-xs.webp 300w, https://www.k8s.it/media/posts/18/responsive/screencapture-hetrixtools-report-uptime-c7596615176a822f81d67cfddc4aa179-2020-12-26-15_14_22-sm.webp 480w, https://www.k8s.it/media/posts/18/responsive/screencapture-hetrixtools-report-uptime-c7596615176a822f81d67cfddc4aa179-2020-12-26-15_14_22-md.webp 768w, https://www.k8s.it/media/posts/18/responsive/screencapture-hetrixtools-report-uptime-c7596615176a822f81d67cfddc4aa179-2020-12-26-15_14_22-lg.webp 1024w, https://www.k8s.it/media/posts/18/responsive/screencapture-hetrixtools-report-uptime-c7596615176a822f81d67cfddc4aa179-2020-12-26-15_14_22-xl.webp 1360w, https://www.k8s.it/media/posts/18/responsive/screencapture-hetrixtools-report-uptime-c7596615176a822f81d67cfddc4aa179-2020-12-26-15_14_22-2xl.webp 1600w"></figure><figure class="post__image post__image--center"><img loading="lazy" src="https://www.k8s.it/media/posts/18/Screenshot-2020-12-26-at-15.07.32.png" alt="" width="974" height="380" sizes="100vw" srcset="https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.07.32-xs.webp 300w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.07.32-sm.webp 480w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.07.32-md.webp 768w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.07.32-lg.webp 1024w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.07.32-xl.webp 1360w, https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.07.32-2xl.webp 1600w"></figure><p> </p><p> </p><p>Hope this post cover how the technology could be used as much as possible in a small and cheap scenario to reflect some hints to an enterprise scenario.</p><p> </p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on 28 Dec 2020</p><ul class="post__tag"><li><a href="https://www.k8s.it/cloudflare/">cloudflare</a></li><li><a href="https://www.k8s.it/cms/">cms</a></li><li><a href="https://www.k8s.it/headers/">headers</a></li><li><a href="https://www.k8s.it/kubernetes/">kubernetes</a></li><li><a href="https://www.k8s.it/minio/">minio</a></li><li><a href="https://www.k8s.it/publii/">publii</a></li><li><a href="https://www.k8s.it/security/">security</a></li><li><a href="https://www.k8s.it/serverless/">serverless</a></li><li><a href="https://www.k8s.it/static/">static</a></li><li><a href="https://www.k8s.it/static-cms/">static cms</a></li><li><a href="https://www.k8s.it/website/">website</a></li><li><a href="https://www.k8s.it/workers/">workers</a></li></ul><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.k8s.it%2Fmaximum-yield-with-minimum-expense.html" class="js-share facebook" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://www.k8s.it/assets/svg/svg-map.svg#facebook"/></svg> <span>Facebook</span> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fwww.k8s.it%2Fmaximum-yield-with-minimum-expense.html&amp;via=LAB&amp;text=Maximum%20yield%20with%20minimum%20expense%20for%20a%20static%20website" class="js-share twitter" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://www.k8s.it/assets/svg/svg-map.svg#twitter"/></svg> <span>Twitter</span> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.k8s.it%2Fmaximum-yield-with-minimum-expense.html" class="js-share linkedin" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://www.k8s.it/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span> </a><a href="https://buffer.com/add?text=Maximum%20yield%20with%20minimum%20expense%20for%20a%20static%20website&amp;url=https%3A%2F%2Fwww.k8s.it%2Fmaximum-yield-with-minimum-expense.html" class="js-share buffer" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://www.k8s.it/assets/svg/svg-map.svg#buffer"/></svg> <span>Buffer</span> </a><a href="https://api.whatsapp.com/send?text=Maximum%20yield%20with%20minimum%20expense%20for%20a%20static%20website https%3A%2F%2Fwww.k8s.it%2Fmaximum-yield-with-minimum-expense.html" class="js-share whatsapp" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://www.k8s.it/assets/svg/svg-map.svg#whatsapp"/></svg> <span>WhatsApp</span></a></div><div class="post__bio bio"><div class="bio__info"><h3 class="bio__name"><a href="https://www.k8s.it/authors/lgirardi/" rel="author">lgirardi</a></h3><p>If it isn&#x27;t there, it can&#x27;t break.</p></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://www.k8s.it/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://www.k8s.it/kubernetes-destroyed-the-virtualization-or-not.html" class="post__nav-link" rel="prev"><span>Previous</span> Kubernetes has destroyed the virtualization... or NOT</a></div><div class="post__nav-next"><a href="https://www.k8s.it/the-monitoring-paper.html" class="post__nav-link" rel="next"><span>Next</span> The monitoring paper </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://www.k8s.it/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__comments"><div class="wrapper"></div></div></main><footer class="footer"><div class="footer__social"><a href="https://www.linkedin.com/in/lgirardi/" aria-label="LinkedIn"><svg><use xlink:href="https://www.k8s.it/assets/svg/svg-map.svg#linkedin"/></svg></a></div><div class="footer__copyright"><p>.</p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://www.k8s.it/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script defer="defer" src="https://www.k8s.it/assets/js/scripts.min.js?v=f47c11534595205f20935f0db2a62a85"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><div class="pcb" data-behaviour="badge" data-behaviour-link="#cookie-settings" data-revision="1" data-config-ttl="90" data-debug-mode="false"><div role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-title" aria-describedby="pcb-txt" class="pcb__banner"><div class="pcb__inner"><div id="pcb-title" role="heading" class="pcb__title">This website uses cookies</div><div id="pcb-txt" class="pcb__txt">Select which cookies to opt-in to via the checkboxes below; our website uses cookies to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality. <a href="#not-specified">More details...</a></div><div class="pcb__buttons"><button type="button" class="pcb__btn pcb__btn--link pcb__btn--configure" aria-haspopup="dialog">Manage preferences</button> <button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Save</button></div></div></div><div class="pcb__popup" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-popup-title"><div class="pcb__popup__wrapper"><div class="pcb__inner pcb__popup__inner"><div class="pcb__popup__heading"><div id="pcb-popup-title" role="heading" class="pcb__title">Cookie settings</div><button class="pcb__popup__close" aria-label="Close"></button></div><div class="pcb__popup__content"><div class="pcb__txt pcb__popup__txt">We use cookies to enhance your browsing experience, serve personalized ads or content, and analyze our traffic. By clicking "Accept All", you consent to our use of cookies. <a href="#not-specified">More details...</a></div><ul class="pcb__groups"><li class="pcb__group"><details><summary class="pcb__group__title no-desc">Required</summary></details><div class="pcb__popup__switch is-checked"><input type="checkbox" data-group-name="" id="pcb-group-0" checked="checked"> <label for="pcb-group-0">Required</label></div></li><li class="pcb__group"><details><summary class="pcb__group__title no-desc">Functionality</summary></details><div class="pcb__popup__switch"><input type="checkbox" data-group-name="functions" id="functions-cookies"> <label for="functions-cookies">Functionality</label></div></li><li class="pcb__group"><details><summary class="pcb__group__title no-desc">Analytical</summary></details><div class="pcb__popup__switch"><input type="checkbox" data-group-name="analytics" id="analytics-cookies"> <label for="analytics-cookies">Analytical</label></div></li><li class="pcb__group"><details><summary class="pcb__group__title no-desc">Marketing</summary></details><div class="pcb__popup__switch"><input type="checkbox" data-group-name="marketing" id="marketing-cookies"> <label for="marketing-cookies">Marketing</label></div></li></ul></div><div class="pcb__buttons pcb__popup__buttons"><button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button> <button type="button" class="pcb__btn pcb__btn--reject">Reject all</button> <button type="button" class="pcb__btn pcb__btn--save">Save settings</button></div></div></div></div><div class="pcb__overlay" aria-hidden="true"></div><button class="pcb__badge" aria-label="Cookie Policy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" width="40" height="40" viewBox="0 0 23 23" fill="currentColor"><path d="M21.41 12.71c-.08-.01-.15 0-.22 0h-.03c-.03 0-.05 0-.08.01-.07 0-.13.01-.19.04-.52.21-1.44.19-2.02-.22-.44-.31-.65-.83-.62-1.53a.758.758 0 0 0-.27-.61.73.73 0 0 0-.65-.14c-1.98.51-3.49.23-4.26-.78-.82-1.08-.73-2.89.24-4.49.14-.23.14-.52 0-.75a.756.756 0 0 0-.67-.36c-.64.03-1.11-.1-1.31-.35-.19-.26-.13-.71-.01-1.29.04-.18.06-.38.03-.59-.05-.4-.4-.7-.81-.66C5.1 1.54 1 6.04 1 11.48 1 17.28 5.75 22 11.6 22c5.02 0 9.39-3.54 10.39-8.42.08-.4-.18-.78-.58-.87Zm-9.81 7.82c-5.03 0-9.12-4.06-9.12-9.06 0-4.34 3.05-8 7.25-8.86-.08.7.05 1.33.42 1.81.24.32.66.67 1.38.84-.76 1.86-.65 3.78.36 5.11.61.81 2.03 2 4.95 1.51.18.96.71 1.54 1.18 1.87.62.43 1.38.62 2.1.62.05 0 .09 0 .13-.01-1.23 3.64-4.7 6.18-8.64 6.18ZM13 17c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1Zm5.29-12.3a.99.99 0 0 1-.29-.71c0-.55.45-.99 1-.99a1 1 0 0 1 .71.3c.19.19.29.44.29.71 0 .55-.45.99-1 .99a1 1 0 0 1-.71-.3ZM9 13.5c0 .83-.67 1.5-1.5 1.5S6 14.33 6 13.5 6.67 12 7.5 12s1.5.67 1.5 1.5Zm3.25.81a.744.744 0 0 1-.06-1.05c.28-.32.75-.34 1.05-.06.31.28.33.75.05 1.06-.15.16-.35.25-.56.25-.18 0-.36-.06-.5-.19ZM8.68 7.26c.41.37.44 1 .07 1.41-.2.22-.47.33-.75.33a.96.96 0 0 1-.67-.26c-.41-.37-.44-1-.07-1.41.37-.42 1-.45 1.41-.08Zm11.48 1.88c.18-.19.52-.19.7 0 .05.04.09.1.11.16.03.06.04.12.04.19 0 .13-.05.26-.15.35-.09.1-.22.15-.35.15s-.26-.05-.35-.15a.355.355 0 0 1-.11-.16.433.433 0 0 1-.04-.19c0-.13.05-.26.15-.35Zm-4.93-1.86a.75.75 0 1 1 1.059-1.06.75.75 0 0 1-1.059 1.06Z"/></svg></button></div><script>(function(win) {
    if (!document.querySelector('.pcb')) {
        return;
    }

    var cbConfig = {
        behaviour: document.querySelector('.pcb').getAttribute('data-behaviour'),
        behaviourLink: document.querySelector('.pcb').getAttribute('data-behaviour-link'),
        revision: document.querySelector('.pcb').getAttribute('data-revision'),
        configTTL: parseInt(document.querySelector('.pcb').getAttribute('data-config-ttl'), 10),
        debugMode: document.querySelector('.pcb').getAttribute('data-debug-mode') === 'true',
        initialState: null,
        previouslyAccepted: []
    };

    var cbUI = {
        wrapper: document.querySelector('.pcb'),
        banner: {
            element: null,
            btnAccept: null,
            btnReject: null,
            btnConfigure: null
        },
        popup: {
            element: null,
            btnClose: null,
            btnSave: null,
            btnAccept: null,
            btnReject: null,
            checkboxes: null,
        },
        overlay: null,
        badge: null,
        blockedScripts: document.querySelectorAll('script[type^="gdpr-blocker/"]'),
        triggerLinks: cbConfig.behaviourLink ? document.querySelectorAll('a[href*="' + cbConfig.behaviourLink + '"]') : null
    };

    function initUI () {
        // setup banner elements
        cbUI.banner.element = cbUI.wrapper.querySelector('.pcb__banner');
        cbUI.banner.btnAccept = cbUI.banner.element.querySelector('.pcb__btn--accept');
        cbUI.banner.btnReject = cbUI.banner.element.querySelector('.pcb__btn--reject');
        cbUI.banner.btnConfigure = cbUI.banner.element.querySelector('.pcb__btn--configure');

        // setup popup elements
        if (cbUI.wrapper.querySelector('.pcb__popup')) {
            cbUI.popup.element = cbUI.wrapper.querySelector('.pcb__popup');
            cbUI.popup.btnClose = cbUI.wrapper.querySelector('.pcb__popup__close');
            cbUI.popup.btnSave = cbUI.popup.element.querySelector('.pcb__btn--save');
            cbUI.popup.btnAccept = cbUI.popup.element.querySelector('.pcb__btn--accept');
            cbUI.popup.btnReject = cbUI.popup.element.querySelector('.pcb__btn--reject');
            cbUI.popup.checkboxes = cbUI.popup.element.querySelector('input[type="checkbox"]');
            // setup overlay
            cbUI.overlay = cbUI.wrapper.querySelector('.pcb__overlay');
        }

        cbUI.badge = cbUI.wrapper.querySelector('.pcb__badge');

        if (cbConfig.behaviour.indexOf('link') > -1) {
            for (var i = 0; i < cbUI.triggerLinks.length; i++) {
                cbUI.triggerLinks[i].addEventListener('click', function(e) {
                    e.preventDefault();
                    showBannerOrPopup();
                });
            }
        }
    }

    function initState () {
        var lsKeyName = getConfigName();
        var currentConfig = localStorage.getItem(lsKeyName);
        var configIsFresh = checkIfConfigIsFresh();

        if (!configIsFresh || currentConfig === null) {
            if (cbConfig.debugMode) {
                console.log('🍪 Config not found, or configuration expired');
            }

            showBanner();
        } else if (typeof currentConfig === 'string') {
            if (cbConfig.debugMode) {
                console.log('🍪 Config founded');
            }

            showBadge();

            if (cbUI.popup.element) {
                var allowedGroups = currentConfig.split(',');
                var checkedCheckboxes = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');

                for (var j = 0; j < checkedCheckboxes.length; j++) {
                    var name = checkedCheckboxes[j].getAttribute('data-group-name');

                    if (name && name !== '-' && allowedGroups.indexOf(name) === -1) {
                        checkedCheckboxes[j].checked = false;
                    }
                }

                for (var i = 0; i < allowedGroups.length; i++) {
                    var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + allowedGroups[i] + '"]');

                    if (checkbox) {
                        checkbox.checked = true;
                    }

                    allowCookieGroup(allowedGroups[i]);
                }
            }
        }

        setTimeout(function () {
            cbConfig.initialState = getInitialStateOfConsents();
        }, 0);
    }

    function checkIfConfigIsFresh () {
        var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');

        if (lastConfigSave === null) {
            return false;
        }

        lastConfigSave = parseInt(lastConfigSave, 10);

        if (lastConfigSave === 0) {
            return true;
        }

        if (+new Date() - lastConfigSave < cbConfig.configTTL * 24 * 60 * 60 * 1000) {
            return true;
        }

        return false;
    }

    function initBannerEvents () {
        cbUI.banner.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('banner');
            showBadge();
        }, false);

        if (cbUI.banner.btnReject) {
            cbUI.banner.btnReject.addEventListener('click', function (e) {
                e.preventDefault();
                rejectAllCookies();
                showBadge();
            }, false);
        }

        if (cbUI.banner.btnConfigure) {
            cbUI.banner.btnConfigure.addEventListener('click', function (e) {
                e.preventDefault();
                hideBanner();
                showAdvancedPopup();
                showBadge();
            }, false);
        }
    }

    function initPopupEvents () {
        if (!cbUI.popup.element) {
            return;
        }

        cbUI.overlay.addEventListener('click', function (e) {
            hideAdvancedPopup();
        }, false);

        cbUI.popup.element.addEventListener('click', function (e) {
            e.stopPropagation();
        }, false);

        cbUI.popup.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('popup');
        }, false);

        cbUI.popup.btnReject.addEventListener('click', function (e) {
            e.preventDefault();
            rejectAllCookies();
        }, false);

        cbUI.popup.btnSave.addEventListener('click', function (e) {
            e.preventDefault();
            saveConfiguration();
        }, false);

        cbUI.popup.btnClose.addEventListener('click', function (e) {
            e.preventDefault();
            hideAdvancedPopup();
        }, false);
    }

    function initBadgeEvents () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.addEventListener('click', function (e) {
            showBannerOrPopup();
        }, false);
    }

    initUI();
    initState();
    initBannerEvents();
    initPopupEvents();
    initBadgeEvents();

    /**
     * API
     */
    function addScript (src, inline) {
        var newScript = document.createElement('script');

        if (src) {
            newScript.setAttribute('src', src);
        }

        if (inline) {
            newScript.text = inline;
        }

        document.body.appendChild(newScript);
    }

    function allowCookieGroup (allowedGroup) {
        var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
        cbConfig.previouslyAccepted.push(allowedGroup);
    
        for (var j = 0; j < scripts.length; j++) {
            addScript(scripts[j].src, scripts[j].text);
        }

        var groupEvent = new Event('publii-cookie-banner-unblock-' + allowedGroup);
        document.body.dispatchEvent(groupEvent);
        unlockEmbeds(allowedGroup);

        if (cbConfig.debugMode) {
            console.log('🍪 Allowed group: ' + allowedGroup);
        }
    }

    function showBannerOrPopup () {
        if (cbUI.popup.element) {
            showAdvancedPopup();
        } else {
            showBanner();
        }
    }

    function showAdvancedPopup () {
        cbUI.popup.element.classList.add('is-visible');
        cbUI.overlay.classList.add('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'false');
        cbUI.overlay.setAttribute('aria-hidden', 'false');
    }

    function hideAdvancedPopup () {
        cbUI.popup.element.classList.remove('is-visible');
        cbUI.overlay.classList.remove('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'true');
        cbUI.overlay.setAttribute('aria-hidden', 'true');
    }

    function showBanner () {
        cbUI.banner.element.classList.add('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'false');
    }

    function hideBanner () {
        cbUI.banner.element.classList.remove('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'true');
    }

    function showBadge () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.classList.add('is-visible');
        cbUI.badge.setAttribute('aria-hidden', 'false');
    }

    function getConfigName () {
        var lsKeyName = 'publii-gdpr-allowed-cookies';

        if (cbConfig.revision) {
            lsKeyName = lsKeyName + '-v' + parseInt(cbConfig.revision, 10);
        }

        return lsKeyName;
    }

    function storeConfiguration (allowedGroups) {
        var lsKeyName = getConfigName();
        var dataToStore = allowedGroups.join(',');
        localStorage.setItem(lsKeyName, dataToStore);

        if (cbConfig.configTTL === 0) {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', 0);

            if (cbConfig.debugMode) {
                console.log('🍪 Store never expiring configuration');
            }
        } else {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', +new Date());
        }
    }

    function getInitialStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Initial state: ' + groups.join(', '));
        }

        return groups;
    }

    function getCurrentStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 State to save: ' + groups.join(', '));
        }

        return groups;
    }

    function getAllGroups () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        return groups;
    }

    function acceptAllCookies (source) {
        var groupsToAccept = getAllGroups();
        storeConfiguration(groupsToAccept);

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        if (cbUI.popup.element) {
            var checkboxesToCheck = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');

            for (var j = 0; j < checkboxesToCheck.length; j++) {
                checkboxesToCheck[j].checked = true;
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Accept all cookies: ', groupsToAccept.join(', '));
        }

        if (source === 'popup') {
            hideAdvancedPopup();
        } else if (source === 'banner') {
            hideBanner();
        }
    }

    function rejectAllCookies () {
        if (cbConfig.debugMode) {
            console.log('🍪 Reject all cookies');
        }

        storeConfiguration([]);
        setTimeout(function () {
            window.location.reload();
        }, 100);
    }

    function saveConfiguration () {
        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }

        if (reloadIsNeeded(groupsToAccept)) {
            setTimeout(function () {
                window.location.reload();
            }, 100);
            return;
        }

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        hideAdvancedPopup();
    }

    function reloadIsNeeded (groupsToAccept) {
        // check if user rejected consent for initial groups
        var initialGroups = cbConfig.initialState;
        var previouslyAcceptedGroups = cbConfig.previouslyAccepted;
        var groupsToCheck = initialGroups.concat(previouslyAcceptedGroups);

        for (var i = 0; i < groupsToCheck.length; i++) {
            var groupToCheck = groupsToCheck[i];

            if (groupsToAccept.indexOf(groupToCheck) === -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Reload is needed due lack of: ', groupToCheck);
                }

                return true;
            }
        }

        return false;
    }

    function unlockEmbeds (cookieGroup) {
        var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');

        for (var i = 0; i < iframesToUnlock.length; i++) {
            var iframeWrapper = iframesToUnlock[i];
            iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
            iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
            var iframe = iframeWrapper.querySelector('iframe');
            iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
        }
    }

    win.publiiEmbedConsentGiven = function (cookieGroup) {
        // it will unlock embeds
        allowCookieGroup(cookieGroup);

        var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + cookieGroup + '"]');

        if (checkbox) {
            checkbox.checked = true;
        }

        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }
    }
})(window);</script></body></html>