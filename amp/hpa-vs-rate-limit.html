<!doctype html><html amp lang="en-us"><head><meta charset="utf-8"><title>HPA vs Rate-limit - LAB</title><meta name="description" content="Strange ... we are using hpa to increase the availability and we are introducing rate limit to reduce? Well let's create the context... This story is not a true o false sentence, it's a sort of analysis based on a few assumptions: In Kubernetes, a&hellip;"><link rel="canonical" href="https://www.k8s.it/hpa-vs-rate-limit.html"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet" type="text/css"><script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script><script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script><script async custom-element="amp-video" src="https://cdn.ampproject.org/v0/amp-video-0.1.js"></script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.k8s.it/amp/hpa-vs-rate-limit.html"},"headline":"HPA vs Rate-limit","datePublished":"2023-02-14T20:23","dateModified":"2023-02-16T22:47","image":{"@type":"ImageObject","url":"https://www.k8s.it/media/posts/43/Screenshot_2023-02-14_at_20.15.33-removebg-preview-2.png","height":229,"width":646},"description":"Strange ... we are using hpa to increase the availability and we are introducing rate limit to reduce? Well let's create the context... This story is not a true o false sentence, it's a sort of analysis based on a few assumptions: In Kubernetes, a&hellip;","author":{"@type":"Person","name":"lgirardi","url":"https://www.k8s.it/amp/authors/lgirardi/"},"publisher":{"@type":"Organization","name":"lgirardi"}}</script><style amp-custom>article,
aside,
footer,
header,
hgroup,
main,
nav,
section {
  display: block; }

*,
*:before,
*:after {
  -webkit-box-sizing: content-box;
  box-sizing: content-box;
  margin: 0;
  padding: 0; }

li {
  list-style: none; }

amp-img {
  max-width: 100%; }

button,
input,
select,
textarea {
  font: inherit; }

html {
  font-size: 1rem; }

body {
  background: #f1f1f1;
  color: #262626;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
  line-height: 1.6; }

a {
  color:  #039be5;
  text-decoration: none;
  -webkit-transition: all 0.12s linear 0s;
  -o-transition: all 0.12s linear 0s;
  transition: all 0.12s linear 0s; }

a:hover {
  color: #262626;
  text-decoration: underline;
  -webkit-text-decoration-skip: ink;
  text-decoration-skip: ink; }

a:active {
  color: #262626; }

a:focus {
  outline: 2px dotted #039be5; }

figure,
blockquote,
p,
ul,
ol,
dl,
table,
hr,
fieldset {
  margin-top: 1.6rem; }

h1,
h2,
h3,
h4,
h5,
h6 {
  color: #262626;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
  font-weight: 500;
  line-height: 1.2;
  margin-top: 2.13333rem; }

h1 {
  font-size: 1.67583rem;
  font-weight: normal; }

h2 {
  font-size: 1.4729rem; }

h3 {
  font-size: 1.29454rem; }

h4 {
  font-size: 1.13778rem; }

h5 {
  font-size: 1rem; }

h6 {
  font-size: 0.87891rem; }

h2 + p,
h3 + p,
h4 + p,
h5 + p,
h6 + p {
  margin-top: 0.8rem; }

b,
strong {
  font-weight: 600; }

blockquote {
  color: #6c7175;
  font-family: "Droid Serif", "Times", "Source Serif Pro", serif;
  font-style: italic;
  padding: 1.33333rem 0.53333rem 1.33333rem 3.2rem;
  position: relative; }
  blockquote:before {
    display: block;
    content: "\201C";
    font-size: 4.41226rem;
    position: absolute;
    left: 0;
    top: -12px;
    color: rgba(108, 113, 117, 0.5); }
  blockquote > :nth-child(1) {
    margin-top: 0; }

ul,
ol {
  margin-left: 2rem; }
  ul > li,
  ol > li {
    list-style: inherit;
    padding: 0 0 0.26667rem 0.26667rem; }

dl dt {
  color: #262626;
  font-weight: 600; }

code,
pre {
  background-color: #f1f1f1;
  font-family: monospace; }

pre {
  margin: 1.6rem 0 0;
  padding: 1.6rem;
  white-space: pre-wrap;
  word-wrap: break-word;
  overflow-x: auto; }
  pre > code {
    color: #262626;
    padding: 0; }

code {
  border-radius: 3px;
  color: #262626;
  padding: 0.26667rem 0.53333rem; }

table {
  border-collapse: collapse;
  border-spacing: 0;
  border: 1px solid #d4d4d4;
  width: 100%;
  overflow-x: auto;
  vertical-align: top;
  text-align: left;
  white-space: nowrap; }
  table th {
    font-weight: 500;
    padding: 0.53333rem 1.06667rem; }
  table tr {
    border-bottom: 1px solid #d4d4d4; }
    table tr:nth-child(2n) {
      background: #f1f1f1; }
  table td {
    padding: 0.53333rem 1.06667rem; }

figcaption {
  clear: both;
  color: rgba(108, 113, 117, 0.6);
  font-size: 0.82397rem;
  margin: 0.8rem 0 0;
  text-align: center; }

sub,
sup {
  font-size: 65%; }

hr {
  border: 0;
  height: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(255, 255, 255, 0.3); }

.btn, [type=button],
[type=submit],
button {
  background: #039be5;
  border: none;
  border-radius: 2px;
  color: #ffffff;
  cursor: pointer;
  display: inline-block;
  font-size: 0.87891rem;
  font-weight: 500;
  line-height: 1.9;
  padding: 0.53333rem 1.33333rem;
  text-align: center;
  text-decoration: none;
  -webkit-transition: all .15s ease;
  -o-transition: all .15s ease;
  transition: all .15s ease;
  width: auto; }
  .btn:hover, [type=button]:hover,
  [type=submit]:hover,
  button:hover {
    background: #262626;
    color: #ffffff; }
  .btn:focus, [type=button]:focus,
  [type=submit]:focus,
  button:focus {
    outline: none; }
  .btn-outline {
    border: 1px solid #ddd;
    background: #ffffff;
    border-radius: 3px;
    color: #262626; }

[type=button],
[type=submit],
button {
  text-transform: uppercase;
  -webkit-appearance: none;
  -moz-appearance: none; }

.navbar {
  background: #039be5;
  -webkit-box-shadow: 0 0 6px 0 rgba(0, 0, 0, 0.2);
  box-shadow: 0 0 6px 0 rgba(0, 0, 0, 0.2);
  line-height: 3;
  max-height: 4rem; }
  .navbar > div {
    -webkit-box-align: center;
    -ms-flex-align: center;
    align-items: center;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-pack: center;
    -ms-flex-pack: center;
    justify-content: center;
    text-align: left;
    max-width: 700px;
    margin: 0 auto; }
  .navbar a {
    color: #ffffff;
    text-decoration: none; }
  .navbar-sidebar-toggle {
    left: 0;
    position: relative;
    text-indent: -99999rem; }
    .navbar-sidebar-toggle:before {
      content: "";
      display: block;
      border-top: 0.375rem double #ffffff;
      border-bottom: 0.125rem solid #ffffff;
      height: 0.125rem;
      position: absolute;
      text-indent: 0;
      top: 50%;
      width: 1.3rem;
      -webkit-transform: translate(0px, -50%);
      -ms-transform: translate(0px, -50%);
      transform: translate(0px, -50%); }


.logo {
            display: inline-block;
  font-weight: 600;
  line-height: 1;
            margin: 0 auto;
            height: 2rem;
            text-indent: -9999px;
            width: 240px;vertical-align: middle;
        }
        .logo.logo-text {
            line-height: 2;
            text-align: center;
            text-indent: 0;
        }

amp-sidebar {
  background: #ffffff;
  width: 240px; }
  amp-sidebar > ul {
    margin: 0.8rem 0 0;
    padding: 0; }
    amp-sidebar > ul ul {
      border-left: 1px solid #d4d4d4;
      margin: 0.53333rem 0 0; }
    amp-sidebar > ul li {
      color: #262626;
      font-size: 0.9375rem;
      font-weight: 600;
      list-style: none;
      line-height: 1.4;
      padding: 0.42667rem 1.06667rem; }
      amp-sidebar > ul li li {
        font-weight: normal;
        padding: 0.26667rem 0 0.26667rem 1.06667rem; }
    amp-sidebar > ul a,
    amp-sidebar > ul a:visited {
      color: #262626; }

.bg-white {
  background: #ffffff; }

.wrap-page {
  max-width: 700px;
  margin: 0 auto; }

@media all and (max-width: 43.6875em) {
  .wrap-inner {
    padding: 0 6%; } }

.page-title {
  background: #ffffff;
  -webkit-box-shadow: 0 2px 3px rgba(38, 38, 38, 0.1);
  box-shadow: 0 2px 3px rgba(38, 38, 38, 0.1);
  margin-bottom: 0.8rem;
  padding: 1.6rem 6%; }
  .page-title > h1 {
    margin: 0;
    font-size: 1.29454rem; }
  .page-title > p {
    font-size: 0.87891rem;
    color: #6c7175;
    line-height: 1.3;
    margin: 0.26667rem 0 0; }
  .page-title-author {
    border-radius: 50%;
    float: left;
    height: 2.5rem;
    width: 2.5rem; }
    .page-title-author + h1 {
      margin-left: 3.5rem; }
      .page-title-author + h1 + p {
        margin-left: 3.5rem; }

.card {
  background: #ffffff;
  -webkit-box-shadow: 0 2px 3px rgba(38, 38, 38, 0.1);
  box-shadow: 0 2px 3px rgba(38, 38, 38, 0.1);
  margin-bottom: 0.8rem;
  padding-bottom: 1.06667rem; }

  .card-meta {
    border-top: 1px solid #d4d4d4;
    color: rgba(108, 113, 117, 0.6);
    font-size: 0.7242rem;
    font-weight: 500;
    margin-top: 1.06667rem;
    padding-top: 1.06667rem;
    text-transform: uppercase; }
    .card-meta a + time:before {
      content: "";
      background: #d4d4d4;
      display: inline-block;
      height: 3px;
      margin: 0 8px;
      width: 3px;
      vertical-align: middle;
      border-radius: 50%; }
  .card-text {
    font-size: 0.9375rem;
    overflow: hidden;
    padding: 0 6%; }
    .card-text h2 {
      font-size: 1.13778rem; }

.post {
  margin-bottom: 2.13333rem; }
  .post-featured-image {
    margin-top: 0;
    position: relative; }
    .post-featured-image > figcaption {
      background: rgba(0, 0, 0, 0.5);
      border-radius: 3px;
      color: #ffffff;
      position: absolute;
      bottom: 0.8rem;
      padding: 0 0.26667rem;
      right: 6%; }
  .post-header {
    margin-bottom: 2.13333rem; }
  .post-meta {
    border-bottom: 1px solid #d4d4d4;
    color: rgba(108, 113, 117, 0.6);
    font-size: 0.7242rem;
    font-weight: 500;
    margin-top: 1.06667rem;
    padding-bottom: 1.06667rem;
    text-transform: uppercase; }
    .post-meta a + time:before {
      content: "";
      background: #d4d4d4;
      display: inline-block;
      height: 3px;
      margin: 0 8px;
      width: 3px;
      vertical-align: middle;
      border-radius: 50%; }
  .post-tag {
    margin: 0; }
    .post-tag > li {
      display: inline-block;
      padding: 0; }
      .post-tag > li a {
        background: #f1f1f1;
        border-radius: 2px;
        color: #6c7175;
        font-size: 0.77248rem;
        display: inline-block;
        margin: 0 0.26667rem 0.26667rem 0;
        padding: 0.26667rem 0.53333rem; }
        .post-tag > li a:hover {
          background: #039be5;
          color: #ffffff;
          text-decoration: none; }
  .post-share {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
    -ms-flex-direction: row;
    flex-direction: row;
    -webkit-box-pack: justify;
    -ms-flex-pack: justify;
    justify-content: space-between;
    margin-top: 1.6rem;
    width: 100%; }
    .post-share amp-social-share {
      -webkit-box-flex: 1;
      -ms-flex: 1 0 auto;
      flex: 1 0 auto;
      background-size: 24px; }
  .post-scroll {
    color: #ffffff;
    background: #039be5;
    bottom: 10px;
    border-radius: 50%;
    border: none;
    -webkit-box-shadow: 0 1px 1.5px 0 rgba(38, 38, 38, 0.12), 0 1px 1px 0 rgba(38, 38, 38, 0.24);
    box-shadow: 0 1px 1.5px 0 rgba(38, 38, 38, 0.12), 0 1px 1px 0 rgba(38, 38, 38, 0.24);
    font-size: 1.13778rem;
    height: 46px;
    opacity: 0;
    outline: none;
    position: fixed;
    padding: 0;
    right: 4%;
    visibility: hidden;
    width: 46px;
    z-index: 9999; }
    .post-scroll-marker {
      height: 0px;
      position: absolute;
      top: 100px;
      width: 0px; }
        .post-pagination {
    background: #f1f1f1;
    -webkit-box-shadow: inset 0 2px 3px rgba(38, 38, 38, 0.1);
    box-shadow: inset 0 2px 3px rgba(38, 38, 38, 0.1);
    border-top: 1px solid #d4d4d4;
    padding: 1.06667rem 0; }
    .post-pagination > div {
      line-height: 1.2;
      padding: 0.53333rem 1.06667rem;
      text-align: center; }
      .post-pagination > div span {
        display: block;
        color: #6c7175;
        font-size: 0.7242rem;
        font-weight: 500;
        margin-bottom: 0.26667rem;
        text-transform: uppercase; }
    .post-pagination-prev a:before {
      content: "\2190";
      margin-right: 0.26667rem; }
    .post-pagination-next a:after {
      content: "\2192";
      margin-left: 0.26667rem; }

aside {
  margin: 1.6rem 0 0; }

.align-left {
  text-align: left; }

.align-right {
  text-align: right; }

.align-center {
  text-align: center; }

.align-justify {
  text-align: justify; }

.msg {
  border-left: 2px solid transparent;
  padding: 1.06667rem 1.06667rem; }
  .msg--highlight {
    background-color: #fff8e6;
    border-color: #e2ac4f; }
  .msg--info {
    background: rgba(45, 97, 201, 0.03);
    border-color: #039be5; }
  .msg--success {
    background: #f7fbf6;
    border-color: #5ab44b; }
  .msg--warning {
    background: #fff3f3;
    border-color: #c06367;
    color: #a94442; }

.dropcap:first-letter {
  float: left;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
  font-size: 2.16943rem;
  line-height: 0.7;
  margin-right: 0.53333rem;
  padding: 0.53333rem 0.53333rem 0.53333rem 0; }

.pagination {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: justify;
  -ms-flex-pack: justify;
  justify-content: space-between;
  margin: 0.8rem 0; }
  .pagination > a {
    padding-left: 0;
    padding-right: 0;
    width: 49%; }
  .pagination-right {
    margin-left: auto; }

.bottom {
  background: #039be5;
  color: #ffffff;
  padding: 1.06667rem 4%;
  text-align: center; }</style><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><script async src="https://cdn.ampproject.org/v0.js"></script><script custom-element="amp-animation" src="https://cdn.ampproject.org/v0/amp-animation-0.1.js" async></script><script custom-element="amp-position-observer" src="https://cdn.ampproject.org/v0/amp-position-observer-0.1.js" async></script></head><body class="bg-white"><nav class="navbar wrap-inner" id="top"><div><a on="tap:navbar-sidebar.toggle" class="navbar-sidebar-toggle" title="Menu">Menu</a> <a class="logo logo-text" href="https://www.k8s.it/amp/">LAB</a></div></nav><main class="wrap-page"><article class="post"><figure class="post-featured-image"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot_2023-02-14_at_20.15.33-removebg-preview-2.png" alt="" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot_2023-02-14_at_20.15.33-removebg-preview-2-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot_2023-02-14_at_20.15.33-removebg-preview-2-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot_2023-02-14_at_20.15.33-removebg-preview-2-md.webp 768w" sizes="(max-width: 768px) 100vw, 768px" height="229" layout="responsive" width="646"></amp-img></figure><div class="wrap-inner"><header class="post-header"><h1>HPA vs Rate-limit</h1><p class="post-meta"><time datetime="2023-02-14T20:23">14 Feb 2023</time></p></header><div class="post__toc"><h3>Table of Contents</h3><ul><li><a href="#mcetoc_1gpdt88oks2">INTRO</a><ul><li><a href="#mcetoc_1gpdt88oks3">HPA</a><ul><li><a href="#mcetoc_1gpdt88oks4">Patterns</a></li><li><a href="#mcetoc_1gpdt88oks5">Meaning</a></li><li><a href="#mcetoc_1gpdt88oks6">Ideal Practice</a></li></ul></li><li><a href="#mcetoc_1gpdt88oks7">Rate Limit</a></li></ul></li><li><a href="#mcetoc_1gpdt88oks8">GOALS</a></li><li><a href="#mcetoc_1gpdt88oks9">Limits</a></li><li><a href="#mcetoc_1gpdt88oksa">Hands-on</a><ul><li><a href="#mcetoc_1gpdt88oksb">Simulation</a><ul><li><ul><li><a href="#mcetoc_1gpdu7tqi167">Note</a></li></ul></li><li> </li><li><a href="#mcetoc_1gpdu7tqi169">NO AUTOSCALING</a><ul><li><a href="#mcetoc_1gpdu7tqi16a">First run 40rps max</a></li><li><a href="#mcetoc_1gpdu7tqi16b">Second run 33rps max</a></li></ul></li><li><a href="#mcetoc_1gpduj9db16h">AUTOSCALING</a><ul><li><a href="#mcetoc_1gpduui3818q">1 pod start - hpa 33rps - 15 min - 99 max requests</a></li><li><a href="#mcetoc_1gpdvmntb1ba">2 pod start - hpa 33rps - 15 min - 99 max requests</a></li><li><a href="#mcetoc_1gpdvne631bd">1 pod start - hpa 30rps - 15 min - 99 max requests</a></li><li><a href="#mcetoc_1gpe003lg1ci">1 pod start - hpa 27rps - 15 min - 99 max requests</a></li><li><a href="#mcetoc_1gpe0j6931f3"> [optimal] 1 pod start - hpa 24rps - 15 min - 99 max requests</a></li><li><a href="#mcetoc_1gpe0j6931f4">1 pod start - hpa 25rps - 15 min - 99 max requests</a></li></ul></li><li><a href="#mcetoc_1gpe0j6931f5">AUTOSCALING Internal rate limit</a><ul><li><a href="#mcetoc_1gpe0pd9t1fm">[optimal] 1 pod start - hpa 25rps- 15 min - 99 max requests rate-limit 27</a></li><li><a href="#mcetoc_1gpe1laq11pb">1 pod start - hpa 26rps - 15 min - 99 max requests rate-limit 28</a></li><li><a href="#mcetoc_1gpe1laq11pc">1 pod start - hpa 27rps - 15 min - 99 max requests rate-limit 29</a></li></ul></li><li><a href="#mcetoc_1gpe1laq11pd">AUTOSCALING envoy rate limit</a><ul><li><a href="#mcetoc_1gpe1laq11pe">1 pod start - hpa 27rps - 15 min - 99 max requests rate-limit 29 - envoy</a></li><li><a href="#mcetoc_1gpe1laq11pf">[optimal] 1 pod start - hpa 26rps - 15 min - 99 max requests rate-limit 29 - envoy</a></li></ul></li><li><a href="#mcetoc_1gpe1laq11pg">Unexpected traffic</a><ul><li><a href="#mcetoc_1gpe2t9fu2jk">3 pod start - hpa 26rps - 15 min - 82 avg requests with spikes -  rate-limit 27 internal</a></li><li><a href="#mcetoc_1gpe2t9fu2jl">[optimal] 3 pod start - hpa 26rps - 15 min - 82 avg requests with spikes -  rate-limit 27 - envoy</a></li></ul></li><li><a href="#mcetoc_1gpe2t9fu2jm">Conclusions</a><ul><li><a href="#mcetoc_1gpe2t9fu2jn">HPA</a></li><li><a href="#mcetoc_1gpe2t9fu2jo">Rate Limit</a></li><li><a href="#mcetoc_1gpe2t9fu2jp">Both</a></li><li><a href="#mcetoc_1gpe2t9fu2jq">Costs</a><ul><li><a href="#mcetoc_1gpe2t9fu2jr">Highlights</a></li></ul></li></ul></li></ul></li></ul></li></ul></div><p><span>Strange ... we are using hpa to increase the availability and we are introducing rate limit to reduce?  </span></p><p><span>Well let's create the context...</span></p><h1 id="mcetoc_1gpdt88oks2"><span>INTRO</span></h1><p><span>This <em>story </em>is not a true o false sentence, it's a sort of analysis based on a few assumptions:</span></p><ul><li><span>cloud environment</span></li><li><span>dynamic infrastructure</span></li><li><span>minimum resources available </span></li></ul><h2 id="mcetoc_1gpdt88oks3"><span>HPA</span></h2><p><span><span>In Kubernetes, a </span><i><span>HorizontalPodAutoscaler</span></i><span> automatically updates a workload resource (such as a </span><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/"><span>Deployment</span></a><span> or </span><a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/"><span>StatefulSet</span></a><span>), with the aim of automatically scaling the workload to match demand.</span></span></p><h3 id="mcetoc_1gpdt88oks4"><span>Patterns</span></h3><figure class="post__image post__image--center"><span><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-20.28.38.png" alt="" width="1174" height="916" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-20.28.38-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-20.28.38-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-20.28.38-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-20.28.38-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-20.28.38-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-20.28.38-2xl.webp 1600w" layout="responsive"></amp-img></span></figure><p></p><h3 id="mcetoc_1gpdt88oks5"><span>Meaning</span></h3><table border="1"><tbody><tr><td><span><strong>Type</strong></span></td><td><span><strong>Behaviour</strong></span></td></tr><tr><td><span>Slow and temporary</span></td><td><span>it might have daily fluctuations in requests volume, peaking during the day and troughing at night</span></td></tr><tr><td><span>Rapid and temporary</span></td><td><span>it might be subject to short bursts of high request volume from poorly-behaved downstream services</span></td></tr><tr><td><span>Slow and persistent</span></td><td><span>it might see its request volume slowly increase over rime, as the product sees greater adoption</span></td></tr><tr><td><span>Rapid and persistent</span></td><td><span>it might see abrupt shift from low to high volumes, such as if it's called by batch jobs</span></td></tr></tbody></table><p> </p><h3 id="mcetoc_1gpdt88oks6"><span>Ideal Practice</span></h3><table border="1"><tbody><tr><td><span><strong>Type</strong></span></td><td><span><strong>Behaviour</strong></span></td></tr><tr><td><span>Slow and temporary</span></td><td><span>The HPA should add and remove pods as necessary</span></td></tr><tr><td><span>Rapid and temporary</span></td><td><span>The HPA should not modify the pod count; instead, the service should leave enough headroom to deal with these brief spikes with only existing pods</span></td></tr><tr><td><span>Slow and persistent </span></td><td><span>The HPA should add and remove pods as necessary</span></td></tr><tr><td><span>Rapid and persistent</span></td><td><span>The service should leave enough headroom to deal with the rapid change, and the HPA should add pods soon after to bring the service back to target utilization</span></td></tr></tbody></table><h2 id="mcetoc_1gpdt88oks7"><span>Rate Limit</span></h2><p><span>A rate limit is the number of API calls an app or user can make within a given time period. If this limit is exceeded or if CPU or total time limits are exceeded, the app or user may be throttled. API requests made by a throttled user or app will fail. All API requests are subject to rate limits.</span></p><p><span>However, keep the HPA patterns as a reference even for this one.</span></p><p> </p><h1 id="mcetoc_1gpdt88oks8"><span>GOALS</span></h1><ul><li aria-level="1"><span>Understand how much we can close with the application enervation during an autoscaling situation using rate limit</span></li><li aria-level="1"><span>Understand how to handle unexpected traffic with rate limit</span></li></ul><p> </p><h1 id="mcetoc_1gpdt88oks9"><span>Limits</span></h1><p><span>Sometimes we can have a spike of requests that are legit... for example consider the google crawlers (image from ... somewhere in google image)</span></p><figure class="post__image post__image--center"><span><amp-img src="https://www.k8s.it/media/posts/43/logs-crawl-spikes-three-c-sm-border.png" alt="" width="518" height="277" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/logs-crawl-spikes-three-c-sm-border-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/logs-crawl-spikes-three-c-sm-border-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/logs-crawl-spikes-three-c-sm-border-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/logs-crawl-spikes-three-c-sm-border-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/logs-crawl-spikes-three-c-sm-border-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/logs-crawl-spikes-three-c-sm-border-2xl.webp 1600w" layout="responsive"></amp-img></span></figure><p></p><p> </p><h1 id="mcetoc_1gpdt88oksa"><span>Hands-on</span></h1><h2 id="mcetoc_1gpdt88oksb"><span>Simulation</span></h2><ul><li aria-level="1"><span><a href="https://github.com/lorenzogirardi/py-test-backend">python</a> app that generates fibonacci sequence</span></li><li aria-level="1"><span>fibonacci number 18500</span></li><li aria-level="1"><span>load test done using gatling</span></li><li aria-level="1"><span>Application capped on cpu (each request is ~10mcpu) with max of 300mcpu for pod (cpu bound)</span></li><li aria-level="1"><span>Hpa based on keda flask_http_request_duration_seconds_count</span></li></ul><p> </p><p><span>Results Example </span></p><p><span><span>$ curl http://xxx/api/fib/18500<br></span><span>8353329688443562486779853158514... etc etc<br></span></span></p><p><span>This ensures that it is not just an echo answer and that we have work behind the scenes.</span></p><p> </p><h4 id="mcetoc_1gpdu7tqi167"><span>Note</span></h4><p><span>Gatling is using an interesting concept that call "active users"</span></p><p><span>“Active users” is neither “concurrent users” or “users arrival rate”. It’s a kind of mixed metric that serves for both open and closed workload models and that represents “users who were active on the system under load at a given second”.</span></p><p><span>It’s computed as:</span></p><p><span><span> (number of alive users at previous second)<br></span><span>+ (number of users that were started during this second)<br></span><span>- (number of users that were terminated during previous second)</span></span></p><h3 id="mcetoc_1gpdu7tqi168"></h3><h3 id="mcetoc_1gpdu7tqi169"><span>NO AUTOSCALING</span></h3><p> </p><h4 id="mcetoc_1gpdu7tqi16a"><span>First run 40rps max</span></h4><p class="msg msg--info"><span><span>rampUsers(10).during(60.seconds), // increase users to 10 in 60 sec<br></span><span>constantUsersPerSec(10).during(60.seconds), // keep 10 users for 60 sec<br></span><span>rampUsersPerSec(10).to(40).during(5.minutes), // increase users to 40 in 5 min</span></span></p><p> </p><figure class="post__image post__image--center"><span><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.15.19.png" alt="" width="1198" height="468" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.15.19-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.15.19-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.15.19-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.15.19-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.15.19-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.15.19-2xl.webp 1600w" layout="responsive"></amp-img></span></figure><p></p><p><span> As soon as we reach the limit the pods start to be unresponsive</span></p><figure class="post__image post__image--center"><span><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.16.02.png" alt="" width="1200" height="326" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.16.02-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.16.02-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.16.02-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.16.02-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.16.02-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.16.02-2xl.webp 1600w" layout="responsive"></amp-img></span></figure><br><span>No metrics after 33 rps, pod crashed</span><br><br><span><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.17.54.png" alt="" width="1194" height="436" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.17.54-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.17.54-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.17.54-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.17.54-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.17.54-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.17.54-2xl.webp 1600w" layout="responsive"></amp-img></figure></span><br><span>No metrics after &gt;28% of cpu (consider the max as 30% as the pod limit is 300mcpu)</span><br><br><span><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.19.22.png" alt="" width="1200" height="482" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.19.22-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.19.22-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.19.22-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.19.22-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.19.22-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.19.22-2xl.webp 1600w" layout="responsive"></amp-img></figure></span><p></p><figure class="post__image post__image--center"><span><span>Failure rate (low) when rps &gt; 35 and high response time<br><br><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.20.38.png" alt="" width="1182" height="476" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.20.38-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.20.38-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.20.38-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.20.38-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.20.38-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.20.38-2xl.webp 1600w" layout="responsive"></amp-img></span></span></figure><br><span>Active users increase dramatically after 33 rps<br><br></span><p></p><h4 id="mcetoc_1gpdu7tqi16b"><span>Second run 33rps max</span></h4><p class="msg msg--info"><span>rampUsers(10).during(60.seconds), // increase users to 10 in 60 sec<br>constantUsersPerSec(10).during(60.seconds), // keep 10 users for 60 sec<br>rampUsersPerSec(10).to(30).during(4.minutes), // increase users to 30 in 4 min<br></span></p><figure class="post__image post__image--center"><span><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.24.14.png" alt="" width="1196" height="470" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.14-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.14-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.14-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.14-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.14-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.14-2xl.webp 1600w" layout="responsive"></amp-img></span></figure><p></p><figure class="post__image post__image--center"><span><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.24.22.png" alt="" width="1198" height="282" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.22-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.22-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.22-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.22-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.22-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.22-2xl.webp 1600w" layout="responsive"></amp-img></span></figure><p></p><figure class="post__image post__image--center"><span><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.24.30.png" alt="" width="1162" height="428" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.30-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.30-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.30-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.30-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.30-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.30-2xl.webp 1600w" layout="responsive"></amp-img></span></figure><p></p><figure class="post__image post__image--center"><span><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.24.39.png" alt="" width="1190" height="480" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.39-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.39-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.39-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.39-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.39-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.39-2xl.webp 1600w" layout="responsive"></amp-img></span></figure><p></p><figure class="post__image post__image--center"><span><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.24.46.png" alt="" width="1194" height="480" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.46-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.46-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.46-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.46-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.46-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.24.46-2xl.webp 1600w" layout="responsive"></amp-img></span></figure><p></p><p><span>Really better, we can say that the MAX rps is 33 ... this valid <i>one-shot</i> in a single run</span></p><p> </p><h3 id="mcetoc_1gpduj9db16h"><span>AUTOSCALING</span></h3><p class="msg msg--info"><span><span> rampUsers(10).during(60.seconds), // increase users to 10 in 60 sec<br></span><span> constantUsersPerSec(10).during(60.seconds), // keep 10 users for 60sec<br></span><span> rampUsersPerSec(10).to(99).during(15.minutes), // increase users to 99 in 15 min</span></span></p><p> </p><h4 id="mcetoc_1gpduui3818q"><span>1 pod start - hpa 33rps - 15 min - 99 max requests</span></h4><figure class="post__image post__image--center"><span><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.30.24.png" alt="" width="1194" height="250" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.30.24-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.30.24-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.30.24-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.30.24-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.30.24-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.30.24-2xl.webp 1600w" layout="responsive"></amp-img></span></figure><br><span><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.30.30.png" alt="" width="1192" height="430" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.30.30-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.30.30-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.30.30-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.30.30-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.30.30-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.30.30-2xl.webp 1600w" layout="responsive"></amp-img></figure></span><br><span>DEAD !!! </span><br><br><span>Test stopped as per ...</span><p></p><p class="msg msg--warning"><span><span>================================================================================<br></span><span>2023-02-09 10:01:38                                         885s elapsed<br></span><span>---- Requests ------------------------------------------------------------------<br></span><span>&gt; Global                                                   (OK=17944  KO=18236 )<br></span><span>&gt; request_1                                                (OK=17944  KO=18236 )<br></span><span>---- Errors --------------------------------------------------------------------<br></span><span>&gt; status.find.in(200,201,202,203,204,205,206,207,208,209,304), f   8358 (45.83%)f</span><span>ound 503<br></span><span>&gt; status.find.in(200,201,202,203,204,205,206,207,208,209,304), f   5529 (30.32%)f</span><span>ound 502<br></span><span>&gt; status.find.in(200,201,202,203,204,205,206,207,208,209,304), f   4273 (23.43%)f</span><span>ound 504<br></span><span>&gt; i.g.h.c.i.RequestTimeoutException: Request timeout to oracolo.     73 ( 0.40%)<br></span><span>&gt; j.i.IOException: Premature close                                    3 ( 0.02%)<br></span><span>---- BasicSimulation -----------------------------------------------------------<br></span><span>[#####################################################--                   ] 72%<br></span><span>waiting: 12549  / active: 932    / done: 36180<br></span><span>================================================================================</span></span></p><p> </p><h4 id="mcetoc_1gpdvmntb1ba"><span>2 pod start - hpa 33rps - 15 min - 99 max requests</span></h4><figure class="post__image post__image--center"><span>Autoscaler is not able to support the traffic in the picture before , the curve is stressing the namespace in a way to make impossible the scaling and reliability, this can be by a single pod start and ratio of requests absorbed, let’s try starting with 2 , it’s supposed in that way to have half of the requests to absorb each one<br><br><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.41.18.png" alt="" width="1194" height="474" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.18-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.18-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.18-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.18-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.18-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.18-2xl.webp 1600w" layout="responsive"></amp-img></span></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.41.29.png" alt="" width="1196" height="274" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.29-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.29-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.29-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.29-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.29-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.29-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.41.37.png" alt="" width="1182" height="434" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.37-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.37-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.37-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.37-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.37-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.37-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.41.44.png" alt="" width="1194" height="484" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.44-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.44-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.44-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.44-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.44-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.44-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.41.52.png" alt="" width="1194" height="472" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.52-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.52-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.52-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.52-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.52-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.41.52-2xl.webp 1600w" layout="responsive"></amp-img></figure><br>Naaaa... still not able to scale <p></p><p><br><br></p><h4 id="mcetoc_1gpdvne631bd"><span>1 pod start - hpa 30rps - 15 min - 99 max requests</span></h4><figure class="post__image post__image--center"><span><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.44.45.png" alt="" width="1198" height="472" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.44.45-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.44.45-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.44.45-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.44.45-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.44.45-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.44.45-2xl.webp 1600w" layout="responsive"></amp-img></span></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.44.57.png" alt="" width="1132" height="318" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.44.57-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.44.57-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.44.57-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.44.57-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.44.57-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.44.57-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.45.03.png" alt="" width="1124" height="466" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.03-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.03-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.03-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.03-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.03-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.03-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.45.10.png" alt="" width="1198" height="480" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.10-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.10-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.10-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.10-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.10-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.10-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.45.17.png" alt="" width="1192" height="480" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.17-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.17-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.17-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.17-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.17-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.45.17-2xl.webp 1600w" layout="responsive"></amp-img></figure><br>Ok we are able to scale but at the end we have a complete crash<p></p><h4 id="mcetoc_1gpe003lg1ci"><span><br>1 pod start - hpa 27rps - 15 min - 99 max requests</span></h4><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.53.36.png" alt="" width="1194" height="470" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.36-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.36-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.36-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.36-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.36-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.36-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.53.43.png" alt="" width="1198" height="300" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.43-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.43-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.43-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.43-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.43-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.43-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.53.51.png" alt="" width="1122" height="412" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.51-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.51-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.51-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.51-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.51-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.51-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.53.58.png" alt="" width="1202" height="472" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.58-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.58-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.58-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.58-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.58-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.53.58-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.54.07.png" alt="" width="1198" height="476" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.54.07-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.54.07-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.54.07-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.54.07-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.54.07-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.54.07-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><span>Oh noooo ... worse than before with fewer rps ... since we are over-stressed when start to crash can have weird behaviour  </span><p></p><p> </p><h4 id="mcetoc_1gpe0j6931f3"><span> [optimal] 1 pod start - hpa 24rps - 15 min - 99 max requests</span></h4><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.58.23.png" alt="" width="1196" height="468" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.23-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.23-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.23-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.23-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.23-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.23-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.58.33.png" alt="" width="1198" height="294" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.33-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.33-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.33-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.33-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.33-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.33-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.58.41.png" alt="" width="1194" height="434" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.41-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.41-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.41-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.41-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.41-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.41-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.58.51.png" alt="" width="1196" height="466" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.51-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.51-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.51-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.51-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.51-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.51-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-21.58.58.png" alt="" width="1198" height="472" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.58-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.58-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.58-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.58-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.58-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-21.58.58-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><span>Here we are !!!</span><p></p><p> </p><h4 id="mcetoc_1gpe0j6931f4"><span>1 pod start - hpa 25rps - 15 min - 99 max requests</span></h4><p>let's try with one more</p><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.00.50.png" alt="" width="1194" height="464" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.00.50-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.00.50-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.00.50-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.00.50-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.00.50-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.00.50-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.00.59.png" alt="" width="1196" height="310" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.00.59-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.00.59-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.00.59-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.00.59-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.00.59-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.00.59-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.01.06.png" alt="" width="1188" height="422" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.06-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.06-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.06-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.06-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.06-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.06-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.01.15.png" alt="" width="1192" height="486" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.15-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.15-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.15-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.15-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.15-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.15-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.01.22.png" alt="" width="1202" height="478" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.22-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.22-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.22-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.22-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.22-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.01.22-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><span>Naaaa .... no more than 24 rps</span><p></p><p> </p><h3 id="mcetoc_1gpe0j6931f5"><span>AUTOSCALING Internal rate limit</span></h3><p><span><a href="https://www.k8s.it/application-rate-limiting.html" target="_blank" rel="noopener noreferrer">Here how to</a></span></p><h4 id="mcetoc_1gpe0pd9t1fm"><span>[optimal] 1 pod start - hpa 25rps</span><span>- 15 min - 99 max requests rate-limit 27</span></h4><p><span><span>I suppose that the </span><em><span>optimal</span></em><span>  before (24rps) is working good also with RL so let’s start with 25</span></span></p><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.08.07.png" alt="" width="1198" height="622" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.07-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.07-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.07-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.07-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.07-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.07-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.08.14.png" alt="" width="1194" height="334" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.14-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.14-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.14-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.14-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.14-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.14-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.08.20.png" alt="" width="1130" height="448" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.20-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.20-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.20-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.20-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.20-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.20-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.08.29.png" alt="" width="1192" height="468" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.29-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.29-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.29-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.29-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.29-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.29-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.08.34.png" alt="" width="1200" height="472" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.34-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.34-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.34-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.34-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.34-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.08.34-2xl.webp 1600w" layout="responsive"></amp-img></figure><p><span><span>Better than the same rps with no ratelimit<br></span></span></p><p><span>The errors are just the 429 triggered by rate limit … so the good answer are ok and no issue or restart on the application during the autoscaling… a bit of queue</span></p><p><span>No so bad considering the errors in red as just rate limited calls</span></p><p> </p><h4 id="mcetoc_1gpe1laq11pb"><span>1 pod start - hpa 26rps - 15 min - 99 max requests rate-limit 28</span></h4><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.11.25.png" alt="" width="1200" height="650" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.25-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.25-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.25-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.25-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.25-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.25-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.11.33.png" alt="" width="1198" height="294" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.33-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.33-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.33-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.33-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.33-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.33-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.11.41.png" alt="" width="1114" height="418" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.41-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.41-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.41-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.41-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.41-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.41-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.11.49.png" alt="" width="1194" height="474" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.49-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.49-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.49-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.49-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.49-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.49-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.11.56.png" alt="" width="1196" height="472" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.56-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.56-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.56-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.56-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.56-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.11.56-2xl.webp 1600w" layout="responsive"></amp-img></figure><p><span>Just one error for pod unresponsive</span></p><p> </p><h4 id="mcetoc_1gpe1laq11pc"><span>1 pod start - hpa 27rps - 15 min - 99 max requests rate-limit 29</span></h4><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.13.57.png" alt="" width="1196" height="770" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.13.57-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.13.57-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.13.57-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.13.57-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.13.57-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.13.57-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.14.08.png" alt="" width="1112" height="266" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.08-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.08-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.08-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.08-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.08-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.08-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.14.14.png" alt="" width="1094" height="422" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.14-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.14-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.14-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.14-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.14-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.14-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.14.21.png" alt="" width="1192" height="478" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.21-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.21-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.21-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.21-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.21-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.21-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.14.28.png" alt="" width="1198" height="458" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.28-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.28-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.28-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.28-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.28-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.14.28-2xl.webp 1600w" layout="responsive"></amp-img></figure><br>Broken!!!<p></p><p> </p><h3 id="mcetoc_1gpe1laq11pd"><span>AUTOSCALING envoy rate limit</span></h3><h4 id="mcetoc_1gpe1laq11pe"><span>1 pod start - hpa 27rps - 15 min - 99 max requests rate-limit 29 - envoy</span></h4><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.17.26.png" alt="" width="1190" height="706" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.26-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.26-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.26-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.26-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.26-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.26-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.17.33.png" alt="" width="1122" height="258" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.33-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.33-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.33-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.33-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.33-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.33-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.17.39.png" alt="" width="1098" height="412" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.39-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.39-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.39-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.39-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.39-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.39-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.17.46.png" alt="" width="1196" height="472" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.46-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.46-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.46-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.46-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.46-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.46-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.17.53.png" alt="" width="1196" height="474" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.53-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.53-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.53-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.53-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.53-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.17.53-2xl.webp 1600w" layout="responsive"></amp-img></figure><br>Broken!!!<p></p><p> </p><h4 id="mcetoc_1gpe1laq11pf"><span>[optimal] 1 pod start - hpa 26rps - 15 min - 99 max requests rate-limit 29 - envoy</span></h4><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.19.24.png" alt="" width="1188" height="602" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.24-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.24-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.24-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.24-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.24-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.24-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.19.30.png" alt="" width="1194" height="300" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.30-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.30-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.30-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.30-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.30-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.30-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.19.38.png" alt="" width="1176" height="428" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.38-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.38-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.38-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.38-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.38-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.38-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.19.46.png" alt="" width="1176" height="472" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.46-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.46-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.46-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.46-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.46-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.46-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.19.52.png" alt="" width="1182" height="478" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.52-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.52-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.52-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.52-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.52-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.19.52-2xl.webp 1600w" layout="responsive"></amp-img></figure><p><span>Better than expected compared to the solution with rate limit embedded </span></p><p> </p><h3 id="mcetoc_1gpe1laq11pg"><span>Unexpected traffic</span></h3><p class="msg msg--info"><span>rampUsers(30).during(60.seconds),<br></span><span>constantUsersPerSec(30).during(60.seconds).randomized, <br></span><span>rampUsersPerSec(30).to(82).during(4.minutes), <br></span><span>constantUsersPerSec(82).during(120.seconds).randomized,<br></span><span>rampUsersPerSec(82).to(170).during(10.seconds),<br></span><span>constantUsersPerSec(82).during(120.seconds).randomized,<br></span><span>rampUsersPerSec(82).to(130).during(20.seconds),<br></span><span>constantUsersPerSec(82).during(120.seconds).randomized,<br></span><span>rampUsersPerSec(82).to(210).during(30.seconds),<br></span><span>constantUsersPerSec(82).during(120.seconds).randomized,<br></span><span>constantUsersPerSec(333).during(2.seconds),<br></span><span>constantUsersPerSec(82).during(120.seconds).randomized,<br></span><span>constantUsersPerSec(333).during(10.seconds),<br></span><span>constantUsersPerSec(82).during(80.seconds)</span></p><p><span><span> </span></span></p><h4 id="mcetoc_1gpe2t9fu2jk"><span>3 pod start - hpa 26rps - 15 min - 82 avg requests with spikes -  rate-limit 27 internal</span></h4><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.25.08.png" alt="" width="1194" height="714" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.08-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.08-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.08-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.08-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.08-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.08-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.25.15.png" alt="" width="1192" height="238" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.15-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.15-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.15-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.15-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.15-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.15-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.25.22.png" alt="" width="1148" height="462" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.22-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.22-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.22-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.22-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.22-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.22-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.25.29.png" alt="" width="1194" height="482" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.29-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.29-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.29-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.29-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.29-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.29-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.25.36.png" alt="" width="1200" height="484" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.36-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.36-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.36-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.36-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.36-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.25.36-2xl.webp 1600w" layout="responsive"></amp-img></figure><p><span>Since the incoming requests are absorbed from the app we reach the limit</span><br><span>Errors are not only 429 as rate but 5xx</span></p><p><span>Broken!!!</span></p><p> </p><h4 id="mcetoc_1gpe2t9fu2jl"><span>[optimal] 3 pod start - hpa 26rps - 15 min - 82 avg requests with spikes -  rate-limit 27 - envoy</span></h4><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.27.32.png" alt="" width="1192" height="594" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.32-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.32-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.32-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.32-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.32-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.32-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.27.40.png" alt="" width="1196" height="234" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.40-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.40-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.40-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.40-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.40-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.40-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.27.46.png" alt="" width="1200" height="422" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.46-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.46-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.46-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.46-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.46-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.46-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.27.54.png" alt="" width="1202" height="472" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.54-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.54-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.54-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.54-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.54-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.27.54-2xl.webp 1600w" layout="responsive"></amp-img></figure><br><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.28.01.png" alt="" width="1204" height="478" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.28.01-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.28.01-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.28.01-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.28.01-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.28.01-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.28.01-2xl.webp 1600w" layout="responsive"></amp-img></figure><p><span>No issue at all , since the rl is performed by envoy the python app has no “spikes”</span></p><p> </p><p> </p><h3 id="mcetoc_1gpe2t9fu2jm"><span>Conclusions</span></h3><h4 id="mcetoc_1gpe2t9fu2jn"><span>HPA</span></h4><p><span>This application is cpu bound … so I used req/s even if the right autoscaling metric is the cpu usage, however, I would say that each application has the intent to serve requests.</span><span><br></span><span><span>Create a dedicated configuration, application per application, for the hpa is the best option</span> but it requires <strong>HUGE</strong> know-how and time …</span><span><br></span><span>Considering the sentence before, I was impressed about </span><a href="https://gatling.io/docs/gatling/reference/current/stats/reports/#:~:text=%E2%80%9CActive%20users%E2%80%9D%20is%20neither%20%E2%80%9C,load%20at%20a%20given%20second%E2%80%9D."><span>Active users</span></a><span>  since share the correct clue at high levels about the status of the application, it’s really really close to measuring the enervation of the app</span></p><figure class="post__image post__image--center"><amp-img src="https://www.k8s.it/media/posts/43/Screenshot-2023-02-16-at-22.30.45.png" alt="" width="1200" height="474" sizes="100vw" srcset="https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.30.45-xs.webp 300w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.30.45-sm.webp 480w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.30.45-md.webp 768w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.30.45-lg.webp 1024w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.30.45-xl.webp 1360w ,https://www.k8s.it/media/posts/43/responsive/Screenshot-2023-02-16-at-22.30.45-2xl.webp 1600w" layout="responsive"></amp-img></figure><p><span>I would say that the concept of active users as a HPA metric is better than <span>flask_http_request_duration_seconds_count</span></span></p><p><span><span>Even if we can reach 33rps in a single pod , we should consider that in an autoscaling scenario this will be reduced to </span><strong>less, </strong><span>cause for a certain amount of time we have more requests till we are waiting for new pods/node etc etc </span></span></p><p><span>I would say that is better to have an application running at 65% of max capacity before scale</span></p><p> </p><h4 id="mcetoc_1gpe2t9fu2jo"><span>Rate Limit</span></h4><p><br><i></i></p><ul><li aria-level="1"><i><span>Understand how much we can close with the application enervation during an autoscaling situation using rate limit</span></i></li></ul><p><strong>No</strong><span> … or better … we can increase a bit the limit to exploit the app at max possible, however, it’s just a risk for 5% more in rps.</span><span><br></span><span>The application will be more sensible and the rl is really close to the hpa</span></p><p> </p><ul><li aria-level="1"><span>Understand how to handle unexpected traffic with a rate limit</span></li></ul><p><strong>Yes </strong><span>… this pattern is the right one for the rate limit</span><span><br></span><span>Better is to perform this action outside the application container since will impact unfortunately the incoming requests, the saturation etc etc and you have rl and hpa that can fight each other </span></p><p> </p><h4 id="mcetoc_1gpe2t9fu2jp"><span>Both</span></h4><ul><li aria-level="1"><span>Do not force hpa to collaborate with rl … should be 2 different parameters</span></li></ul><p><span>In this scenario are both rps ... but are profiled in a different way , so do not consider as the same metric or meaning</span></p><p> </p><h4 id="mcetoc_1gpe2t9fu2jq"><span>Costs</span></h4><p> </p><p><span>In some way trying to save money by increasing to the possible max rps is risky, we should leverage the kubernetes pod scheduling more than try to reach 100% of the application</span></p><h5 id="mcetoc_1gpe2t9fu2jr"><span>Highlights</span></h5><p><span>Unexpected traffic can be something that is generated for a wrong deployment/batch 5% of cases or by external calls 95%</span></p><p><span>The external calls come from public or private endpoints can be managed by<br></span></p><ul><li>waf rate limit</li><li>api gateway rate limit</li></ul><p><span>Those two solutions are better, cause they can keep the infrastructure safe as a first point of contact but ... </span><span>A big </span><strong>BUT</strong></p><p><span>In a dynamic infrastructure where we have autoscaling and downscaling,  a legit peak like </span><span>google scrape </span><span>is not possible to handle, cause the RL is service level <br></span><strong>AND…</strong><span> <br></span><span>during the night, it's supposed to have the minimum pods available as there is less user traffic for example.</span></p><p> </p><p><span>So … <span>I’ll remark on the drawback of cost savings</span> following the </span><span>matrix based on hpa patterns</span><span> (cit </span><a href="https://www.imdb.com/title/tt0088850/"><span>brewster's millions</span></a><span>)<br></span>As much as we are close to using fewer resources as possible, as much we are increasing corner cases and unexpected situations.<br><br>Be careful to evaluate the rate limit concept </p><p>Cheers :-) </p><p> </p><p> </p><p> </p><aside><ul class="post-tag"><li><a href="https://www.k8s.it/amp/cost-saving/">cost saving</a></li><li><a href="https://www.k8s.it/amp/dynamic-infrastructure/">dynamic infrastructure</a></li><li><a href="https://www.k8s.it/amp/envoy/">envoy</a></li><li><a href="https://www.k8s.it/amp/hpa/">hpa</a></li><li><a href="https://www.k8s.it/amp/rate-limit-vs-hpa/">rate limit vs hpa</a></li><li><a href="https://www.k8s.it/amp/rate-limiting/">rate-limiting</a></li></ul><div class="post-share"><amp-social-share type="system" width="40" height="40" data-param-text="HPA vs Rate-limit"></amp-social-share><amp-social-share type="facebook" width="40" height="40" data-param-app_id="" data-param-text="HPA vs Rate-limit" data-param-href="https://www.k8s.it/amp/hpa-vs-rate-limit.html"></amp-social-share><amp-social-share type="twitter" width="40" height="40" data-param-text="HPA vs Rate-limit" data-param-url="https://www.k8s.it/amp/hpa-vs-rate-limit.html"></amp-social-share><amp-social-share type="pinterest" width="40" height="40" data-param-url="https://www.k8s.it/amp/hpa-vs-rate-limit.html"></amp-social-share><amp-social-share type="tumblr" width="40" height="40" data-param-text="HPA vs Rate-limit" data-param-url="https://www.k8s.it/amp/hpa-vs-rate-limit.html"></amp-social-share><amp-social-share type="whatsapp" width="40" height="40" data-param-text="HPA vs Rate-limit" data-param-url="https://www.k8s.it/amp/hpa-vs-rate-limit.html"></amp-social-share></div></aside></div></article><nav class="post-pagination wrap-inner"><div class="post-pagination-prev"><span>Previous</span> <a href="https://www.k8s.it/amp/application-rate-limiting.html">application rate limit </a></div></nav></main><amp-animation id="showAnim" layout="nodisplay"><script type="application/json">{
                    "duration": "200ms",
                    "fill": "both",
                    "iterations": "1",
                    "direction": "alternate",
                    "animations": [{
                        "selector": ".post-scroll",
                        "keyframes": [{
                            "opacity": "1",
                            "visibility": "visible",
                            "transform": "scale(1)"
                        }]
                    }]
                }</script></amp-animation><amp-animation id="hideAnim" layout="nodisplay"><script type="application/json">{
                    "duration": "200ms",
                    "fill": "both",
                    "iterations": "1",
                    "direction": "alternate",
                    "animations": [{
                        "selector": ".post-scroll",
                        "keyframes": [{
                            "opacity": "0",
                            "visibility": "hidden",
                            "transform": "scale(0.1)"
                        }]
                    }]
                }</script></amp-animation><div class="post-scroll-marker"><amp-position-observer on="enter:hideAnim.start; exit:showAnim.start" layout="nodisplay"></amp-position-observer></div><button class="post-scroll" on="tap:top.scrollTo(duration=200)">&#8593;</button><footer class="bottom">Powered by Publii</footer><amp-sidebar id="navbar-sidebar" layout="nodisplay"><ul><li><a href="https://www.linkedin.com/in/lgirardi/">linkedin</a></li><li><a href="https://services.k8s.it/grafana/?orgId&#x3D;2">live monitoring</a></li><li><a href="https://www.k8s.it/amp/whoami.html">whoami</a></li><li><a href="https://www.k8s.it/amp/hobbies.html">hobbies</a></li></ul></amp-sidebar></body></html>