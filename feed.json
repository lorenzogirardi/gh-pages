{
    "version": "https://jsonfeed.org/version/1",
    "title": "LAB",
    "description": "",
    "home_page_url": "https://www.k8s.it",
    "feed_url": "https://www.k8s.it/feed.json",
    "user_comment": "",
    "author": {
        "name": "lgirardi"
    },
    "items": [
        {
            "id": "https://www.k8s.it/homelab-when-small-is-big.html",
            "url": "https://www.k8s.it/homelab-when-small-is-big.html",
            "title": "Homelab , when small is big",
            "summary": "When I started getting interested on the IT world , i've usually kept all my devices on 24 h to 24. The first labs was an impressive tower in '99 with a huge amount of disk and memory banks, a good cpu cooled by a&hellip;",
            "content_html": "<p>When I started getting interested on the IT world , i've usually kept all my devices on 24 h to 24.</p>\n<p>The first labs was an impressive tower in '99 with a huge amount of disk and memory banks, a good cpu cooled by a giant copper heatsink combined with a 12cm fan.<br>All those components were quite similar to a helicopter noise during the night.</p>\n<p>The evolution of the lab than , changed a lot year by year , not only reaching a good level of noise but mostly to be cost effective hardware that guarantee new a semplificate production environment.</p>\n<p>Now some goals has changed compared with the '99 approach so let's summarize the lab expectations:</p>\n<ul>\n<li>Cheap hardwareÂ </li>\n<li>NoiselessÂ </li>\n<li>TDP under 20w</li>\n<li>24/24 uptime</li>\n<li>Virtualization supportÂ </li>\n<li>Enough to have a Kubernetes installation</li>\n<li>Backup solution</li>\n<li>Automation readyÂ </li>\n</ul>\n<p>Â </p>\n<p>Let's now explain the needs behind,<br>i'd like to have a solution that is able to cover all my needs in terms of hobby and experiments, i don't need power , since i take care to the goodness of the solution instead the absolute performance.</p>\n<h3>Hardware</h3>\n<p>Base: <a href=\"https://ark.intel.com/content/www/us/en/ark/products/126137/intel-nuc-kit-nuc7pjyh.html\" target=\"_blank\" rel=\"noopener noreferrer\">IntelÂ® NUC NUC7PJYH</a></p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/24/Screenshot-2021-02-19-at-16.39.21-2.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.39.21-2-xs.png 300w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.39.21-2-sm.png 480w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.39.21-2-md.png 768w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.39.21-2-lg.png 1024w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.39.21-2-xl.png 1360w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.39.21-2-2xl.png 1600w\"  alt=\"\" width=\"820\" height=\"594\"></figure>\n<p>RAM: even if the website is reporting 8gb max... this is not true<br>on my installation i have 16GB with G.Skill Ripjaws SO-DIMM 16GB DDR4-2400Mhz 2x8GB</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/24/Screenshot-2021-02-19-at-16.39.50-2.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.39.50-2-xs.png 300w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.39.50-2-sm.png 480w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.39.50-2-md.png 768w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.39.50-2-lg.png 1024w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.39.50-2-xl.png 1360w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.39.50-2-2xl.png 1600w\"  alt=\"\" width=\"820\" height=\"743\"></figure>\n<p>CPU: j5005 i thinks is the best tdp/performance (here compared to the old q6600 the first intel quadcore ever)</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/24/j5005vsq6600.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/24/responsive/j5005vsq6600-xs.png 300w ,https://www.k8s.it/media/posts/24/responsive/j5005vsq6600-sm.png 480w ,https://www.k8s.it/media/posts/24/responsive/j5005vsq6600-md.png 768w ,https://www.k8s.it/media/posts/24/responsive/j5005vsq6600-lg.png 1024w ,https://www.k8s.it/media/posts/24/responsive/j5005vsq6600-xl.png 1360w ,https://www.k8s.it/media/posts/24/responsive/j5005vsq6600-2xl.png 1600w\"  alt=\"\" width=\"820\" height=\"1321\"></figure>\n<p>DISK: 250gb with ocz vertex4 are a good starting pointÂ </p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/24/Screenshot-2021-02-19-at-16.40.09.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.40.09-xs.png 300w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.40.09-sm.png 480w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.40.09-md.png 768w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.40.09-lg.png 1024w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.40.09-xl.png 1360w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-16.40.09-2xl.png 1600w\"  alt=\"\" width=\"820\" height=\"748\"></figure>\n<p>Â </p>\n<h3>Software</h3>\n<p>Base os vmware esxi 6.7 (free/essential)</p>\n<p>Now:</p>\n<p><strong>Why</strong> vmware?<br>Because the virtualization stack is really important to have an abstraction layer ,<br>see this <a href=\"https://www.k8s.it/kubernetes-destroyed-the-virtualization-or-not.html\">post</a>Â </p>\n<p><strong>Why</strong> 6.7?<br>Because the vmkernel in 7.0 is changed and is not possible import external network driver (needed for this nuc model), even if there is a trick with usb network adapter and <a href=\"https://flings.vmware.com/usb-network-native-driver-for-esxi\">https://flings.vmware.com/usb-network-native-driver-for-esxi</a> vmware labs usb drivers.</p>\n<p><strong>How</strong> build the image with Realtek network card ?<br>First of all you need a windows :( , than you should need to identify your hardware driver , in my case <a href=\"https://vibsdepot.v-front.de/wiki/index.php/Net55-r8168\">https://vibsdepot.v-front.de/wiki/index.php/Net55-r8168</a> and at the end you need to rebuild the image with <a href=\"https://www.v-front.de/p/esxi-customizer-ps.html\" target=\"_blank\" rel=\"noopener noreferrer\">ESXi-Customizer-PS</a></p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/24/Screenshot-2021-02-19-at-17.16.41.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.16.41-xs.png 300w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.16.41-sm.png 480w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.16.41-md.png 768w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.16.41-lg.png 1024w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.16.41-xl.png 1360w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.16.41-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"497\"></figure>\n<p><strong>What</strong> we can do with this \"toy\"?<br>Well more or less everything you are doing in your datacenter, using packer and ansible for the installation and vm configuration , you can boostrap a k3s cluster or a microk8s standalone kubernetes, few virtualmachines and so on.<br><br><strong>But</strong> is small compared to a server !1!1!Â <br>different needs , different size ( but same mindset in terms of reliability , flexibility , usability)... however this is my current usage</p>\n<p>4 VMS:</p>\n<ul>\n<li>microk8s installationÂ </li>\n<li>monitoring infrastructure</li>\n<li>windows active directory</li>\n<li>console vm (usually used as ephemeral environment)</li>\n</ul>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/24/Screenshot-2021-02-19-at-17.26.10.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.26.10-xs.png 300w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.26.10-sm.png 480w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.26.10-md.png 768w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.26.10-lg.png 1024w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.26.10-xl.png 1360w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.26.10-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"89\"></figure>\n<p>Â </p>\n<p>If you have some doubts about the possibility to run kubernetes in a <em>toyÂ </em>, is the base that i used for all my posts</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/24/Screenshot-2021-02-19-at-17.30.13.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.30.13-xs.png 300w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.30.13-sm.png 480w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.30.13-md.png 768w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.30.13-lg.png 1024w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.30.13-xl.png 1360w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.30.13-2xl.png 1600w\"  alt=\"\" width=\"820\" height=\"529\"></figure>\n<p>Â </p>\n<h3>Monitoring</h3>\n<p>Well again grafana and influxdb are supporting me</p>\n<p>HOST<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/24/Screenshot-2021-02-19-at-17.34.04.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.34.04-xs.png 300w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.34.04-sm.png 480w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.34.04-md.png 768w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.34.04-lg.png 1024w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.34.04-xl.png 1360w ,https://www.k8s.it/media/posts/24/responsive/Screenshot-2021-02-19-at-17.34.04-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"485\"></figure>\n<p>VMS</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/24/vmsgrafana.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/24/responsive/vmsgrafana-xs.png 300w ,https://www.k8s.it/media/posts/24/responsive/vmsgrafana-sm.png 480w ,https://www.k8s.it/media/posts/24/responsive/vmsgrafana-md.png 768w ,https://www.k8s.it/media/posts/24/responsive/vmsgrafana-lg.png 1024w ,https://www.k8s.it/media/posts/24/responsive/vmsgrafana-xl.png 1360w ,https://www.k8s.it/media/posts/24/responsive/vmsgrafana-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"1601\"></figure>\n<p>Â </p>\n<h3>Backup</h3>\n<p><strong>Why</strong> backup?<br>Because even if the env is automated, some data are inside the vms and i'd like to play with the env and if needed restore the previous snapshot.</p>\n<p>Again another free tool is helping me <a href=\"https://github.com/lamw/ghettoVCB\">https://github.com/lamw/ghettoVCB</a></p>\n<p>It's a quite simple script that i used for non production environment since the beginning.</p>\n<p>In the main path i've created a <em>script</em> folder with ghetto inside and other stuff like packer firewall rules</p>\n<p><code>[root@amaterasu:/vmfs/volumes/5eafe677-1260d7e8-2521-94c691a54f7d/script] ls -la<br>total 2240<br>drwxr-xr-x Â  Â 1 root Â  Â  root Â  Â  Â  Â  73728 May Â 6 Â 2020 .<br>drwxr-xr-t Â  Â 1 root Â  Â  root Â  Â  Â  Â  77824 Dec 28 10:51 ..<br>-rw-r--r-- Â  Â 1 root Â  Â  root Â  Â  Â  Â  Â  577 May Â 4 Â 2020 email.xml<br>-rwxr-xr-x Â  Â 1 root Â  Â  root Â  Â  Â  Â  17207 May Â 4 Â 2020 ghettoVCB-restore.sh<br>-rw-r--r-- Â  Â 1 root Â  Â  root Â  Â  Â  Â  Â  309 May Â 4 Â 2020 ghettoVCB-restore_vm_restore_configuration_template<br>-rw-r--r-- Â  Â 1 root Â  Â  root Â  Â  Â  Â  Â  356 May Â 4 Â 2020 ghettoVCB-vm_backup_configuration_template<br>-rw-r--r-- Â  Â 1 root Â  Â  root Â  Â  Â  Â  Â  832 May 10 Â 2020 ghettoVCB.conf<br>-rwxr-xr-x Â  Â 1 root Â  Â  root Â  Â  Â  Â  72122 May Â 4 Â 2020 ghettoVCB.sh<br>-rwxr-xr-x Â  Â 1 root Â  Â  root Â  Â  Â  Â  Â  404 May 12 Â 2020 init.sh<br>-rw-r--r-- Â  Â 1 root Â  Â  root Â  Â  Â  Â  Â  372 May Â 4 Â 2020 packer.xml</code></p>\n<p>The init.sh files should be added on local.sh to have it running on all machine startupÂ <br><code>[root@amaterasu:/vmfs/volumes/5eafe677-1260d7e8-2521-94c691a54f7d/script] cat /etc/rc.local.d/local.sh<br>#!/bin/sh<br><br># local configuration options<br><br># Note: modify at your own risk! Â If you do/use anything in this<br># script that is not part of a stable API (relying on files to be in<br># specific places, specific tools, specific output, etc) there is a<br># possibility you will end up with a broken system after patching or<br># upgrading. Â Changes are not supported unless under direction of<br># VMware support.<br><br># Note: This script will not be run when UEFI secure boot is enabled.<br><br>sh -x /vmfs/volumes/amaterasu-datastore/script/init.sh<br><br>exit 0</code></p>\n<p>... on the init file you need to apply all changes to have the ghetto running in crontab</p>\n<p><code>[root@amaterasu:/vmfs/volumes/5eafe677-1260d7e8-2521-94c691a54f7d/script] cat init.sh<br>#!/bin/bash<br>cp /vmfs/volumes/amaterasu-datastore/script/email.xml /etc/vmware/firewall/<br>cp /vmfs/volumes/amaterasu-datastore/script/packer.xml /etc/vmware/firewall/<br>esxcli network firewall refresh<br>echo \"0 22 * * 6 /vmfs/volumes/amaterasu-datastore/script/ghettoVCB.sh -a -g /vmfs/volumes/amaterasu-datastore/script/ghettoVCB.conf<br>\" &gt;&gt; Â /var/spool/cron/crontabs/root<br>kill $(cat /var/run/crond.pid)<br>crond</code></p>\n<p>it is missing only the ghettoVCB.conf configuration that depends on your needs</p>\n<p><code>[root@amaterasu:/vmfs/volumes/5eafe677-1260d7e8-2521-94c691a54f7d/script] cat ghettoVCB.conf<br>DISK_BACKUP_FORMAT=thin<br>VM_BACKUP_ROTATION_COUNT=3<br>POWER_VM_DOWN_BEFORE_BACKUP=0<br>ENABLE_HARD_POWER_OFF=0<br>ITER_TO_WAIT_SHUTDOWN=3<br>POWER_DOWN_TIMEOUT=5<br>ENABLE_COMPRESSION=0<br>VM_SNAPSHOT_MEMORY=0<br>VM_SNAPSHOT_QUIESCE=0<br>ALLOW_VMS_WITH_SNAPSHOTS_TO_BE_BACKEDUP=0<br>ENABLE_NON_PERSISTENT_NFS=1<br>UNMOUNT_NFS=1<br>NFS_SERVER=192.168.1.13<br>NFS_VERSION=nfs<br>NFS_MOUNT=/export/backup<br>NFS_LOCAL_NAME=nfs_storage_backup<br>NFS_VM_BACKUP_DIR=amaterasu<br>ENABLE_NFS_IO_HACK=1<br>NFS_IO_HACK_LOOP_MAX=10<br>NFS_IO_HACK_SLEEP_TIMER=60<br>SNAPSHOT_TIMEOUT=15<br>EMAIL_ALERT=0<br>EMAIL_LOG=1<br>EMAIL_SERVER=smtp.k8s.it<br>EMAIL_SERVER_PORT=25<br>EMAIL_DELAY_INTERVAL=1<br>EMAIL_USER_NAME=<br>EMAIL_USER_PASSWORD=<br>EMAIL_TO=backup@xxs.it<br>EMAIL_ERRORS_TO=backup@xxs.it<br>EMAIL_FROM=ghettoVCB-amaterasu@xxs.it<br>WORKDIR_DEBUG=0<br>VM_SHUTDOWN_ORDER=<br>VM_STARTUP_ORDER=</code></p>\n<p>And ... well thats all ... you have your weekly snapshotÂ <br><code>2021-02-13 22:00:00 -- info: ============================== ghettoVCB LOG START ==============================<br><br>2021-02-13 22:00:01 -- info: CONFIG - USING GLOBAL GHETTOVCB CONFIGURATION FILE = /vmfs/volumes/amaterasu-datast<wbr>ore/script/ghettoVCB.conf<br>2021-02-13 22:00:01 -- info: CONFIG - VERSION = 2019_01_06_4<br>2021-02-13 22:00:01 -- info: CONFIG - GHETTOVCB_PID = 2250208<br>2021-02-13 22:00:01 -- info: CONFIG - VM_BACKUP_VOLUME = /vmfs/volumes/nfs_storage_back<wbr>up/amaterasu<br>2021-02-13 22:00:01 -- info: CONFIG - ENABLE_NON_PERSISTENT_NFS = 1<br>2021-02-13 22:00:01 -- info: CONFIG - UNMOUNT_NFS = 1<br>2021-02-13 22:00:01 -- info: CONFIG - NFS_SERVER = 192.168.1.13<br>2021-02-13 22:00:01 -- info: CONFIG - NFS_VERSION = nfs<br>2021-02-13 22:00:01 -- info: CONFIG - NFS_MOUNT = /export/backup<br>2021-02-13 22:00:01 -- info: CONFIG - VM_BACKUP_ROTATION_COUNT = 3<br>2021-02-13 22:00:01 -- info: CONFIG - VM_BACKUP_DIR_NAMING_CONVENTIO<wbr>N = 2021-02-13_22-00-00<br>2021-02-13 22:00:01 -- info: CONFIG - DISK_BACKUP_FORMAT = thin<br>2021-02-13 22:00:01 -- info: CONFIG - POWER_VM_DOWN_BEFORE_BACKUP = 0<br>2021-02-13 22:00:01 -- info: CONFIG - ENABLE_HARD_POWER_OFF = 0<br>2021-02-13 22:00:01 -- info: CONFIG - ITER_TO_WAIT_SHUTDOWN = 3<br>2021-02-13 22:00:01 -- info: CONFIG - POWER_DOWN_TIMEOUT = 5<br>2021-02-13 22:00:01 -- info: CONFIG - SNAPSHOT_TIMEOUT = 15<br>2021-02-13 22:00:01 -- info: CONFIG - LOG_LEVEL = info<br>2021-02-13 22:00:01 -- info: CONFIG - BACKUP_LOG_OUTPUT = /tmp/ghettoVCB-2021-02-13_22-0<wbr>0-00-2250208.log<br>2021-02-13 22:00:01 -- info: CONFIG - ENABLE_COMPRESSION = 0<br>2021-02-13 22:00:01 -- info: CONFIG - VM_SNAPSHOT_MEMORY = 0<br>2021-02-13 22:00:01 -- info: CONFIG - VM_SNAPSHOT_QUIESCE = 0<br>2021-02-13 22:00:01 -- info: CONFIG - ALLOW_VMS_WITH_SNAPSHOTS_TO_BE<wbr>_BACKEDUP = 0<br>2021-02-13 22:00:01 -- info: CONFIG - VMDK_FILES_TO_BACKUP = all<br>2021-02-13 22:00:01 -- info: CONFIG - VM_SHUTDOWN_ORDER =<br>2021-02-13 22:00:01 -- info: CONFIG - VM_STARTUP_ORDER =<br>2021-02-13 22:00:01 -- info: CONFIG - RSYNC_LINK = 0<br>2021-02-13 22:00:01 -- info: CONFIG - BACKUP_FILES_CHMOD =<br>2021-02-13 22:00:01 -- info: CONFIG - EMAIL_LOG = 1<br>2021-02-13 22:00:01 -- info: CONFIG - EMAIL_SERVER =Â <a href=\"http://smtp.k8s.it/\" rel=\"noopener noreferrer\" target=\"_blank\" data-saferedirecturl=\"https://www.google.com/url?q=http://smtp.k8s.it&amp;source=gmail&amp;ust=1613839933510000&amp;usg=AFQjCNFj5McYEepf6qWyQHkVKmgpikm1JQ\">smtp.xxs.it</a><br>2021-02-13 22:00:01 -- info: CONFIG - EMAIL_SERVER_PORT = 25<br>2021-02-13 22:00:01 -- info: CONFIG - EMAIL_DELAY_INTERVAL = 1<br>2021-02-13 22:00:01 -- info: CONFIG - EMAIL_FROM =Â <a href=\"mailto:ghettoVCB-amaterasu@k8s.it\" target=\"_blank\" rel=\"noopener\">ghettoVCB-amaterasu@xxs.it</a><br>2021-02-13 22:00:01 -- info: CONFIG - EMAIL_TO =Â <a href=\"mailto:backup@k8s.it\" target=\"_blank\" rel=\"noopener\">backup@xxs.it</a><br>2021-02-13 22:00:01 -- info: CONFIG - WORKDIR_DEBUG = 0<br>2021-02-13 22:00:01 -- info: CONFIG - ENABLE NFS IO HACK = 1<br>2021-02-13 22:00:01 -- info: CONFIG - NFS IO HACK LOOP MAX = 10<br>2021-02-13 22:00:01 -- info: CONFIG - NFS IO HACK SLEEP TIMER = 60<br>2021-02-13 22:00:01 -- info: CONFIG - NFS BACKUP DELAY = 0<br><br>2021-02-13 22:00:06 -- info: Initiate backup for izanami<br>2021-02-13 22:00:06 -- info: Creating Snapshot \"ghettoVCB-snapshot-2021-02-13<wbr>\" for izanami<br>2021-02-13 22:09:55 -- info: Removing snapshot from izanami ...<br>2021-02-13 22:10:56 -- info: Slept 60 seconds to work around NFS I/O error<br>2021-02-13 22:10:56 -- info: Backup Duration: 10.83 Minutes<br>2021-02-13 22:10:56 -- info: Successfully completed backup for izanami!<br><br>2021-02-13 22:11:02 -- info: Initiate backup for izanagi<br>2021-02-13 22:11:02 -- info: Creating Snapshot \"ghettoVCB-snapshot-2021-02-13<wbr>\" for izanagi<br>2021-02-13 22:16:37 -- info: Removing snapshot from izanagi ...<br>2021-02-13 22:17:37 -- info: Slept 60 seconds to work around NFS I/O error<br>2021-02-13 22:17:37 -- info: Backup Duration: 6.58 Minutes<br>2021-02-13 22:17:37 -- info: Successfully completed backup for izanagi!<br><br>2021-02-13 22:17:43 -- info: Initiate backup for hiroito<br>2021-02-13 22:17:43 -- info: Creating Snapshot \"ghettoVCB-snapshot-2021-02-13<wbr>\" for hiroito<br>2021-02-13 22:23:55 -- info: Removing snapshot from hiroito ...<br>2021-02-13 22:24:56 -- info: Slept 60 seconds to work around NFS I/O error<br>2021-02-13 22:24:56 -- info: Backup Duration: 7.22 Minutes<br>2021-02-13 22:24:56 -- info: Successfully completed backup for hiroito!<br><br>2021-02-13 22:25:01 -- info: Initiate backup for raijin<br>2021-02-13 22:25:01 -- info: Creating Snapshot \"ghettoVCB-snapshot-2021-02-13<wbr>\" for raijin<br>2021-02-13 22:26:21 -- info: Removing snapshot from raijin ...<br>2021-02-13 22:27:21 -- info: Slept 60 seconds to work around NFS I/O error<br>2021-02-13 22:27:21 -- info: Backup Duration: 2.33 Minutes<br>2021-02-13 22:27:21 -- info: Successfully completed backup for raijin!<br><br>2021-02-13 22:27:54 -- info: ###### Final status: All VMs backed up OK! ######<br><br>2021-02-13 22:27:54 -- info: ============================== ghettoVCB LOG END ==============================<wbr>==</code><br><br></p>\n<h3>PriceÂ </h3>\n<p>nuc7PJYH ~ 160â‚¬<br>G.Skill Ripjaws SO-DIMM 16GB DDR4-2400Mhz 2x8GB ~ 60â‚¬<br>hard disk ssd 250db ~ 40â‚¬<br><br>Is not cheap as a raspberry 4 but it's 10 time more performant and guarantee a full server experience with the possibility to play and grow your skills and challengeÂ </p>\n<p>Â </p>\n<p>Â </p>\n<p>Â </p>",
            "image": "https://www.k8s.it/media/posts/24/Screenshot-2021-02-19-at-18.06.38.png",
            "author": {
                "name": "lgirardi"
            },
            "tags": [
                   "vspehere",
                   "vmware",
                   "microk8s",
                   "kubernetes",
                   "k3s",
                   "homelab",
                   "ghettovcb",
                   "cluster",
                   "backup"
            ],
            "date_published": "2021-02-19T16:33:17+01:00",
            "date_modified": "2021-02-19T18:07:00+01:00"
        },
        {
            "id": "https://www.k8s.it/ambient-sensor-for-mere-mortal.html",
            "url": "https://www.k8s.it/ambient-sensor-for-mere-mortal.html",
            "title": "Ambient sensor for mere mortal",
            "summary": "In the home automation era, I was quite curious to understand how is working a simple thermal sensor I tried this simple experiment following the suggestion of one of my colleagues, i was thinking to start with Arduino , however he suggested to try nodemcu&hellip;",
            "content_html": "<p>In the home automation era, I was quite curious to understand how is working a simple thermal sensor</p>\n<h3>WHAT WE NEED ?</h3>\n<ul>\n<li>ESP8266</li>\n<li>DHT22</li>\n<li>usb power</li>\n<li>Influxdb</li>\n<li>Grafana</li>\n</ul>\n<p>I tried this simple experiment following the suggestion of one of my colleagues, i was thinking to start with Arduino , however he suggested to try nodemcu</p>\n<p>So what is <em>nodemcu?<br></em>It's an open source platform developed for IoT , you can <em>compile</em> the firmware with the most used sensors available , but the main feature is the Lua support<br>When i starts with Arduino i created some C software really horrible ğŸ˜‡<br>with Lua instead it was quite simple create this kind of functionality.</p>\n<p>The hardware platform is really nice and simpleÂ </p>\n<h4>ESP8266</h4>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/23/Screenshot-2021-01-24-at-21.39.16.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.39.16-xs.png 300w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.39.16-sm.png 480w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.39.16-md.png 768w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.39.16-lg.png 1024w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.39.16-xl.png 1360w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.39.16-2xl.png 1600w\"  alt=\"\" width=\"640\" height=\"565\"></figure>\n<p>Â </p>\n<p>It's natively support wifi and with the sensor dht22 you are able to have the temperature, humidity ... and well also a dew point since is it a maths of previous values</p>\n<h4>DHT22</h4>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/23/Screenshot-2021-01-24-at-21.42.27.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.42.27-xs.png 300w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.42.27-sm.png 480w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.42.27-md.png 768w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.42.27-lg.png 1024w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.42.27-xl.png 1360w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.42.27-2xl.png 1600w\"  alt=\"\" width=\"640\" height=\"602\"></figure>\n<p>Â </p>\n<p>Price for both is really cheaper (aliexpress)</p>\n<p>esp8266Â  Â  --&gt; 3$<br>dht22Â  Â  Â  Â  Â  --&gt; 1$</p>\n<p>Once you receive the hardware you can start to work on itÂ </p>\n<p>With <a href=\"https://nodemcu-build.com/\">https://nodemcu-build.com/</a> you can build the firmware that fit your needs (in the next screen what is needed to interact with the thermal sensor)</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/23/Screenshot-2021-01-24-at-21.46.37.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.46.37-xs.png 300w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.46.37-sm.png 480w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.46.37-md.png 768w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.46.37-lg.png 1024w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.46.37-xl.png 1360w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-21.46.37-2xl.png 1600w\"  alt=\"\" width=\"640\" height=\"484\"></figure>\n<p>Â </p>\n<p>To load the firmware you should need <a href=\"https://github.com/espressif/esptool\">https://github.com/espressif/esptool</a></p>\n<p>with a command like this<br><code>python esptool.py -b 115200 --port=/dev/cu.<wbr>wchusbserial1410 write_flash Â -fm=dio -fs=32m 0x0000Â <span class=\"il\">nodemcu</span>-master-12-modules-<wbr>2016-01-09-18-51-26-float.bin</code></p>\n<p>Now.... it's time to create the Lua script</p>\n<h3>Configuration</h3>\n<p>This is working since 2016 so i think we can consider stable ğŸ˜</p>\n<pre><code>local SSID = \"name wifi\"\nlocal SSID_PASSWORD = \"password wifi\"\nlocal DEVICE = \"name device\"\nlocal temperature = 20.0\n\nwifi.setmode(wifi.STATION)\nwifi.sta.config(SSID,SSID_PASSWORD)\nwifi.sta.autoconnect(1)\n\nlocal HOST = \"server database\"\nlocal URI = \"/write?db=collectd\"\n\nfunction build_post_request(host, uri, data_table)\n\n     local data = data_table.Data_type .. \",device=\" .. data_table.Device .. \" \" .. \"value=\" .. data_table.Value\n\n     --for param,value in pairs(data_table) do\n    --      data = data .. param..\"=\"..value..\"&amp;\"\n    -- end\n    print(data)\n\n     request = \"POST \"..uri..\" HTTP/1.1\\r\\n\"..\n     \"Host: \"..host..\"\\r\\n\"..\n     \"Connection: close\\r\\n\"..\n     \"Content-Type: application/x-www-form-urlencoded\\r\\n\"..\n     \"Content-Length: \"..string.len(data)..\"\\r\\n\"..\n     \"\\r\\n\"..\n     data\n\n     print(request)\n\n     return request\nend\n\nlocal function display(sck,response)\n     print(response)\nend\n\n-- When using send_sms: the \"from\" number HAS to be your twilio number.\n-- If you have a free twilio account the \"to\" number HAS to be your twilio verified number.\n-- The numbers MUST include the country code.\n-- DO NOT add the \"+\" sign.\nlocal function send_data(data_type,device,value)\n\n     local data = {\n      Data_type = data_type,\n      Device = device,\n      Value = value\n     }\n\n     socket = net.createConnection(net.TCP,0)\n     socket:on(\"receive\",display)\n     socket:connect(8086,HOST)\n\n     socket:on(\"connection\",function(sck)\n\n          local post_request = build_post_request(HOST,URI,data)\n          sck:send(post_request)\n     end)\nend\n\nfunction check_wifi()\n local ip = wifi.sta.getip()\n\n if(ip==nil) then\n   print(\"Connecting...\")\n else\n  tmr.stop(0)\n  print(\"Connected to AP!\")\n  print(ip)\n  --send_data(\"15551234567\",\"12223456789\",\"Hello from your ESP8266\")\n\n  local t, h, d = getTempHumi()\n\n  print(\"Temp:\"..t ..\" C\\n\")\n  print(\"Humi:\"..h ..\" RH\\n\")\n  print(\"Dew:\"..d ..\" DP\\n\")\n\n  send_data(\"temperature\", DEVICE, t)\n  send_data(\"humidity\", DEVICE, h)\n  send_data(\"dew_point\", DEVICE, d)\n\n  tmr.alarm(0,30000,1,check_wifi)\n\n end\n\nend\n\ntmr.alarm(0,5000,1,check_wifi)\n\nfunction getTempHumi()\n    pin = 4\n    local status,temp,humi,temp_decimial,humi_decimial = dht.read(pin)\n    if( status == dht.OK ) then\n    -- Float firmware using this example\n      print(\"DHT Temperature:\"..temp..\";\"..\"Humidity:\"..humi)\n    elseif( status == dht.ERROR_CHECKSUM ) then\n      print( \"DHT Checksum error.\" );\n    elseif( status == dht.ERROR_TIMEOUT ) then\n      print( \"DHT Time out.\" );\n    end\n    local dewpoint= (humi/100)^(1/8) * (112 + (0.9 * temp)) - 112 + (0.1 * temp)\n\n    return temp, humi, (string.format(\"%.1f\", dewpoint))\nend</code></pre>\n<h4>Customizations</h4>\n<p>local SSID = \"wifi name\"Â Â <br>local SSID_PASSWORD = \"wifi password\" <br>local DEVICE = \"name device\"Â  Â  Â  Â  --&gt; name of you board/roomÂ </p>\n<p>local HOST = \"server database\"Â  Â  Â --&gt; your influxdb installation<br>local URI = \"/write?db=collectd\"Â  Â  Â --&gt; your database nameÂ </p>\n<p>Â </p>\n<p>So we have the hardware , we loaded the firmware, we created the code, but how to interact with the platform... well there are many way however <a href=\"https://esp8266.ru/esplorer/\" target=\"_blank\" rel=\"noopener noreferrer\">ESPlorer</a> has a nice gui even if it's java based â˜ ï¸</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/23/ESPlorer-panels.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/23/responsive/ESPlorer-panels-xs.png 300w ,https://www.k8s.it/media/posts/23/responsive/ESPlorer-panels-sm.png 480w ,https://www.k8s.it/media/posts/23/responsive/ESPlorer-panels-md.png 768w ,https://www.k8s.it/media/posts/23/responsive/ESPlorer-panels-lg.png 1024w ,https://www.k8s.it/media/posts/23/responsive/ESPlorer-panels-xl.png 1360w ,https://www.k8s.it/media/posts/23/responsive/ESPlorer-panels-2xl.png 1600w\"  alt=\"\" width=\"640\" height=\"373\"></figure>\n<p>Â </p>\n<h3>Results</h3>\n<p><a href=\"https://services.k8s.it/grafana/d/000000079/temperature?viewPanel=5&amp;orgId=2&amp;refresh=1m\">https://services.k8s.it/grafana/d/000000079/temperature?viewPanel=5&amp;orgId=2&amp;refresh=1m</a></p>\n<p>above you can see the live results .... and on grafana we can create a graph like this</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/23/Screenshot-2021-01-24-at-22.11.01.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-22.11.01-xs.png 300w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-22.11.01-sm.png 480w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-22.11.01-md.png 768w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-22.11.01-lg.png 1024w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-22.11.01-xl.png 1360w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-22.11.01-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"408\"></figure>\n<p>The delta delta in the <em>Humidity is generated by an </em>humidifier</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/23/Screenshot-2021-01-24-at-22.06.50.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-22.06.50-xs.png 300w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-22.06.50-sm.png 480w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-22.06.50-md.png 768w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-22.06.50-lg.png 1024w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-22.06.50-xl.png 1360w ,https://www.k8s.it/media/posts/23/responsive/Screenshot-2021-01-24-at-22.06.50-2xl.png 1600w\"  alt=\"\" width=\"640\" height=\"738\"></figure>\n<p>Â </p>\n<p>I have one sensor for all rooms ... and also externalÂ </p>\n<p>The external one should be replaced more or less every year because is not properly water proof and ... day by day the electrical contacts become oxidizedÂ </p>\n<p>Â </p>\n<p>Â </p>",
            "author": {
                "name": "lgirardi"
            },
            "tags": [
            ],
            "date_published": "2021-01-24T22:10:12+01:00",
            "date_modified": "2021-01-29T12:47:26+01:00"
        },
        {
            "id": "https://www.k8s.it/the-monitoring-paper.html",
            "url": "https://www.k8s.it/the-monitoring-paper.html",
            "title": "The monitoring paper",
            "summary": "Contrary to popular belief, monitoring an infrastructure is the opposite to just have some metrics about applications and network There are many many documents the lead this topic, one of the most interesting it's just few pages from Google around the art of slos or&hellip;",
            "content_html": "<p>Contrary to popular belief, monitoring an infrastructure is the opposite to just have some metrics about applications and network</p>\n<p>There are many many documents the lead this topic,<br>one of the most interesting it's just few pages from Google around <a href=\"https://static.googleusercontent.com/media/sre.google/it//static/pdf/art-of-slos-slides.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">the art of slos</a><br>or the <a href=\"https://www.k8s.it/media/files/The Art of SLOs - Google.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">book</a> version i took from a google onsite deep dive.Â <a href=\"https://www.k8s.it/media/files/The Art of SLOs - Google.pdf\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>To better details this topic i'd like to use simple statements:</p>\n<ul>\n<li>WHAT</li>\n<li>WHY</li>\n<li>WHO</li>\n<li>HOW</li>\n</ul>\n<p>Â </p>\n<h3>WHATÂ </h3>\n<p>This is probably the main argument we will discuss on this threadÂ </p>\n<p>There no magic formulas or tools to use, if you expect to buy a tool that work with metrics out of the box, you're wrong.Â <br>Tools are the infrastructure to store and visualize data... but first of all you need to collect the right data.</p>\n<p>What is the DATA you need ?<br>Those are you will record moving yourself on the <span style=\"text-decoration: underline;\">customer position</span></p>\n<p><strong>Customer position</strong> : i'm using this term because i suppose you are not an onlus so you have a customer, but customer is a overall word with the meaning of all people are using your product:</p>\n<ul>\n<li>people that buy something e-commerce (Amazon, Bestbuy, Aliexpress)</li>\n<li>people that use website to learn something (Cnn, Bloomberg, Wikipedia)</li>\n<li>people that work on finance and use finance applications (Navision, SAP, JD Edwards)</li>\n<li>people that use energy from nuclear siteÂ </li>\n</ul>\n<p>So moving yourself on the customer position you can better understand the definition of data that you need to know to better monitor your application with the righe <strong>customer metricsÂ </strong></p>\n<p>Stupid example ... imagine an automatic gate</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/20/Screenshot-2021-01-03-at-16.31.43.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-03-at-16.31.43-xs.png 300w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-03-at-16.31.43-sm.png 480w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-03-at-16.31.43-md.png 768w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-03-at-16.31.43-lg.png 1024w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-03-at-16.31.43-xl.png 1360w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-03-at-16.31.43-2xl.png 1600w\"  alt=\"\" width=\"1092\" height=\"522\"></figure>\n<p>What is the definition of \"it's working?\"</p>\n<ul>\n<li>it opens</li>\n</ul>\n<p>Obviously YES , but not only</p>\n<ul>\n<li>what about if it's not closing ?Â </li>\n<li>what about if it opens in 10 minutes , it's acceptable ?</li>\n<li>what about if after X times the automation is broken ?Â </li>\n<li>etc etc ...</li>\n</ul>\n<p>As you can imagine we can define not only the objective values (open/close), we can elaborate customer subjective frustration , if i have to buy an automatic gate, i will not choose the one that will take 10 minutes to open... because... because 10 minutes are too much , based on subjective value as a customer.</p>\n<p>In the same way we cannot say that our application is working because it's answers.</p>\n<p>So <span style=\"text-decoration: underline;\">what</span> we have to consider when we start to monitor an application in production?</p>\n<p>Let's start with 3 macro clusters:</p>\n<ul>\n<li style=\"font-weight: 400;\"><span style=\"font-weight: 400;\"><strong>system</strong> resources, so all metrics related to the pod (cpu,network,...)</span></li>\n<li style=\"font-weight: 400;\"><span style=\"font-weight: 400;\"><strong>application</strong> standard metrics (thread, gc, errors per minute, requests per minute, ... )</span></li>\n<li style=\"font-weight: 400;\"><span style=\"font-weight: 400;\"><strong>business</strong> metrics that are inherent from the application scope, if the application provides a checkout for goods, we need to know for example how many transactions were fine and how many rejected</span></li>\n</ul>\n<p>Â </p>\n<h4><strong>System</strong></h4>\n<p>Those are the most easiest and used metrics since you started to monitor services.<br>On this group we have the basis metrics related to the system usage,<br>considering the evolution of the platform those values are day by day less influential than before.<br>This is because as soon we are increasing the technology level from bare metal, to vm , to docker to serverless ... the evaluation of those numbers could raise some mistake on the interpretation , however we still need to start with the basis in order to have data to define a trend based on specific situations</p>\n<p>Here an example about the bare metal used as vsphere 6.7</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/20/Screenshot-2021-01-05-at-15.49.59.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-15.49.59-xs.png 300w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-15.49.59-sm.png 480w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-15.49.59-md.png 768w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-15.49.59-lg.png 1024w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-15.49.59-xl.png 1360w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-15.49.59-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"371\"></figure>\n<p>always on the system metrics we can go more in deep checking a virtual machine inside this host, here the one i used to host my kubernetes lab</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/20/Screenshot-2021-01-05-at-15.53.29.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-15.53.29-xs.png 300w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-15.53.29-sm.png 480w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-15.53.29-md.png 768w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-15.53.29-lg.png 1024w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-15.53.29-xl.png 1360w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-15.53.29-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"371\"></figure>\n<p>In the 2 images for example we can assume that we have something that move the cpu close to 100% cyclically (it's a <a href=\"https://www.k8s.it/kubernetes-sitespeedio.html\">crawler</a> to perform check on website pages every hours)</p>\n<p>Â </p>\n<h4><strong>Application</strong></h4>\n<p>It's time now to move inside the kubernetes cluster and check how is going on the a web application inside the cluster<br>Since this application it is springboot based, we have the opportunity to understand how is going on from a framework side (java) and behavioural interactions.<br>Response time server to server, server errors, client errors, sql interactions, garbage collector, sidecars (is a pod with multiple images) usage, logs creation , metrics creation etc etc</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/20/app_metrics.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/20/responsive/app_metrics-xs.png 300w ,https://www.k8s.it/media/posts/20/responsive/app_metrics-sm.png 480w ,https://www.k8s.it/media/posts/20/responsive/app_metrics-md.png 768w ,https://www.k8s.it/media/posts/20/responsive/app_metrics-lg.png 1024w ,https://www.k8s.it/media/posts/20/responsive/app_metrics-xl.png 1360w ,https://www.k8s.it/media/posts/20/responsive/app_metrics-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"956\"></figure>\n<p>Having those in place you can understand from an application point of view how is going on the performances release by release.. what happen in case of bugs and critical condition (unexpected huge traffic) , the area where you can put you effort on improvements.</p>\n<p>Â </p>\n<h4><span style=\"font-weight: 400;\"><strong>Business</strong></span></h4>\n<p>OK system is covered , application is covered ... what about the customer perception ?</p>\n<p>This is the most critical topic , if your application is part of a microservices funnel or a monolithic application that manage the entire product, it's supposed that in some way you have benefits from its performances</p>\n<p>So move yourself on the customer position monitoring your website from a customer point of view with business metrics , in this simple case i just monitor the cms page on topÂ <br>It's a website:</p>\n<ul>\n<li>so how long does it take have the page ?</li>\n<li>which are the most relevant data you need to know to improve?</li>\n<li>do you have the same trends every time ?</li>\n<li>etc etc</li>\n</ul>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/20/screencapture-services-k8s-it-grafana-d-000000053-pagesummary-influxdb-2021-01-05-17_07_37.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/20/responsive/screencapture-services-k8s-it-grafana-d-000000053-pagesummary-influxdb-2021-01-05-17_07_37-xs.png 300w ,https://www.k8s.it/media/posts/20/responsive/screencapture-services-k8s-it-grafana-d-000000053-pagesummary-influxdb-2021-01-05-17_07_37-sm.png 480w ,https://www.k8s.it/media/posts/20/responsive/screencapture-services-k8s-it-grafana-d-000000053-pagesummary-influxdb-2021-01-05-17_07_37-md.png 768w ,https://www.k8s.it/media/posts/20/responsive/screencapture-services-k8s-it-grafana-d-000000053-pagesummary-influxdb-2021-01-05-17_07_37-lg.png 1024w ,https://www.k8s.it/media/posts/20/responsive/screencapture-services-k8s-it-grafana-d-000000053-pagesummary-influxdb-2021-01-05-17_07_37-xl.png 1360w ,https://www.k8s.it/media/posts/20/responsive/screencapture-services-k8s-it-grafana-d-000000053-pagesummary-influxdb-2021-01-05-17_07_37-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"3021\"></figure>\n<p>Â </p>\n<p>Â </p>\n<h3>WHY</h3>\n<p>With those cluster of metrics we can define and plan the architecture and the forecasting for the company ... remember that when something goes wrong with no metrics you will probably cascade to situation like this</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/20/Screenshot-2021-01-05-at-17.41.07.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.41.07-xs.png 300w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.41.07-sm.png 480w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.41.07-md.png 768w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.41.07-lg.png 1024w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.41.07-xl.png 1360w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.41.07-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"441\"></figure>\n<p>Â </p>\n<p><strong>System</strong> metrics can share the usages and the density of you infrastructure creating the basis <span style=\"text-decoration: underline;\">alerts</span> in case of suffering but also plan the evolution of the platform itselfÂ Â </p>\n<p><span style=\"font-weight: 400;\"><strong>Application </strong>metrics share the framework behaviour and the evolution of your application day by day , <span style=\"text-decoration: underline;\">alerts</span> are defined to monitor the scalability, bugs and application behaviour</span></p>\n<p><strong>Business <span style=\"font-weight: 400;\">metrics share the thresholds to use as alerts but not only...Â </span><br></strong>In this example we are talking about a web application <br>If you are selling something through it ,conversion is always the most relevant buzzword</p>\n<p>From the 100 visitors , who will continue the navigation till the purchase, the remaining are really a small slice (e-commerce for example)</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/20/conversion-impact-score-funnel-NEW.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/20/responsive/conversion-impact-score-funnel-NEW-xs.png 300w ,https://www.k8s.it/media/posts/20/responsive/conversion-impact-score-funnel-NEW-sm.png 480w ,https://www.k8s.it/media/posts/20/responsive/conversion-impact-score-funnel-NEW-md.png 768w ,https://www.k8s.it/media/posts/20/responsive/conversion-impact-score-funnel-NEW-lg.png 1024w ,https://www.k8s.it/media/posts/20/responsive/conversion-impact-score-funnel-NEW-xl.png 1360w ,https://www.k8s.it/media/posts/20/responsive/conversion-impact-score-funnel-NEW-2xl.png 1600w\"  alt=\"\" width=\"800\" height=\"647\"></figure>\n<p>This images comes from an 2015 <a href=\"https://blogs.akamai.com/2015/07/conversion-impact-score-what-is-it-and-why-do-you-need-to-know-yours.html\" target=\"_blank\" rel=\"noopener noreferrer\">article</a> from Akamai that is really still actual ...<br>Conversion is always impacted by page response time , more close you are in the first navigation phases like searching rather than checkout where you probably have more clear will to purchase<br><br>Now we know the data around the usage of our website and we can create <strong>GOALs</strong> and <strong>KPI</strong> to improve those values in order to better fit with the customer expectation.</p>\n<p>Â </p>\n<p>Â </p>\n<h3>WHO</h3>\n<p>Those actors could be different case by case, from a small company to an enterprise, even if you are a full stack whateverops, a developer or part of monitoring team, in this scope you should not be alone.Â </p>\n<p><strong>System</strong> and <strong>Application</strong> are usually managed by <span style=\"text-decoration: underline;\">sre/devops/sysadmin</span> with the help of architecture/developer to define the best framework metrics to monitor.</p>\n<p>On the opposite side <strong>BusinessÂ </strong>are more close with the product side, who will be better than the <span style=\"text-decoration: underline;\">product dept</span> (developers) itself defining the kpi and goals used as a metrics with the cooperation of the <span style=\"text-decoration: underline;\">business dept</span> to define the <strong><span style=\"font-weight: 400;\">thresholds.</span></strong></p>\n<p>This cooperation will be useful to define:</p>\n<ul>\n<li style=\"font-weight: 400;\"><span style=\"font-weight: 400;\">Right alerts to right people</span></li>\n<li style=\"font-weight: 400;\"><span style=\"font-weight: 400;\">Support granted by ownership</span></li>\n<li style=\"font-weight: 400;\"><span style=\"font-weight: 400;\">No speculations, real data</span></li>\n</ul>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/20/Screenshot-2021-01-05-at-17.39.10.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.39.10-xs.png 300w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.39.10-sm.png 480w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.39.10-md.png 768w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.39.10-lg.png 1024w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.39.10-xl.png 1360w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.39.10-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"346\"></figure>\n<p>Â </p>\n<h3><strong>HOW</strong></h3>\n<p>Â </p>\n<h4>Infrastructure</h4>\n<p>First of all you have to define the monitoring/alerting platform,Â <br>the suggestion is to have this platform scalable with a good UI (grafana) to work with backend storage (prometheus + cortex/thanos, graphite + carbonzipper, influxdb, etc etc)</p>\n<p>Honestly if you are in a big environment and you make a mistake in metrics configuration with graphite (push model) you can saturate the space since every time you create a new metric you are creating whisper file with the dimension based on the retention schema.<br>I prefer prometheus (pull model) that could prevent those issues and better fit the kubernetes standars , will be also more easy create a /metrics page on your application rather than use sidecar pods to stream metrics with collectd/telegraf/statsd and so on.</p>\n<h4>Â </h4>\n<h4>Less is more</h4>\n<p><span style=\"font-weight: 400;\">How many metrics are enough to create a valid alert?</span></p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/20/Screenshot-2021-01-05-at-17.48.07.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.48.07-xs.png 300w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.48.07-sm.png 480w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.48.07-md.png 768w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.48.07-lg.png 1024w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.48.07-xl.png 1360w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.48.07-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"764\"></figure>\n<p>The more metrics identify the service behaviour the more we can create a dedicated alert...<br>anyway Â ....<br>The anti-pattern model currently applied in some cases: <br>have tons of metrics that generate only <strong>noise</strong> without identifying the healthiness of a service</p>\n<p><em>Keep it simple</em> and define the structure of your <span style=\"text-decoration: underline;\">System,</span> <span style=\"text-decoration: underline;\">Application</span> and <span style=\"text-decoration: underline;\">Business</span> metrics .</p>\n<p>Â </p>\n<h4>Smart metrics</h4>\n<p><span style=\"font-weight: 400;\">Itâ€™s not only ONE value that show off the healthiness, but the combination of multiple metrics that guarantee the status</span></p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/20/Screenshot-2021-01-05-at-17.46.34.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.46.34-xs.png 300w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.46.34-sm.png 480w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.46.34-md.png 768w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.46.34-lg.png 1024w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.46.34-xl.png 1360w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.46.34-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"303\"></figure>\n<p>This concept is really important, imagine a dynamic infrastructure based on kubernetes <a href=\"https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/\" target=\"_blank\" rel=\"noopener noreferrer\">HPA</a>Â </p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/20/Screenshot-2021-01-05-at-18.22.01.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-18.22.01-xs.png 300w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-18.22.01-sm.png 480w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-18.22.01-md.png 768w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-18.22.01-lg.png 1024w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-18.22.01-xl.png 1360w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-18.22.01-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"632\"></figure>\n<p>where you can probable have some value linear (like thread), mitigated by the horizontal autoscaling, you should combine multiple values to define the application status.</p>\n<p>Create the metrics alert with <strong>trends</strong> not with the pure numberÂ <br>Ex. 70 threads value alone make no sense , different applications has different threads value , what is important is the <strong>delta , </strong>the percentage is useful to understand the behaviour, +50% threads make sense in all applications rather than the effective number.<br><br></p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/20/Screenshot-2021-01-05-at-17.46.55.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.46.55-xs.png 300w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.46.55-sm.png 480w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.46.55-md.png 768w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.46.55-lg.png 1024w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.46.55-xl.png 1360w ,https://www.k8s.it/media/posts/20/responsive/Screenshot-2021-01-05-at-17.46.55-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"656\"></figure>\n<p>Â </p>\n<p>Be smart also on the evaluation with standard deviation and <strong>percentile</strong> ... mean is usually dropping the relevant value to evaluate performances under stress</p>\n<p>Â </p>\n<p>Â </p>\n<p>Â </p>\n<p>Â </p>",
            "image": "https://www.k8s.it/media/posts/20/Screenshot-2021-01-05-at-17.47.24.png",
            "author": {
                "name": "lgirardi"
            },
            "tags": [
                   "system metrics",
                   "slo",
                   "sli",
                   "sla",
                   "observability",
                   "metrics",
                   "customer experience",
                   "conversion ",
                   "business metrics",
                   "application metrics",
                   "alerting"
            ],
            "date_published": "2021-01-05T17:56:00+01:00",
            "date_modified": "2021-01-05T19:11:11+01:00"
        },
        {
            "id": "https://www.k8s.it/maximum-yield-with-minimum-expense.html",
            "url": "https://www.k8s.it/maximum-yield-with-minimum-expense.html",
            "title": "Maximum yield with minimum expense for a static website",
            "summary": "Great marketing quote, however i think we can better share a value that is always true... keep it simple, keep it safe. I would structure this article in few relevant topics Each of the above could be a specific topic that will fit others use&hellip;",
            "content_html": "<p>Great marketing quote, however i think we can better share a value that is always true... <br><em><span style=\"text-decoration: underline;\">keep it simple, keep it safe.</span></em></p>\n<p>I would structure this article in few relevant topics</p>\n<ul>\n<li>Static website</li>\n<li>Tools</li>\n<li>Security</li>\n<li>Monitor</li>\n</ul>\n<p>Each of the above could be a specific topic that will fit others use cases</p>\n<p><em>This is not a post about how to create a blog... this post will inspect into some technology that can simplify your life or your work with small but important concepts</em></p>\n<p>Â </p>\n<h3>Static website</h3>\n<p>Among the famous open cms i tried probably all of those, Â during my career.<br>Basically are a web application with sql database in most of the cases.</p>\n<p>Now we can discuss about the meaning of content generation , that should be dynamic and be part of the user experience rather than a page generated, however today i will talk just about the usage of a cms for a static(tbd) reality.</p>\n<p>If your goal is promote your company, your hobbies, your work ... you have already heard about wordpress, joomla, drupal etc etc ... that are good (if not directly exposed) but had a huge problem... since are open and used by a relevant number of people, are subjected of vulnerability, moreover , if you install plugins the situation could be dramatic.</p>\n<p>As much you install <strong>plugins</strong> (and really some cms are not able to do anything with a plugin),<br>as much your website is bloat.<br>With the same ratio the <span style=\"text-decoration: underline;\">performances will decrease.</span></p>\n<p>On top of this, a <span style=\"text-decoration: underline;\">huge</span> percentage of the plugins in the cms repository are old and out of date yet still available to install on your system.</p>\n<p>So if you don't need something special (most of the blogs are wordpress only because it's easy to use) and you want to create a static website for your company, your business and so on , you can probably evaluate something different looking for , the first pillar mentioned, keep it simple.<br>Moreover the trend in a enterprise is moving from dynamic content to static as per the <strong>speed</strong> is the major KPI for a website</p>\n<p>On a secondary binary in the last years the static cms are growth</p>\n<ul>\n<li>Jekyll</li>\n<li>Gatsby</li>\n<li>Siteleaf</li>\n<li>Netlify</li>\n<li>Hugo</li>\n<li>$whatever-js (every day we have a new js framework)</li>\n<li>etc etc</li>\n</ul>\n<p>However if you are not so nerd ... or your are tremendously lazy (like me)<br>a grate alternative is <a href=\"https://getpublii.com/\">Publii</a></p>\n<p>Publii includes a WYSIWYG (What You See Is What You Get) editor for content creation,<br>really easy to use , and the client is available for multiple platform (win,linux,mac)</p>\n<p>Â </p>\n<p>Â </p>\n<p>Â </p>\n<h3>Tools</h3>\n<p>I mentioned Publii before, this tool is just a simple way for lazy people to create a static website, i'll not go in deep with this software since is well explained in its website however offer multiple possibility where store the files , the main ones are s3 bucket and github pages.<br>Publii is not a pretty collaborative tool but is not supposed to have this kind of interaction on a static website, is more close to a human interaction only.<br><span style=\"color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);\">On the opposite side Jekyll and the other families are more close to be collaborative based on a git project and part of a pipeline flow (runner/actions)</span></p>\n<p>Â </p>\n<p>Based on the backend for you html files, lets explore the <a href=\"https://pages.github.com/\">github pages</a><br>This service is free with few limits<br><em>Published GitHub Pages sites may be no larger than 1 GB.</em><br><em>GitHub Pages sites have a soft bandwidth limit of 100GB per month.</em><br><em>GitHub Pages sites have a soft limit of 10 builds per hour.</em></p>\n<p>It's really easy to use and demand the security on the github account (always 2fa)<br>They offer a dns based on your github account and you can manage paths,<br>moreover you have the TLS/SSL for free</p>\n<p>With Publii configuration is quite easy and you can follow the instruction <a href=\"https://getpublii.com/docs/host-static-website-github-pages.html\">here</a>Â </p>\n<p>Â </p>\n<p>Another solution is use s3 as a repository, this require a bit more stuff sometimes, however even if it's a cheeper option, why not use an s3 on-prem if it's availableÂ <br>(this is just an excuse to use kubernetes, i still suggest to use the github pages, however i like to have this kind of exercise)</p>\n<p>So welcome <a href=\"https://min.io/\">minio</a> , a kubernetes object storage<br>The configuration is quite simple, as usual you can start with the namespace creation<br><code>kind: \"Namespace\"<br>apiVersion: \"v1\"<br>metadata:<br>Â  name: \"minio\"<br>Â  labels:<br>Â  Â  name: \"minio\"</code></p>\n<p>The service (this is just a single instance so no StatefulSets set is needed)<br><code>apiVersion: v1<br>kind: Service<br>metadata:<br>Â  name: minio-svc<br>Â  namespace: minio<br>Â  labels:<br>Â  Â  app: minio<br>spec:<br>Â  ports:<br>Â  - port: 9000<br>Â  Â  protocol: TCP<br>Â  selector:<br>Â  Â  app: minio</code></p>\n<p>PersistentVolumeClaim (from microk8s host provisioner)<br><code>apiVersion: v1<br>kind: PersistentVolumeClaim<br>metadata:<br>Â  namespace: minio<br>Â  name: minio-pv-claim<br>Â  labels:<br>Â  Â  app: minio-storage-claim<br>spec:<br>Â  storageClassName: microk8s-hostpath<br>Â  accessModes:<br>Â  Â  - ReadWriteOnce<br>Â  resources:<br>Â  Â  requests:<br>Â  Â  Â  storage: 1Gi</code></p>\n<p>Deployment (remember to use secrets instead write directly into deployment)<br><code>kind: Deployment<br>metadata:<br>Â  name: minio-deployment<br>Â  namespace: minio<br>spec:<br>Â  selector:<br>Â  Â  matchLabels:<br>Â  Â  Â  app: minio<br>Â  strategy:<br>Â  Â  type: Recreate<br>Â  template:<br>Â  Â  metadata:<br>Â  Â  Â  labels:<br>Â  Â  Â  Â  app: minio<br>Â  Â  spec:<br>Â  Â  Â  volumes:<br>Â  Â  Â  - name: storage<br>Â  Â  Â  Â  persistentVolumeClaim:<br>Â  Â  Â  Â  Â  claimName: minio-pv-claim<br>Â  Â  Â  containers:<br>Â  Â  Â  - name: minio<br>Â  Â  Â  Â  image: minio/minio:latest<br>Â  Â  Â  Â  args:<br>Â  Â  Â  Â  - server<br>Â  Â  Â  Â  - /storage<br>Â  Â  Â  Â  env:<br>Â  Â  Â  Â  - name: MINIO_ACCESS_KEY<br>Â  Â  Â  Â  Â  value: \"$something\"<br>Â  Â  Â  Â  - name: MINIO_SECRET_KEY<br>Â  Â  Â  Â  Â  value: \"$somethingsecret\"<br>Â  Â  Â  Â  - name: MINIO_DOMAIN<br>Â  Â  Â  Â  Â  value: minio.h4x0r3d.lan<br>Â  Â  Â  Â  ports:<br>Â  Â  Â  Â  - containerPort: 9000<br>Â  Â  Â  Â  Â  hostPort: 9000<br>Â  Â  Â  Â  volumeMounts:<br>Â  Â  Â  Â  - name: storage<br>Â  Â  Â  Â  Â  mountPath: \"/storage\"</code></p>\n<p>Ingress resource<br><code>kind: Ingress<br>metadata:<br>Â  name: minio-ingress<br>Â  namespace: minio<br>Â  annotations:<br>Â  Â  kubernetes.io/ingress.class: nginx<br>Â  Â  nginx.org/client-max-body-size: 1000m<br>Â  Â  ingress.kubernetes.io/proxy-body-size: 1000m<br>spec:<br>Â  rules:<br>Â  - host: minio.h4x0r3d.lan<br>Â  Â  http:<br>Â  Â  Â  paths:<br>Â  Â  Â  - path: /<br>Â  Â  Â  Â  backend:<br>Â  Â  Â  Â  Â  serviceName: minio-svc<br>Â  Â  Â  Â  Â  servicePort: 9000</code></p>\n<p>And at the end you will have something like this</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/18/Screenshot-2020-12-26-at-13.55.38.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.55.38-xs.png 300w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.55.38-sm.png 480w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.55.38-md.png 768w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.55.38-lg.png 1024w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.55.38-xl.png 1360w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.55.38-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"678\"></figure>\n<p>you can configure Publii in this way</p>\n<p>where bucket is the third level name of you dns and prefix \"the bucket\"</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/18/Screenshot-2020-12-26-at-13.56.43.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.56.43-xs.png 300w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.56.43-sm.png 480w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.56.43-md.png 768w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.56.43-lg.png 1024w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.56.43-xl.png 1360w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-13.56.43-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"811\"></figure>\n<p>Btw an object storage is <strong>NOT</strong> a web server so you need an apache or nginx configuration<br>to have the site ready to be used<br><code>&lt;VirtualHost *:80&gt;<br>Â  Â  ServerAdmin l@k8s.it<br>Â  Â  DocumentRoot /usr/local/apache2/htdocs/<br>Â  Â  ServerName www.k8s.it<br>Â  Â  ErrorLog logs/www.k8s-error_log<br>Â  Â  CustomLog logs/www.k8s-access_log combined<br>Â  Â  LoadModule rewrite_module modules/mod_rewrite.so<br>Â  Â  ProxyRequests Off<br>Â  Â  ProxyPass / http://minio-svc.minio.svc.cluster.local:9000/blog/<br>Â  Â  RewriteEngine on<br>Â  Â  RewriteRule ^(.*)/$ /$1/index.html [PT,L]<br>Â &lt;/VirtualHost&gt;</code></p>\n<p>Â </p>\n<p>Again ... <strong>keep it simple</strong>... there no right solutions overall , there is the right way for you needs, in my case i'm still using github pages because are free, enough to cover my needs and <em>serverless</em></p>\n<h3>Â </h3>\n<h3>Security</h3>\n<p>Even if the security is demanded to github, why not extend a sort of protection on top of it</p>\n<p>Second pillar , <strong>keep it safe</strong></p>\n<p>In my case i really appreciate Cloudflare and the free plan that give me the possibility to test and explore the functionality offered</p>\n<p>I've already shared how to configure a website with Cloudflare with terraform <a href=\"https://www.k8s.it/terraform-your-free-claudflare-account.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.k8s.it/terraform-your-free-claudflare-account.html</a></p>\n<p>Even if we are covered by attacks since it's static webpage ... and we also added the Cloudflare protection we can have some <em>cosmetics</em> feature that will share a better compliance with the security in 2020</p>\n<p>As i said github pages and s3 are not webserver so ... <br>how we can introduce the security headers ?</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/18/screencapture-securityheaders-2020-12-24-20_33_23.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_33_23-xs.png 300w ,https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_33_23-sm.png 480w ,https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_33_23-md.png 768w ,https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_33_23-lg.png 1024w ,https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_33_23-xl.png 1360w ,https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_33_23-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"1758\"></figure>\n<p>Â </p>\n<p>Again Cloudflare help us with the <a href=\"https://blog.cloudflare.com/cloudflare-workers-unleashed/\" target=\"_blank\" rel=\"noopener noreferrer\">Workers</a> feature</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/18/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-edit-security-headers-2020-12-24-20_38_25-2.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-edit-security-headers-2020-12-24-20_38_25-2-xs.png 300w ,https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-edit-security-headers-2020-12-24-20_38_25-2-sm.png 480w ,https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-edit-security-headers-2020-12-24-20_38_25-2-md.png 768w ,https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-edit-security-headers-2020-12-24-20_38_25-2-lg.png 1024w ,https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-edit-security-headers-2020-12-24-20_38_25-2-xl.png 1360w ,https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-edit-security-headers-2020-12-24-20_38_25-2-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"516\"></figure>\n<p>The code (<a href=\"https://scotthelme.co.uk/security-headers-cloudflare-worker/\" target=\"_blank\" rel=\"noopener noreferrer\">rif</a>.) is adding those headers with serverless functionÂ  for each request</p>\n<p><code>const securityHeaders = {<br>Â  Â  Â  Â  \"Content-Security-Policy\": \"upgrade-insecure-requests\",<br>Â  Â  Â  Â  \"Strict-Transport-Security\": \"max-age=3600\",<br>Â  Â  Â  Â  \"X-Xss-Protection\": \"1; mode=block\",<br>Â  Â  Â  Â  \"X-Frame-Options\": \"DENY\",<br>Â  Â  Â  Â  \"X-Content-Type-Options\": \"nosniff\",<br>Â  Â  Â  Â  \"Permissions-Policy\": \"geolocation=()\",<br>Â  Â  Â  Â  \"Referrer-Policy\": \"strict-origin-when-cross-origin\"<br>Â  Â  };<br><br><br>async function addHeaders(req) {<br>Â  Â  const response = await fetch(req),<br>Â  Â  Â  Â  newHeaders = new Headers(response.headers),<br>Â  Â  Â  Â  setHeaders = Object.assign({}, securityHeaders);<br><br>Â  Â  if (newHeaders.has(\"Content-Type\") &amp;&amp; !newHeaders.get(\"Content-Type\").includes(\"text/html\")) {<br>Â  Â  Â  Â  return new Response(response.body, {<br>Â  Â  Â  Â  Â  Â  status: response.status,<br>Â  Â  Â  Â  Â  Â  statusText: response.statusText,<br>Â  Â  Â  Â  Â  Â  headers: newHeaders<br>Â  Â  Â  Â  });<br>Â  Â  }<br><br>Â  Â  Object.keys(setHeaders).forEach(name =&gt; newHeaders.set(name, setHeaders[name]));<br><br><br>Â  Â  return new Response(response.body, {<br>Â  Â  Â  Â  status: response.status,<br>Â  Â  Â  Â  statusText: response.statusText,<br>Â  Â  Â  Â  headers: newHeaders<br>Â  Â  });<br>}<br><br>addEventListener(\"fetch\", event =&gt; event.respondWith(addHeaders(event.request)));</code></p>\n<p>Â </p>\n<p>Now the website is better from this point of view, adding the worker to the main route</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/18/Screenshot-2020-12-27-at-13.41.47.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.41.47-xs.png 300w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.41.47-sm.png 480w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.41.47-md.png 768w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.41.47-lg.png 1024w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.41.47-xl.png 1360w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.41.47-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"476\"></figure>\n<p>Results</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/18/screencapture-securityheaders-2020-12-24-20_34_27.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_34_27-xs.png 300w ,https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_34_27-sm.png 480w ,https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_34_27-md.png 768w ,https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_34_27-lg.png 1024w ,https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_34_27-xl.png 1360w ,https://www.k8s.it/media/posts/18/responsive/screencapture-securityheaders-2020-12-24-20_34_27-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"1959\"></figure>\n<p>Just a warning because Strict-Transport-Security has a low value , but it's something acceptable to me</p>\n<p>Cloudflare details the usage of workers that is limited in the free account for 100k req/day and 1k/min</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/18/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-view-security-headers-2020-12-27-13_42_52.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-view-security-headers-2020-12-27-13_42_52-xs.png 300w ,https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-view-security-headers-2020-12-27-13_42_52-sm.png 480w ,https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-view-security-headers-2020-12-27-13_42_52-md.png 768w ,https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-view-security-headers-2020-12-27-13_42_52-lg.png 1024w ,https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-view-security-headers-2020-12-27-13_42_52-xl.png 1360w ,https://www.k8s.it/media/posts/18/responsive/screencapture-dash-cloudflare-9fb3653b948e447567a30f6b83e51eaf-workers-view-security-headers-2020-12-27-13_42_52-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"1954\"></figure>\n<p>OKRÂ </p>\n<ul>\n<li>website is managed with no database</li>\n<li>we have serverless way to host it and with free options</li>\n<li>overall protection from Cloudflare</li>\n<li>security headers from Cloudflare workers, again another serveless option</li>\n</ul>\n<p>Â </p>\n<p><code></code><code></code><code></code></p>\n<div>\n<div><code></code><code></code></div>\n</div>\n<h3>Monitor</h3>\n<p>What is missing now ?</p>\n<p>A bit of <strong>awareness</strong></p>\n<p>Are we safe ? maybe but better an external opinion , around the online scanner there are multiple tools , however <a href=\"https://probely.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Probely</a> has a good free plan</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/18/Screenshot-2020-12-26-at-14.58.41.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-14.58.41-xs.png 300w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-14.58.41-sm.png 480w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-14.58.41-md.png 768w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-14.58.41-lg.png 1024w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-14.58.41-xl.png 1360w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-14.58.41-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"434\"></figure>\n<p>Here some hints about sensitive data shared with their crowler</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/18/Screenshot-2020-12-26-at-15.00.00.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.00.00-xs.png 300w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.00.00-sm.png 480w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.00.00-md.png 768w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.00.00-lg.png 1024w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.00.00-xl.png 1360w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.00.00-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"512\"></figure>\n<p>Nothing relevant in my case... but useful to know</p>\n<p>Â </p>\n<p>Is now time to know , how is performing the website to do this i already had a deepdive about website usability</p>\n<p><a href=\"https://www.k8s.it/kubernetes-sitespeedio.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.k8s.it/kubernetes-sitespeedio.html</a></p>\n<p>but again we have some other feature serverless style like <a href=\"https://github.com/upptime/upptime\" target=\"_blank\" rel=\"noopener noreferrer\">upptime</a> ,with github actions you can create a monitoring system like this <a href=\"https://lorenzogirardi.github.io/status/\" target=\"_blank\" rel=\"noopener noreferrer\">https://lorenzogirardi.github.io/status/</a></p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/18/Screenshot-2020-12-26-at-15.04.18.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.04.18-xs.png 300w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.04.18-sm.png 480w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.04.18-md.png 768w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.04.18-lg.png 1024w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.04.18-xl.png 1360w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.04.18-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"774\"></figure>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/18/Screenshot-2020-12-27-at-13.36.35.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.36.35-xs.png 300w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.36.35-sm.png 480w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.36.35-md.png 768w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.36.35-lg.png 1024w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.36.35-xl.png 1360w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-27-at-13.36.35-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"859\"></figure>\n<p>Another alternative is <a href=\"https://hetrixtools.com/\" target=\"_blank\" rel=\"noopener noreferrer\">hetrixtools</a> , free up top 15 probes that give you the possibility to monitor your websites and smtp, and have an alerting system out of the box with a telegram bot email and sms (up to 50)</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/18/screencapture-hetrixtools-report-uptime-c7596615176a822f81d67cfddc4aa179-2020-12-26-15_14_22.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/18/responsive/screencapture-hetrixtools-report-uptime-c7596615176a822f81d67cfddc4aa179-2020-12-26-15_14_22-xs.png 300w ,https://www.k8s.it/media/posts/18/responsive/screencapture-hetrixtools-report-uptime-c7596615176a822f81d67cfddc4aa179-2020-12-26-15_14_22-sm.png 480w ,https://www.k8s.it/media/posts/18/responsive/screencapture-hetrixtools-report-uptime-c7596615176a822f81d67cfddc4aa179-2020-12-26-15_14_22-md.png 768w ,https://www.k8s.it/media/posts/18/responsive/screencapture-hetrixtools-report-uptime-c7596615176a822f81d67cfddc4aa179-2020-12-26-15_14_22-lg.png 1024w ,https://www.k8s.it/media/posts/18/responsive/screencapture-hetrixtools-report-uptime-c7596615176a822f81d67cfddc4aa179-2020-12-26-15_14_22-xl.png 1360w ,https://www.k8s.it/media/posts/18/responsive/screencapture-hetrixtools-report-uptime-c7596615176a822f81d67cfddc4aa179-2020-12-26-15_14_22-2xl.png 1600w\"  alt=\"\" width=\"1024\" height=\"1620\"></figure>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.k8s.it/media/posts/18/Screenshot-2020-12-26-at-15.07.32.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.07.32-xs.png 300w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.07.32-sm.png 480w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.07.32-md.png 768w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.07.32-lg.png 1024w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.07.32-xl.png 1360w ,https://www.k8s.it/media/posts/18/responsive/Screenshot-2020-12-26-at-15.07.32-2xl.png 1600w\"  alt=\"\" width=\"974\" height=\"380\"></figure>\n<p>Â </p>\n<p>Â </p>\n<p>Hope this post cover how the technology could be used as much as possible in a small and cheap scenario to reflect some hints to an enterprise scenario.</p>\n<p>Â </p>",
            "image": "https://www.k8s.it/media/posts/18/Screenshot-2020-12-26-at-16.43.11.png",
            "author": {
                "name": "lgirardi"
            },
            "tags": [
                   "workers",
                   "website",
                   "static cms",
                   "static",
                   "serverless",
                   "security",
                   "publii",
                   "minio",
                   "kubernetes",
                   "headers",
                   "cms",
                   "cloudflare"
            ],
            "date_published": "2020-12-24T20:53:20+01:00",
            "date_modified": "2020-12-28T09:58:59+01:00"
        },
        {
            "id": "https://www.k8s.it/kubernetes-destroyed-the-virtualization-or-not.html",
            "url": "https://www.k8s.it/kubernetes-destroyed-the-virtualization-or-not.html",
            "title": "Kubernetes has destroyed the virtualization... or NOT",
            "summary": "Well ...Â NO! Ok maybe are missing some context I started this topic looking around the data center world compared with the cloud providers, the advantage of manage services , the mindset infrastructure as a code and so on ... In the last 4y we saw&hellip;",
            "content_html": "<p>Well ...Â <strong>NO!</strong></p>\n<p>Ok maybe are missing some context</p>\n<p>Â </p>\n<p>I started this topic looking around the data center world compared with the cloud providers,<br>the advantage of manage services , the mindset infrastructure as a code and so on ...</p>\n<p>In the last 4y we saw a kubernetes rush , a lot of company are sharing the advantages and the perfect picture create into kubernetes, how they save money or scale fast ... but is always true what we see?<br>Most of the times we are saw only builded success case.</p>\n<p>Today we will take in consideration those topics :</p>\n<ul>\n<li>Virtual machines</li>\n<li>Data center</li>\n<li>Kubernetes</li>\n</ul>\n<p>I know that the Data center topic should be covered more in deep, maybe talking about the entire ecosystem (db, vertical services , corporate usage , LEGACY!!!!) however today i'd like to explore only the kubernetes and virtualization rather than lose the discussion in thousand of concepts.</p>\n<h3>Long story short</h3>\n<p>A long time ago Borg was born in Google .. now formally named kubernetes,<br>in the first period the main evaluation was:<br>\"<em>why the virtualization overhead if we will use kubernetes</em>\".<br><br>This concept was justified in some way forÂ <em>overlapping</em>Â of duties,<br>if i migrate a vm as a kubernetes pod this means i can remove the vmÂ <br><br></p>\n<figure class=\"post__image post__image--center\">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img loading=\"lazy\"  src=\"https://res.cloudinary.com/ethzero/image/upload/v1607974463/misc/vm_vs_pod.png\" data-is-external-image=\"true\"  alt=\"\" width=\"337\" height=\"181\"></figure>\n<p>Â </p>\n<p>Â </p>\n<p>We can imagine a picture like this looking back of some years ago</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://res.cloudinary.com/ethzero/image/upload/v1607963386/misc/vm_1.png\" data-is-external-image=\"true\"  alt=\"\" width=\"745\" height=\"386\"></figure>\n<figure class=\"post__image\">The introduction was good , almost all declared this could be a new way.<br>Moving faster, all companies changed a bit this picture with an expansion of kubernetesÂ </figure>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://res.cloudinary.com/ethzero/image/upload/v1607963386/misc/vm_2.png\" data-is-external-image=\"true\"  alt=\"\" width=\"745\" height=\"386\"></figure><figure class=\"is-loaded\"><img loading=\"lazy\"  src=\"Kubernetes destroyed the virtualization... or NOT - LAB_files/vm_2.png\" data-is-external-image=\"true\"  alt=\"\" width=\"745\" height=\"386\" data-is-external-image=\"true\"></figure>\n<p>Like an infection (good this time, not the 20covid ones) kubernetes come as a main platform for most of the online company...<br>In a datacenter , you know, there no something eternal:</p>\n<ul>\n<li>hardware in EOL</li>\n<li>generation refresh</li>\n<li>brand change</li>\n<li>good is ok but cheaper is better (usually from finance)</li>\n</ul>\n<p>Is also true , that sometimes this encouraged a forced/incorrect usage of kubernetes node labeling in order to bend the infrastructure to better fit the products migrated or the existing hardware availability</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://res.cloudinary.com/ethzero/image/upload/v1607959262/misc/vm_3.png\" data-is-external-image=\"true\"  alt=\"\" width=\"748\" height=\"389\"></figure>\n<figure class=\"post__image\"><figure class=\"is-loaded\"><img loading=\"lazy\"  src=\"Kubernetes destroyed the virtualization... or NOT - LAB_files/vm_3.png\" data-is-external-image=\"true\"  alt=\"\" data-is-external-image=\"true\"></figure></figure>\n<h3>Houston we have a problem...</h3>\n<p>Working in this way, the environment could be fragmented ,<br>even if the technology is the same there are some logical segmentations that create some problems in the day by day activities.</p>\n<ul>\n<li>isolate some workloads with labels can create an hw lock-in (better approach a multi-cluster with unique controlplane)</li>\n<li>updates require to be managed in a different way looking for the label/role</li>\n<li>please do not touch the storage nodes now (fiber channel with external storage)</li>\n<li>please do not touch the storage nodes tomorrow (fiber channel with external storage)</li>\n<li>omg we lost a storage nodes (fiber channel with external storage)</li>\n<li>and so on ...</li>\n</ul>\n<p>Moreover an hardware fault could create problems .... <br>YES i know in a infrastructure as a code , with puppet foreman chef salt ansible terraform etc, this will be recovered fast ... but this is not always true ... you know... some machines/roles in a mid/ent company are still fragile.</p>\n<ul>\n<li>legacy with no ownership</li>\n<li>legacy with wrong ownership</li>\n<li>single point of failure ... (yes also in 2020)</li>\n</ul>\n<p>Â </p>\n<p>Other problems are related with new hardware...</p>\n<ul>\n<li>is the provisioning working as expected with new generations ?</li>\n<li>and if we change the hardware vendor ?</li>\n<li>etc etc when you have to handle new preseed/ks because the layout is changed â˜ ï¸</li>\n</ul>\n<p>Â </p>\n<p>Last but not least ... what about the bare metal density ?</p>\n<p><code>Allocated resources:</code><br><code>Â (<span class=\"il\">Total</span>Â <span class=\"il\">limits</span>Â <span class=\"il\">may</span>Â beÂ <span class=\"il\">over</span>Â <span class=\"il\">100</span>Â <span class=\"il\">percent</span>, i.e.,Â <span class=\"il\">overcommitted</span>.</code><br><code>Â CPU Requests CPUÂ <span class=\"il\">Limits</span>Â Memory Requests MemoryÂ <span class=\"il\">Limits</span></code><br><code>Â ------------ ---------- --------------- -------------</code><br><code>Â 55 (98%) 101300m (180%) 86376Mi (44%) 121672Mi (62%)</code></p>\n<p>This HW has 56 core with HT , we reached the 98% but this number is high <br>because some pods needs a default cpu just to fit the nodes and start, while the running cost is really low.Â </p>\n<p>Â </p>\n<h3>So why not kubernetes hosted in virtual machines ?</h3>\n<ul>\n<li>Having an abstraction layer, is quite simple tune the provisioning based on this , rather than the bare metal, it's just a metter of roles not to the entire provisioning.</li>\n<li>Hardware fault could be easily covered by live migration</li>\n<li>Maintenance and update can be manage creating a blue green approach and rolling updates</li>\n<li>Density could be increased with mode nodes in the same hw</li>\n<li>Flexibility to scale up and to upset a new datacenter in case of migration will be higher</li>\n<li>Team at the and is also able to scale , working from the vmware and not from bare metal</li>\n</ul>\n<figure class=\"post__image post__image--center\"><figure class=\"post__image\"><img loading=\"lazy\"  src=\"https://res.cloudinary.com/ethzero/image/upload/v1607961166/misc/team_scale.png\" data-is-external-image=\"true\"  alt=\"\" width=\"718\" height=\"353\"></figure></figure>\n<h3>Â </h3>\n<h3>Conclusions</h3>\n<p>Virtualization and kubernetes are not antagonist, must be in addition , the first one has just change the scope to better cooperate with kubernetes</p>\n<p>Instead a layer for microservices , virtualization is now the layer that guarantee an homogeneous platform were a team can work on top to create the infrastructure having the advantage of a fully consolidated technology that is able to promote the right abstractionÂ </p>\n<p>Last but not least , we don't need to reinvent something , we can just copy from the major competitors for the kubernetes topic<br>How is working GKE , AKS , EKS ? .... virtual machines :)</p>",
            "author": {
                "name": "lgirardi"
            },
            "tags": [
                   "virtualization",
                   "virtual machines",
                   "scalability",
                   "pod",
                   "kubernetes",
                   "datacenter",
                   "cloud"
            ],
            "date_published": "2020-12-07T14:40:52+01:00",
            "date_modified": "2020-12-28T10:02:18+01:00"
        },
        {
            "id": "https://www.k8s.it/kubernetes-apigw.html",
            "url": "https://www.k8s.it/kubernetes-apigw.html",
            "title": "Kubernetes api gateway",
            "summary": "It's time to talk about the api gateway In a modern infrastructure , especially in a microservices environment you probably know what i'm referring to ,however it's better to clarify some points. An API gateway takes all API calls from clients, then routes them to&hellip;",
            "content_html": "<p>It's time to talk about the api gateway</p>\n<p>In a modern infrastructure , especially in a microservices environment you probably know what i'm referring to ,however it's better to clarify some points.</p>\n<p><em>An API gateway takes all API calls from clients, then routes them to the appropriate microservice with request routing, composition, and protocol translation. Typically it handles a request by invoking multiple microservices and aggregating the results, to determine the best path. It can translate between web protocols and webâ€‘unfriendly protocols that are used internally.</em></p>\n<p><em>An eâ€‘commerce site might use an API gateway to provide mobile clients with an endpoint for retrieving all product details with a single request. It invokes various services, like product info and reviews, and combines the results</em></p>\n<p><br><br></p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/70d257f92412994f23cfce0b702ca359556a2b64b7835f8f3ef9b58a493a4d60/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313630343833393633312f6d6973632f61706967772e706e67\"><img loading=\"lazy\" title=\"apigw\" src=\"https://camo.githubusercontent.com/70d257f92412994f23cfce0b702ca359556a2b64b7835f8f3ef9b58a493a4d60/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313630343833393633312f6d6973632f61706967772e706e67\" data-is-external-image=\"true\"  alt=\"apigw\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/v1604839631/misc/apigw.png\"></a></p>\n<p><br><br></p>\n<p>Some months ago i discussed about the service mesh<br><a href=\"https://github.com/lorenzogirardi/kubernetes-servicemesh\">https://github.com/lorenzogirardi/kubernetes-servicemesh</a></p>\n<p>To better understand the differences on those products it is better to summarize the common areas</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/43086b5aea0afa64170f3dac4261da1ad4a2ae2645d428fee16b7ce2eb6484f1/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313032342f76313630343730333838302f6d6973632f61706967775f76735f736572766963656d6573682e706e67\"><img loading=\"lazy\" title=\"apigw_vs_servicemesh\" src=\"https://camo.githubusercontent.com/43086b5aea0afa64170f3dac4261da1ad4a2ae2645d428fee16b7ce2eb6484f1/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313032342f76313630343730333838302f6d6973632f61706967775f76735f736572766963656d6573682e706e67\" data-is-external-image=\"true\"  alt=\"apigw_vs_servicemesh\" width=\"491\" height=\"328\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_1024/v1604703880/misc/apigw_vs_servicemesh.png\"></a></p>\n<p>So forget about service mesh and have the focus only on the apigw.</p>\n<p><br><br></p>\n<h2><a id=\"user-content-goal\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/Kubernetes-apigw#goal\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>GOAL</h2>\n<p>Needed:</p>\n<ul>\n<li>Api must be public</li>\n<li>Users needs to have authentication</li>\n<li>An user could be rate limited</li>\n<li>A service could be rate limited</li>\n<li>Backend applications should not be changed</li>\n<li>We need to interact as a code with the apigw<br><br><br></li>\n</ul>\n<p>Important:</p>\n<ul>\n<li>Analytics</li>\n<li>Transformation</li>\n<li>Versioning</li>\n<li>Circuit Breaker</li>\n<li>gRPC support</li>\n<li>Caching</li>\n<li>Documentation</li>\n</ul>\n<p><br><br></p>\n<h2><a id=\"user-content-software-opportunity\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/Kubernetes-apigw#software-opportunity\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Software opportunity</h2>\n<p>Around the api gateway world we have some possibility, some of those are onprem, some other in cloud or hybrid.</p>\n<p>The onprem scenario we have some historycal software and a \"new generation\" born in a kubernetes architecture, howevere here we will check for a tool that could work in kubernetes (with a plus for supporting vm)</p>\n<p>From the most knew i'd like to mention:</p>\n<ul>\n<li>Kong</li>\n<li>Tyk</li>\n<li>Nginx</li>\n<li>Ambassador</li>\n<li>3scale</li>\n</ul>\n<p>On the other side on the cloud scenario we have:</p>\n<ul>\n<li>Aws api gateway</li>\n<li>Mashery (from Tibco)</li>\n<li>Google apigee</li>\n<li>Akana (hybrid)</li>\n<li>Azure api management</li>\n</ul>\n<table style=\"border-collapse: collapse; width: 100%;\" border=\"1\">\n<tbody>\n<tr>\n<th style=\"width: 16.932%;\">Â </th>\n<th style=\"width: 15.3401%;\">nginx</th>\n<th style=\"width: 16.2084%;\">kong</th>\n<th style=\"width: 13.1693%;\">tyk</th>\n<th style=\"width: 15.3401%;\">ambassador</th>\n<th style=\"width: 36.4688%;\">aws api gw</th>\n</tr>\n<tr>\n<td style=\"width: 16.932%;\">basic</td>\n<td style=\"width: 15.3401%;\">yes</td>\n<td style=\"width: 16.2084%;\">yes</td>\n<td style=\"width: 13.1693%;\">yes</td>\n<td style=\"width: 15.3401%;\">yes</td>\n<td style=\"width: 36.4688%;\">pay</td>\n</tr>\n<tr>\n<td style=\"width: 16.932%;\">oauth</td>\n<td style=\"width: 15.3401%;\">pay</td>\n<td style=\"width: 16.2084%;\">yes</td>\n<td style=\"width: 13.1693%;\">yes</td>\n<td style=\"width: 15.3401%;\">pay</td>\n<td style=\"width: 36.4688%;\">pay</td>\n</tr>\n<tr>\n<td style=\"width: 16.932%;\">jwt</td>\n<td style=\"width: 15.3401%;\">pay</td>\n<td style=\"width: 16.2084%;\">yes</td>\n<td style=\"width: 13.1693%;\">yes</td>\n<td style=\"width: 15.3401%;\">pay</td>\n<td style=\"width: 36.4688%;\">pay</td>\n</tr>\n<tr>\n<td style=\"width: 16.932%;\">ip listing</td>\n<td style=\"width: 15.3401%;\">yes</td>\n<td style=\"width: 16.2084%;\">yes</td>\n<td style=\"width: 13.1693%;\">yes</td>\n<td style=\"width: 15.3401%;\">no</td>\n<td style=\"width: 36.4688%;\">pay</td>\n</tr>\n<tr>\n<td style=\"width: 16.932%;\">analytics</td>\n<td style=\"width: 15.3401%;\">yes</td>\n<td style=\"width: 16.2084%;\">yes</td>\n<td style=\"width: 13.1693%;\">yes</td>\n<td style=\"width: 15.3401%;\">yes</td>\n<td style=\"width: 36.4688%;\">pay</td>\n</tr>\n<tr>\n<td style=\"width: 16.932%;\">rate limiting</td>\n<td style=\"width: 15.3401%;\">yes</td>\n<td style=\"width: 16.2084%;\">yes</td>\n<td style=\"width: 13.1693%;\">yes</td>\n<td style=\"width: 15.3401%;\">yes</td>\n<td style=\"width: 36.4688%;\">pay</td>\n</tr>\n<tr>\n<td style=\"width: 16.932%;\">transformation</td>\n<td style=\"width: 15.3401%;\">pay</td>\n<td style=\"width: 16.2084%;\">yes</td>\n<td style=\"width: 13.1693%;\">yes</td>\n<td style=\"width: 15.3401%;\">yes</td>\n<td style=\"width: 36.4688%;\">pay</td>\n</tr>\n<tr>\n<td style=\"width: 16.932%;\">grpc</td>\n<td style=\"width: 15.3401%;\">yes</td>\n<td style=\"width: 16.2084%;\">yes</td>\n<td style=\"width: 13.1693%;\">yes</td>\n<td style=\"width: 15.3401%;\">yes</td>\n<td style=\"width: 36.4688%;\">no</td>\n</tr>\n<tr>\n<td style=\"width: 16.932%;\">websocket</td>\n<td style=\"width: 15.3401%;\">yes</td>\n<td style=\"width: 16.2084%;\">yes</td>\n<td style=\"width: 13.1693%;\">yes</td>\n<td style=\"width: 15.3401%;\">yes</td>\n<td style=\"width: 36.4688%;\">pay</td>\n</tr>\n<tr>\n<td style=\"width: 16.932%;\">service mesh</td>\n<td style=\"width: 15.3401%;\">no</td>\n<td style=\"width: 16.2084%;\">yes</td>\n<td style=\"width: 13.1693%;\">yes</td>\n<td style=\"width: 15.3401%;\">pay</td>\n<td style=\"width: 36.4688%;\">no</td>\n</tr>\n<tr>\n<td style=\"width: 16.932%;\">k8s ingress</td>\n<td style=\"width: 15.3401%;\">yes</td>\n<td style=\"width: 16.2084%;\">yes</td>\n<td style=\"width: 13.1693%;\">yes</td>\n<td style=\"width: 15.3401%;\">yes</td>\n<td style=\"width: 36.4688%;\">no</td>\n</tr>\n<tr>\n<td style=\"width: 16.932%;\">caching</td>\n<td style=\"width: 15.3401%;\">yes</td>\n<td style=\"width: 16.2084%;\">pay</td>\n<td style=\"width: 13.1693%;\">yes</td>\n<td style=\"width: 15.3401%;\">no</td>\n<td style=\"width: 36.4688%;\">pay</td>\n</tr>\n<tr>\n<td style=\"width: 16.932%;\">documentation</td>\n<td style=\"width: 15.3401%;\">pay</td>\n<td style=\"width: 16.2084%;\">yes</td>\n<td style=\"width: 13.1693%;\">yes</td>\n<td style=\"width: 15.3401%;\">no</td>\n<td style=\"width: 36.4688%;\">pay</td>\n</tr>\n<tr>\n<td style=\"width: 16.932%;\">admin ui</td>\n<td style=\"width: 15.3401%;\">pay</td>\n<td style=\"width: 16.2084%;\">trd party</td>\n<td style=\"width: 13.1693%;\">yes</td>\n<td style=\"width: 15.3401%;\">no</td>\n<td style=\"width: 36.4688%;\">pay</td>\n</tr>\n<tr>\n<td style=\"width: 16.932%;\">ease to setup</td>\n<td style=\"width: 15.3401%;\">3.5</td>\n<td style=\"width: 16.2084%;\">4</td>\n<td style=\"width: 13.1693%;\">2.5</td>\n<td style=\"width: 15.3401%;\">3</td>\n<td style=\"width: 36.4688%;\">5</td>\n</tr>\n</tbody>\n</table>\n<p>Â </p>\n<p>Cloud</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/6f7e05d1971da2d537452717a8571e3fc13ac8a7471428550e0cf065ca2997e1/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313630343736363830322f6d6973632f61706967775f636c6f75642e706e67\"><img loading=\"lazy\" title=\"apigw_cloud\" src=\"https://camo.githubusercontent.com/6f7e05d1971da2d537452717a8571e3fc13ac8a7471428550e0cf065ca2997e1/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313630343736363830322f6d6973632f61706967775f636c6f75642e706e67\" data-is-external-image=\"true\"  alt=\"apigw_cloud\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/v1604766802/misc/apigw_cloud.png\"></a></p>\n<p>The advantage/disadvantage of cloud solution is the pay per use, you don't need to manage the infrastrcture but only the configuration and you have the support that can drive you on the right configuration.<br>Another valid point of view is theÂ <em>DDOS</em>Â attack that will not land to your platform but to a cloud infrastructure that is supposed was designed to manage this scenario.</p>\n<p>PRO:</p>\n<ul>\n<li>managed infrastructure</li>\n<li>support</li>\n<li>attacks mitigation</li>\n</ul>\n<p>CONS:</p>\n<ul>\n<li>pricing</li>\n<li>often not customizable<br><br></li>\n</ul>\n<p>Onprem</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/f650f08e78f1fa640565179fa79ccedcb5928fc85554118e8b2cbb720bbea6e6/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313630343736363830322f6d6973632f61706967775f64632e706e67\"><img loading=\"lazy\" title=\"apigw_dc\" src=\"https://camo.githubusercontent.com/f650f08e78f1fa640565179fa79ccedcb5928fc85554118e8b2cbb720bbea6e6/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313630343736363830322f6d6973632f61706967775f64632e706e67\" data-is-external-image=\"true\"  alt=\"apigw_dc\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/v1604766802/misc/apigw_dc.png\"></a></p>\n<p>Those solutions should be hosted on your platform or in a cloud to let the datacenterÂ <em>unknown</em>Â (anyway you have to pay per traffic \"*\" ).<br>Your engineer team need to know how it's working the infrastructure but they can also improve the process with automations</p>\n<p>PRO:</p>\n<ul>\n<li>open source</li>\n<li>customizable</li>\n<li>awareness on the complete funnel</li>\n</ul>\n<p>CONS:</p>\n<ul>\n<li>you have to take care about attacks</li>\n<li>infrastructure knowhow</li>\n</ul>\n<p><br><br>\"*\" you can easly have the apigw hosted onprem combined with a cdn/waf with ip lockdown , however you still have to pay the traffic towards it.</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/e66b9fb512155cc277683660dd1ab517d7e9b9e50f023d3fc53f2b7e06a9f5e7/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313630343736363830322f6d6973632f61706967775f7761662e706e67\"><img loading=\"lazy\" title=\"apigw_waf\" src=\"https://camo.githubusercontent.com/e66b9fb512155cc277683660dd1ab517d7e9b9e50f023d3fc53f2b7e06a9f5e7/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313630343736363830322f6d6973632f61706967775f7761662e706e67\" data-is-external-image=\"true\"  alt=\"apigw_waf\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/v1604766802/misc/apigw_waf.png\"></a></p>\n<p><br><br></p>\n<h2><a id=\"user-content-scenario\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/Kubernetes-apigw#scenario\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Scenario</h2>\n<p>I tried some cloud solution like Aws and Mashery,<br>i played also with some onprem solution, anyway i found out the right compromise withÂ <a href=\"https://konghq.com/kong/\" rel=\"nofollow\">Kong</a></p>\n<p>where compromise is :</p>\n<ul>\n<li><strong>Kubernetes ingress</strong></li>\n<li><strong>Api managed</strong></li>\n<li><strong>Documentation</strong></li>\n<li>Admin UI (konga for the open source)</li>\n<li>Basic auth</li>\n<li><strong>Apikey</strong></li>\n<li><strong>Oauth</strong></li>\n<li><strong>JWT</strong></li>\n<li>ip listing</li>\n<li><strong>Analytics</strong></li>\n<li><strong>Rate limiting</strong></li>\n<li><strong>Transformation</strong></li>\n<li>gRPC</li>\n<li>Websockets</li>\n<li>Service mesh (~ nice to have)</li>\n<li><strong>Easy to use</strong></li>\n</ul>\n<p><br><br></p>\n<h2><a id=\"user-content-infrastructure\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/Kubernetes-apigw#infrastructure\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Infrastructure</h2>\n<ul>\n<li>kubernetes</li>\n<li>backend application</li>\n<li>kong api gateway</li>\n<li>konga admin ui</li>\n<li>waf (free cloudflare service)</li>\n</ul>\n<p><br><br></p>\n<p>What we need for this test is a backend api application, i created a prototype just to simulate different applications behind the apigw.</p>\n<p>Here you can find out more details</p>\n<p><a href=\"https://github.com/lorenzogirardi/py-test-backend\">https://github.com/lorenzogirardi/py-test-backend</a></p>\n<p>briefly recap the application answer on /api/ with the main html page with methods</p>\n<table>\n<thead>\n<tr>\n<th>HTTP Method</th>\n<th align=\"center\">URI</th>\n<th>Action</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>GET</td>\n<td align=\"center\">http://[hostname]/api/get/context</td>\n<td>Retrieve list of context</td>\n</tr>\n<tr>\n<td>GET</td>\n<td align=\"center\">http://[hostname]/api/get/context/[context_id]</td>\n<td>Retrieve a context</td>\n</tr>\n<tr>\n<td>POST</td>\n<td align=\"center\">http://[hostname]/api/post/context</td>\n<td>Create a new context</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td align=\"center\">http://[hostname]/api/put/context/[context_id]</td>\n<td>Update an existing context</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td align=\"center\">http://[hostname]/api/delete/context/[context_id]</td>\n<td>Delete acontext</td>\n</tr>\n</tbody>\n</table>\n<p><br><br></p>\n<h2><a id=\"user-content-configuration\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/Kubernetes-apigw#configuration\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Configuration</h2>\n<div>\n<div>git repo --&gt; <a href=\"https://github.com/lorenzogirardi/Kubernetes-apigw\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/lorenzogirardi/Kubernetes-apigw</a></div>\n</div>\n<p>Let's start to work...<br>I've used the public kong deployment with some changes to have the database where store the configurations.</p>\n<p>Another trick is create it as a secondaryÂ <em>ingress</em> , since i've already and ingress in my infrastructure , kong is done to answer on different ports</p>\n<p>All the yaml are subdivided per role</p>\n<pre><code>kong\n|-- 01-kong-ns.yaml\n|-- 02-kong-cr.yaml\n|-- 03-kong-sa.yaml\n|-- 04-kong-rbac.yaml\n|-- 05-kong-crb.yaml\n|-- 06-kong-svc.yaml\n|-- 07-kong-dpl.yaml\n|-- 08-kong-ss.yaml\n`-- 09-kong-job.yaml\n</code></pre>\n<p>some differences are related to the services node ports, deployment binding host and the database is now hosted with a volumeClaimTemplates</p>\n<pre><code>  ports:\n  - name: proxy\n    nodePort: 30080\n    port: 80\n    protocol: TCP\n    targetPort: 8000\n  - name: proxy-ssl\n    nodePort: 30443\n    port: 443\n    protocol: TCP\n    targetPort: 8443\n  - name: admin\n    port: 8100\n    protocol: TCP\n    targetPort: 8100\n  - name: admin-ssl\n    port: 8444\n    protocol: TCP\n    targetPort: 8444\n  selector:\n    app: ingress-kong\n  type: LoadBalancer\n</code></pre>\n<pre><code>      containers:\n      - env:\n        - name: KONG_DATABASE\n          value: postgres\n        - name: KONG_PG_HOST\n          value: postgres\n        - name: KONG_PG_PASSWORD\n          value: kong\n        - name: KONG_PROXY_LISTEN\n          value: 0.0.0.0:8000, 0.0.0.0:8443 ssl http2\n        - name: KONG_PORT_MAPS\n          value: 80:8000, 443:8443\n        - name: KONG_ADMIN_LISTEN\n          value: 0.0.0.0:8444 ssl\n        - name: KONG_STATUS_LISTEN\n          value: 0.0.0.0:8100\n</code></pre>\n<pre><code>  volumeClaimTemplates:\n  - metadata:\n      name: datadir\n    spec:\n      accessModes:\n      - ReadWriteOnce\n      resources:\n        requests:\n          storage: 250Mi\n</code></pre>\n<p>Here what is expected to see</p>\n<pre><code>$ kubectl get svc -n kong\nNAME                      TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)                                                    AGE\nkong-proxy                LoadBalancer   10.152.183.55    &lt;pending&gt;     80:30080/TCP,443:30443/TCP,8100:32588/TCP,8444:31793/TCP   7d\nkong-validation-webhook   ClusterIP      10.152.183.190   &lt;none&gt;        443/TCP                                                    7d\npostgres                  ClusterIP      10.152.183.177   &lt;none&gt;        5432/TCP\n</code></pre>\n<p>and the pods needed to have it online</p>\n<pre><code>kong           ingress-kong-686b4bc5df-nm7zk              2/2     Running     4          7d\nkong           kong-migrations-ftgdv                      0/1     Completed   0          7d\nkong           postgres-0                                 1/1     Running     2          7d\nkube-system    hostpath-provisioner-5c65fbdb4f-f5qsb      1/1     Running     6          40d\n</code></pre>\n<pre><code>NAME                 STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS        AGE\ndatadir-postgres-0   Bound    pvc-8c5791c3-939f-4457-b5fb-74ac417ca3d7   250Mi        RWO                 k8s-hostpath   7d\n</code></pre>\n<p><br><br></p>\n<p>Now i'd like to have also an Admin UI, i'm not fan of web ui ,<br>however i need to know if this interface could be shared outside IT<br>to delegate some business ownership and so on.</p>\n<p>Kong Enterprise has it's own web ui instead the community one needs a third party tool...Â <a href=\"https://github.com/pantsel/konga\">Konga</a></p>\n<p>In the same way of kong, konga needs a database , and in the same way i elaborated a bit the default deployment</p>\n<pre><code>konga\n|-- 01-ns-konga.yaml\n|-- 02-svc-konga.yaml\n|-- 03-ing-konga.yaml\n`-- 04-dpl-konga.yaml\n</code></pre>\n<p>just a couple of TIPS</p>\n<p>postgres persistent storage</p>\n<pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  namespace: konga\n  name: konga-pv-claim\n  labels:\n    app: konga-storage-claim\nspec:\n  storageClassName: microk8s-hostpath\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 200Mi\n</code></pre>\n<p>and on deployment ...</p>\n<pre><code>        env:\n        - name: NODE_TLS_REJECT_UNAUTHORIZED\n          value: \"0\"\n        - name: NODE_ENV\n          value: \"production\"\n</code></pre>\n<p>where NODE_TLS_REJECT_UNAUTHORIZED is the option to not verify the kong api certificate and</p>\n<p><br>NODE_ENV is way to enable production or development , if you are not using production, the other two option enables the debug model and increase the cpu usage, i suggest to use production anywayÂ <strong>during the first deploy you should enable development in order to bootstrap the sql schema</strong>Â that production is not able to do ... or create an init container to deploy the schema</p>\n<p><code>konga konga-stable-8957b9d85-tq72z 2/2 Running 2 6d3h</code></p>\n<p>since is now up and running it will be available on the standard infrastructure ingress</p>\n<pre><code>  - host: konga.ing.h4x0r3d.lan\n</code></pre>\n<p>Konga HomeÂ </p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/0f76d690a796607e512cffaaf5f1405516e613575ecdf562d91399e1c646b05b/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313032342f76313630343737373233372f6d6973632f6b6f6e67615f75692e706e67\"><img loading=\"lazy\" title=\"konga_home\" src=\"https://camo.githubusercontent.com/0f76d690a796607e512cffaaf5f1405516e613575ecdf562d91399e1c646b05b/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313032342f76313630343737373233372f6d6973632f6b6f6e67615f75692e706e67\" data-is-external-image=\"true\"  alt=\"konga_home\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_1024/v1604777237/misc/konga_ui.png\"></a></p>\n<p>Konga node configurationÂ </p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/cda833f675290b3538fa9b4e4d49f8c91ea586bae71505e705d7646646b30fa8/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313032342f76313630343737373233382f6d6973632f6b6f6e67615f75695f6b6f6e676e6f64652e706e67\"><img loading=\"lazy\" title=\"konga_node\" src=\"https://camo.githubusercontent.com/cda833f675290b3538fa9b4e4d49f8c91ea586bae71505e705d7646646b30fa8/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313032342f76313630343737373233382f6d6973632f6b6f6e67615f75695f6b6f6e676e6f64652e706e67\" data-is-external-image=\"true\"  alt=\"konga_node\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_1024/v1604777238/misc/konga_ui_kongnode.png\"></a></p>\n<p><br><br></p>\n<ul>\n<li>kong [INSTALLED]</li>\n<li>konga [INSTALLED]</li>\n<li>backend [INSTALLED]</li>\n</ul>\n<p>First of all we need to expose the backend with Kong in this example i created an ingress configuration dedicated for this porpose</p>\n<pre><code>apiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\n  annotations:\n    kubernetes.io/ingress.class: \"kong\"\n  name: api\n  namespace: pytbak\n  labels:\n    app: api\nspec:\n  rules:\n    - host: api.ing.h4x0r3d.lan\n      http:\n        paths:\n          - path: /api/\n            backend:\n              serviceName: pytbak-svc\n              servicePort: 5000\n          - path: /api/get/\n            backend:\n              serviceName: pytbak-svc\n              servicePort: 5000\n          - path: /api/post/\n            backend:\n              serviceName: pytbak-svc\n              servicePort: 5000\n          - path: /api/put/\n            backend:\n              serviceName: pytbak-svc\n              servicePort: 5000\n          - path: /api/delete/\n            backend:\n              serviceName: pytbak-svc\n              servicePort: 5000\n</code></pre>\n<p><code>kubernetes.io/ingress.class: \"kong\"Â </code>to match the kong ingress on the backend applicationÂ <code>namespace: pytbak</code>.<br>As you can see i created mutiple paths to simulate different applications behind and create different ruls per path/application/context.</p>\n<p>The kong configuration could be applied with</p>\n<ul>\n<li>kubernetes yaml</li>\n<li>kong api</li>\n<li>konga ui (only if you have the database)</li>\n</ul>\n<p>In the repo you will see some in kubernetes and some other not present , i tested the three option and theÂ <strong>kong api</strong>Â is the best one</p>\n<p><br><br>Create api user</p>\n<p><code>curl -k -i -X POST --url https://192.168.1.14:31793/consumers/ --data \"username=slow_user\"</code></p>\n<pre><code>HTTP/1.1 201 Created\nDate: Sat, 07 Nov 2020 19:46:05 GMT\nContent-Type: application/json; charset=utf-8\nConnection: keep-alive\nAccess-Control-Allow-Origin: *\nServer: kong/2.1.4\nContent-Length: 121\nX-Kong-Admin-Latency: 16\n</code></pre>\n<p><code>{\"custom_id\":null,\"created_at\":1604778365,\"id\":\"3d45a73d-4024-4813-b356-43a14ecea702\",\"tags\":null,\"username\":\"slow_user\"}</code>Â <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/34bd577bcb080782018378247fac228663f6c4508bfc1191f173a07d9f731e28/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313032342f76313630343737383930332f6d6973632f6b6f6e67615f636f6e73756d65722e706e67\"><img loading=\"lazy\" title=\"konga_consumer\" src=\"https://camo.githubusercontent.com/34bd577bcb080782018378247fac228663f6c4508bfc1191f173a07d9f731e28/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313032342f76313630343737383930332f6d6973632f6b6f6e67615f636f6e73756d65722e706e67\" data-is-external-image=\"true\"  alt=\"konga_consumer\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_1024/v1604778903/misc/konga_consumer.png\"></a></p>\n<p><br><br>add a key token with key-auth plugin</p>\n<p><code>curl -k -i -X POST --url https://192.168.1.14:31793/consumers/slow_user/key-auth/ --data 'key=332d05445a560ee65a76aeaa372d8904'</code></p>\n<pre><code>HTTP/1.1 201 Created\nDate: Sat, 07 Nov 2020 19:51:03 GMT\nContent-Type: application/json; charset=utf-8\nConnection: keep-alive\nAccess-Control-Allow-Origin: *\nServer: kong/2.1.4\nContent-Length: 190\nX-Kong-Admin-Latency: 10\n</code></pre>\n<p><code>{\"created_at\":1604778663,\"id\":\"52970ca8-848d-49b5-a16f-a235fe0e9ceb\",\"tags\":null,\"ttl\":null,\"key\":\"332d05445a560ee65a76aeaa372d8904\",\"consumer\":{\"id\":\"3d45a73d-4024-4813-b356-43a14ecea702\"}}</code>Â <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/2a45dbea6ede1ac159c1950a65f518aa347650b73efa3539a0edc11f8dbee793/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313032342f76313630343737383930332f6d6973632f6b6f6e67615f636f6e73756d65725f63726564656e7469616c2e706e67\"><img loading=\"lazy\" title=\"konga_consumer_cred\" src=\"https://camo.githubusercontent.com/2a45dbea6ede1ac159c1950a65f518aa347650b73efa3539a0edc11f8dbee793/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313032342f76313630343737383930332f6d6973632f6b6f6e67615f636f6e73756d65725f63726564656e7469616c2e706e67\" data-is-external-image=\"true\"  alt=\"konga_consumer_cred\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_1024/v1604778903/misc/konga_consumer_credential.png\"></a></p>\n<p><br><br></p>\n<p>routes.id where created when we created the kong ingress configuration for pytbakÂ <code>curl -k -i -X GET <a href=\"https://192.168.1.14:31793/routes/\">https://192.168.1.14:31793/routes/</a></code></p>\n<p>Â </p>\n<table style=\"border-collapse: collapse; width: 93.4879%; height: 294px;\" border=\"1\">\n<tbody>\n<tr style=\"height: 49px;\">\n<td style=\"width: 19.2341%; height: 49px;\">ROUTE NAME</td>\n<td style=\"width: 19.7563%; height: 49px;\">PATHÂ </td>\n<td style=\"width: 55.5885%; height: 49px;\">ROUTE.ID</td>\n</tr>\n<tr style=\"height: 49px;\">\n<td style=\"width: 19.2341%; height: 49px;\">pytbak.api.00</td>\n<td style=\"width: 19.7563%; height: 49px;\">/api/</td>\n<td style=\"width: 55.5885%; height: 49px;\">0a78b572-cfe0-4228-bdfe-639ef04b5117</td>\n</tr>\n<tr style=\"height: 49px;\">\n<td style=\"width: 19.2341%; height: 49px;\">pytbak.api.01</td>\n<td style=\"width: 19.7563%; height: 49px;\">/api/get/</td>\n<td style=\"width: 55.5885%; height: 49px;\">8d2a24aa-636d-43ee-b0aa-b0fd1d3643fd</td>\n</tr>\n<tr style=\"height: 49px;\">\n<td style=\"width: 19.2341%; height: 49px;\">pytbak.api.02</td>\n<td style=\"width: 19.7563%; height: 49px;\">/api/post/</td>\n<td style=\"width: 55.5885%; height: 49px;\">f75ed3b6-07c3-4293-932b-4f53d0c38f74</td>\n</tr>\n<tr style=\"height: 49px;\">\n<td style=\"width: 19.2341%; height: 49px;\">pytbak.api.03</td>\n<td style=\"width: 19.7563%; height: 49px;\">/api/put Â </td>\n<td style=\"width: 55.5885%; height: 49px;\">f4823063-04e4-4da8-9c11-21977a93b1ba</td>\n</tr>\n<tr style=\"height: 49px;\">\n<td style=\"width: 19.2341%; height: 49px;\">pytbak.api.04</td>\n<td style=\"width: 19.7563%; height: 49px;\">/api/delete</td>\n<td style=\"width: 55.5885%; height: 49px;\">e396750c-9158-4a96-8d79-047197669cff</td>\n</tr>\n</tbody>\n</table>\n<p>Â </p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/c17c8b10cdcbb8526fdb448c903c6dad6090e4e460de537185e6a04be663c3e4/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313032342f76313630343737393732302f6d6973632f6b6f6e67615f726f757465732e706e67\"><img loading=\"lazy\" title=\"konga_routes\" src=\"https://camo.githubusercontent.com/c17c8b10cdcbb8526fdb448c903c6dad6090e4e460de537185e6a04be663c3e4/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313032342f76313630343737393732302f6d6973632f6b6f6e67615f726f757465732e706e67\" data-is-external-image=\"true\"  alt=\"konga_routes\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_1024/v1604779720/misc/konga_routes.png\"></a></p>\n<p><br><br>now i'd like to limit the user slow_user to perform only 4 request per sec on /api/<br>and 2 on /api/get/</p>\n<pre><code>$ curl -k -X POST https://192.168.1.14:31793/plugins/ \\\n&gt;             --data \"name=rate-limiting\"  \\\n&gt;             --data \"config.second=4\" \\\n&gt;             --data \"config.hour=1200\" \\\n&gt;             --data \"config.policy=local\" \\\n&gt;             --data \"consumer.id=3d45a73d-4024-4813-b356-43a14ecea702\" \\\n&gt;             --data \"route.id=0a78b572-cfe0-4228-bdfe-639ef04b5117\"\n</code></pre>\n<p><code>{\"created_at\":1604780031,\"id\":\"cfd3d752-7864-493c-a3b7-3970ab6eca86\",\"tags\":null,\"enabled\":true,\"protocols\":[\"grpc\",\"grpcs\",\"http\",\"https\"],\"name\":\"rate-limiting\",\"consumer\":{\"id\":\"3d45a73d-4024-4813-b356-43a14ecea702\"},\"service\":null,\"route\":{\"id\":\"0a78b572-cfe0-4228-bdfe-639ef04b5117\"},\"config\":{\"hide_client_headers\":false,\"minute\":null,\"policy\":\"local\",</code><code>\"month\":null,\"redis_timeout\":2000,\"limit_by\":\"consumer\",\"redis_password\":null,\"second\":4,\"day\":null,\"redis_database\":0,\"year\":null,\"hour\":1200,\"redis_host\":null,\"redis_port\":6379,\"header_name\":null,\"fault_tolerant\":true}}</code></p>\n<pre><code>curl -k -X POST https://192.168.1.14:31793/plugins/ \\\n                --data \"name=rate-limiting\"  \\\n                --data \"config.second=2\" \\\n                --data \"config.hour=600\" \\\n                --data \"config.policy=local\" \\\n                --data \"consumer.id=3d45a73d-4024-4813-b356-43a14ecea702\" \\\n                --data \"route.id=8d2a24aa-636d-43ee-b0aa-b0fd1d3643fd\" \n</code></pre>\n<p><code>{\"created_at\":1604780101,\"id\":\"33bfc138-776a-4116-a2a9-8c70ab9d7a2a\",\"tags\":null,\"enabled\":true,\"protocols\":[\"grpc\",\"grpcs\",\"http\",\"https\"],\"name\":\"rate-limiting\",\"consumer\":{\"id\":\"3d45a73d-4024-4813-b356-43a14ecea702\"},\"service\":null,\"route\":{\"id\":\"8d2a24aa-636d-43ee-b0aa-b0fd1d3643fd\"},\"config\":{\"hide_client_headers\":false,\"minute\":null,\"policy\":\"local\",\"month\":null,\"redis_timeout\":2000,\"limit_by\":\"consumer\",\"redis_password\":null,\"second\":2,\"day\":null,\"redis_database\":0,\"year\":null,\"hour\":600,\"redis_host\":null,\"redis_port\":6379,\"header_name\":null,\"fault_tolerant\":true}}</code></p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/31f166746c62aae6fda1d4e1bdb7a85ec1683afd6bdf2d859baf6150883e302e/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313032342f76313630343738303230302f6d6973632f6b6f6e67615f726174655f6c696d69745f726f757465732e706e67\"><img loading=\"lazy\" title=\"konga_rate_routes\" src=\"https://camo.githubusercontent.com/31f166746c62aae6fda1d4e1bdb7a85ec1683afd6bdf2d859baf6150883e302e/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313032342f76313630343738303230302f6d6973632f6b6f6e67615f726174655f6c696d69745f726f757465732e706e67\" data-is-external-image=\"true\"  alt=\"konga_rate_routes\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_1024/v1604780200/misc/konga_rate_limit_routes.png\"></a></p>\n<p><br><br></p>\n<h2><a id=\"user-content-use-cases\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/Kubernetes-apigw#use-cases\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Use cases</h2>\n<p>I created 3 users , one on the example above and a new one with a double of requests per second</p>\n<table>\n<thead>\n<tr>\n<th>route</th>\n<th align=\"center\">slow_user rate/s</th>\n<th>fast_user rate/s</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>/api/</td>\n<td align=\"center\">4</td>\n<td>8</td>\n</tr>\n<tr>\n<td>/api/get/</td>\n<td align=\"center\">2</td>\n<td>4</td>\n</tr>\n<tr>\n<td>/api/post/</td>\n<td align=\"center\">1</td>\n<td>2</td>\n</tr>\n<tr>\n<td>/api/put/</td>\n<td align=\"center\">1</td>\n<td>2</td>\n</tr>\n<tr>\n<td>/api/delete/</td>\n<td align=\"center\">1</td>\n<td>2</td>\n</tr>\n</tbody>\n</table>\n<p><br><br>slow_user has apikey: 332d05445a560ee65a76aeaa372d8904<br>fast_user has apikey: 695aa0b18c6dbd1b387ee7c32c72c513<br>admin has a apikey: admin</p>\n<p><br><br>i've also created a global rules on the service with max 9 reqquest per second for all other users with no specific rate limit rule applied (ex admin.)</p>\n<p><code>$ curl -k -X POST https://192.168.1.14:31793/plugins --data \"name=rate-limiting\" --data \"config.second=9\" --data \"config.policy=local\" --data \"service.id=53d35e73-b285-4eb2-ad24-853d82563ca4\"</code></p>\n<pre><code>{\"created_at\":1604786501,\"id\":\"34182311-ecbf-49a3-bdcf-bdc1c9c58706\",<br>\"tags\":null,\"enabled\":true,\"protocols\":[\"grpc\",\"grpcs\",\"http\",\"https\"],<br>\"name\":\"rate-limiting\",\"consumer\":null,<br>\"service\":{\"id\":\"53d35e73-b285-4eb2-ad24-853d82563ca4\"},<br>\"route\":null,\"config\":{\"hide_client_headers\":false,\"minute\":null,\"policy\":\"local\",<br>\"month\":null,\"redis_timeout\":2000,\"limit_by\":\"consumer\",<br>\"redis_password\":null,\"second\":9,\"day\":null,\"redis_database\":0,\"year\":null,<br>\"hour\":null,\"redis_host\":null,\"redis_port\":6379,\"header_name\":null,<br>\"fault_tolerant\":true}}\n</code></pre>\n<p>Using siege i've benchmarked the users</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ee42763f67ce2c6a3e6f97b945740f70bf12d80bc251a6fd1266b07cf10d68f9/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313630343738373237302f6d6973632f73696567655f75736572732e706e67\"><img loading=\"lazy\" title=\"siege_users\" src=\"https://camo.githubusercontent.com/ee42763f67ce2c6a3e6f97b945740f70bf12d80bc251a6fd1266b07cf10d68f9/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313630343738373237302f6d6973632f73696567655f75736572732e706e67\" data-is-external-image=\"true\"  alt=\"siege_users\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/v1604787270/misc/siege_users.png\"></a></p>\n<p>You can check the headers with curl<br><code>$ while true; do curl -I -H \"apikey:332d05445a560ee65a76aeaa372d8904\" http://api.ing.h4x0r3d.lan:30080/api/ &amp;&amp; sleep 0.2; done</code></p>\n<pre><code>HTTP/1.1 200 OK\nContent-Type: text/html; charset=utf-8\nContent-Length: 658\nConnection: keep-alive\nServer: Werkzeug/1.0.1 Python/3.9.0\nDate: Sat, 07 Nov 2020 22:21:34 GMT\nX-RateLimit-Limit-Second: 4\nX-RateLimit-Remaining-Second: 3\nX-RateLimit-Limit-Hour: 1000000\nRateLimit-Limit: 4\nX-RateLimit-Remaining-Hour: 999755\nRateLimit-Remaining: 3\nRateLimit-Reset: 1\nX-Kong-Upstream-Latency: 3\nX-Kong-Proxy-Latency: 1\nVia: kong/2.1.4\n\nHTTP/1.1 200 OK\nContent-Type: text/html; charset=utf-8\nContent-Length: 658\nConnection: keep-alive\nServer: Werkzeug/1.0.1 Python/3.9.0\nDate: Sat, 07 Nov 2020 22:21:34 GMT\nX-RateLimit-Limit-Second: 4\nX-RateLimit-Remaining-Second: 2\nX-RateLimit-Limit-Hour: 1000000\nRateLimit-Limit: 4\nX-RateLimit-Remaining-Hour: 999754\nRateLimit-Remaining: 2\nRateLimit-Reset: 1\nX-Kong-Upstream-Latency: 3\nX-Kong-Proxy-Latency: 0\nVia: kong/2.1.4\n\nHTTP/1.1 200 OK\nContent-Type: text/html; charset=utf-8\nContent-Length: 658\nConnection: keep-alive\nServer: Werkzeug/1.0.1 Python/3.9.0\nDate: Sat, 07 Nov 2020 22:21:34 GMT\nX-RateLimit-Limit-Second: 4\nX-RateLimit-Remaining-Second: 1\nX-RateLimit-Limit-Hour: 1000000\nRateLimit-Limit: 4\nX-RateLimit-Remaining-Hour: 999753\nRateLimit-Remaining: 1\nRateLimit-Reset: 1\nX-Kong-Upstream-Latency: 3\nX-Kong-Proxy-Latency: 1\nVia: kong/2.1.4\n\nHTTP/1.1 200 OK\nContent-Type: text/html; charset=utf-8\nContent-Length: 658\nConnection: keep-alive\nServer: Werkzeug/1.0.1 Python/3.9.0\nDate: Sat, 07 Nov 2020 22:21:34 GMT\nX-RateLimit-Limit-Second: 4\nX-RateLimit-Remaining-Second: 0\nX-RateLimit-Limit-Hour: 1000000\nRateLimit-Limit: 4\nX-RateLimit-Remaining-Hour: 999752\nRateLimit-Remaining: 0\nRateLimit-Reset: 1\nX-Kong-Upstream-Latency: 3\nX-Kong-Proxy-Latency: 1\nVia: kong/2.1.4\n\nHTTP/1.1 429 Too Many Requests\nDate: Sat, 07 Nov 2020 22:21:34 GMT\nContent-Type: application/json; charset=utf-8\nConnection: keep-alive\nRetry-After: 1\nContent-Length: 41\nX-RateLimit-Limit-Second: 4\nX-RateLimit-Remaining-Second: 0\nX-RateLimit-Limit-Hour: 1000000\nRateLimit-Limit: 4\nX-RateLimit-Remaining-Hour: 999752\nRateLimit-Remaining: 0\nRateLimit-Reset: 1\nX-Kong-Response-Latency: 1\nServer: kong/2.1.4\n</code></pre>\n<p><br><br></p>\n<h3><a id=\"user-content-rules-precedence\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/Kubernetes-apigw#rules-precedence\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Rules Precedence</h3>\n<p>A plugin will always be run once and only once per request. But the configuration with which it will run depends on the entities it has been configured for.</p>\n<p>Plugins can be configured for various entities, combination of entities, or even globally. This is useful, for example, when you wish to configure a plugin a certain way for most requests, but make authenticated requests behave slightly differently.</p>\n<p>Therefore, there exists an order of precedence for running a plugin when it has been applied to different entities with different configurations. The rule of thumb is: the more specific a plugin is with regards to how many entities it has been configured on, the higher its priority.</p>\n<p>The complete order of precedence when a plugin has been configured multiple times is:</p>\n<ol>\n<li>Plugins configured on a combination of: a Route, a Service, and a Consumer. (Consumer means the request must be authenticated).</li>\n<li>Plugins configured on a combination of a Route and a Consumer. (Consumer means the request must be authenticated).</li>\n<li>Plugins configured on a combination of a Service and a Consumer. (Consumer means the request must be authenticated).</li>\n<li>Plugins configured on a combination of a Route and a Service.</li>\n<li>Plugins configured on a Consumer. (Consumer means the request must be authenticated).</li>\n<li>Plugins configured on a Route.</li>\n<li>Plugins configured on a Service.</li>\n<li>Plugins configured to run globally.</li>\n</ol>\n<p>Example: if the rate-limiting plugin is applied twice (with different configurations): for a Service (Plugin config A), and for a Consumer (Plugin config B), then requests authenticating this Consumer will run Plugin config B and ignore A. However, requests that do not authenticate this Consumer will fallback to running Plugin config A. Note that if config B is disabled (its enabled flag is set to false), config A will apply to requests that would have otherwise matched config B.</p>\n<p><br><br></p>\n<h3><a id=\"user-content-waf\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/Kubernetes-apigw#waf\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>WAF</h3>\n<p>Last but not lease , the api is configured behind Cloudflare,</p>\n<p>the usersÂ <code>slow_user fast_user</code>Â are available in case you want to test directly the service.</p>\n<p>Endpoint:Â <code>https://services.k8s.it/api/</code></p>\n<p><br><br></p>\n<p><code>$ curl -I -H \"apikey:332d05445a560ee65a76aeaa372d8904\" https://services.k8s.it/api/</code></p>\n<pre><code>HTTP/2 200\ndate: Sun, 08 Nov 2020 10:14:21 GMT\ncontent-type: text/html; charset=utf-8\nset-cookie: __cfduid=dab5b88be5427314b7b17a1a65d3178a41604830461; <br>expires=Tue, 08-Dec-20 10:14:21 GMT; path=/; domain=.k8s.it; HttpOnly; <br>SameSite=Lax\nvary: Accept-Encoding\nx-ratelimit-limit-second: 4\nx-ratelimit-remaining-second: 3\nx-ratelimit-limit-hour: 1000000\nratelimit-limit: 4\nx-ratelimit-remaining-hour: 999995\nratelimit-remaining: 3\nratelimit-reset: 1\nx-kong-upstream-latency: 3\nx-kong-proxy-latency: 4\nvia: kong/2.1.4\ncf-cache-status: DYNAMIC\ncf-request-id: 0648f2980000000f72931c2000000001\nexpect-ct: max-age=604800, <br>report-uri=\"https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct\"\nreport-to: {\"endpoints\":[{\"url\":\"https:\\/\\/a.nel.cloudflare.com\\/report?s=z4j%2FU3og%2FT2jBByhUKZtShDNLfLMWncExIy3EowJ2hOPJ17oCB0oeyY1GVaXirT%2BgWpTEEu<br>U%2F03gx%2F91uOy3mGD%2BFE4FhBGqFt7iC2bhaPc%3D\"}],\"group\":\"cf-nel\",\"max_age\":604800}\nnel: {\"report_to\":\"cf-nel\",\"max_age\":604800}\nserver: cloudflare\ncf-ray: 5eee86d319770f72-MXP\n</code></pre>\n<p><br><br></p>\n<h2><a id=\"user-content-conclusion\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/Kubernetes-apigw#conclusion\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Conclusion</h2>\n<p>Kong is a scalable, open source API Gateway.<br>Kong runs in front of any RESTful API and is extended through Plugins, which provide extra functionality and services beyond the core platform.</p>\n<p>The architecture is quite simple to understand and is made up of a few componentsâ€¦</p>\n<ul>\n<li>Kong base-module which wraps OpenResty and Nginx and is the engine which does the actual work</li>\n<li>Database layer with choice of Cassandra or Postgres to store all the configuration so it can be retrieved easily in case of failures</li>\n<li>Dashboard which provides User-Interface for API administration and viewing analytics (embedded in th Enerprise, third party for the communityÂ <em>Konga</em>)</li>\n</ul>\n<p>The Powerful of Kong is also supported by plugins from authentication, security, traffic control, logging, and etcâ€¦<br><br></p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/d2a4de6795889077f983473c7575a12036254ec671f5440c6e63b68889926d65/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f3438302f76313630373333323133302f6d6973632f554d4c5f6170695f67772e706e67\"><img loading=\"lazy\" title=\"uml_api_gw\" src=\"https://camo.githubusercontent.com/d2a4de6795889077f983473c7575a12036254ec671f5440c6e63b68889926d65/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f3438302f76313630373333323133302f6d6973632f554d4c5f6170695f67772e706e67\" data-is-external-image=\"true\"  alt=\"uml_api_gw\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_480/v1607332130/misc/UML_api_gw.png\"></a></p>\n<p>Â </p>\n<p>Â </p>\n<p>Monitoring is also covered well by default kong official prometheus available hereÂ <a href=\"https://github.com/Kong/kong-plugin-prometheus\">https://github.com/Kong/kong-plugin-prometheus</a></p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/28dedd2eae334443bd6e668838f06caedc99f3c5cbd95e5b8d12869015cad8e9/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313630353732333433362f6d6973632f6b6f6e665f6d6f6e69746f722e706e67\"><img loading=\"lazy\" title=\"kong_monitor\" src=\"https://camo.githubusercontent.com/28dedd2eae334443bd6e668838f06caedc99f3c5cbd95e5b8d12869015cad8e9/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313630353732333433362f6d6973632f6b6f6e665f6d6f6e69746f722e706e67\" data-is-external-image=\"true\"  alt=\"kong_monitor\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/v1605723436/misc/konf_monitor.png\"></a></p>\n<p>Live:Â <a href=\"https://services.k8s.it/grafana/d/mY9p7dQmz/kong?orgId=2&amp;refresh=1m\" rel=\"nofollow\">https://services.k8s.it/grafana/d/mY9p7dQmz/kong?orgId=2&amp;refresh=1m</a></p>\n<p>Â </p>\n<p><strong>If your business exposes APIs, the API GATEWAY is a requirement to handle the third party.</strong></p>",
            "image": "https://www.k8s.it/media/posts/16/Screenshot-2020-11-20-at-22.20.25-2.png",
            "author": {
                "name": "lgirardi"
            },
            "tags": [
                   "token",
                   "rate limit",
                   "kubernetes",
                   "konga",
                   "kong",
                   "auth",
                   "apigw",
                   "api-gateway",
                   "api key"
            ],
            "date_published": "2020-11-08T13:57:27+01:00",
            "date_modified": "2020-12-28T10:02:36+01:00"
        },
        {
            "id": "https://www.k8s.it/python-rest-api-test-application.html",
            "url": "https://www.k8s.it/python-rest-api-test-application.html",
            "title": "Python rest api test application",
            "summary": "Working most of the times (always) in Platform i'm usually play with the infrastructure, however sometimes to create prototype i need backends that are done for the specific purpose. GOALS:The application must be a REST apiRun in kubernetes Docker and kubernetesThe application is working with&hellip;",
            "content_html": "<p>Working most of the times (always) in Platform i'm usually play with the infrastructure, however sometimes to create prototype i need backends that are done for the specific purpose.</p>\n<h2><a id=\"user-content-goals\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/py-test-backend#goals\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>GOALS:</h2>\n<ul>\n<li>The application must be a REST api</li>\n<li>Run in kubernetes<br><br><br><br></li>\n</ul>\n<h3><a id=\"user-content-docker-and-kubernetes\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/py-test-backend#docker-and-kubernetes\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Docker and kubernetes</h3>\n<p>The application is working with GET, POST, PUT, DELETE<br>enouth to cover most of the usages based on rest api.</p>\n<p>Inside the docker path you can run easly as local docker</p>\n<p><code>docker build --tag pytbak:0.1 .</code><br><code>docker run -t -p 5000:5000 pytbak:0.1</code><br>and access on it withÂ <code>locahost:5000/api/</code></p>\n<p>instead if you want to run it in kubernetes ,<br>starting from the main folder you can apply the kubernetes folder on your environment<br><code>kubectl apply -f kubernetes/</code></p>\n<pre><code>$ kubectl  get pods -n pytbak\nNAME                             READY   STATUS    RESTARTS   AGE\npytbak-stable-5dfb4fbfd4-n64kx   1/1     Running   0          40m\n</code></pre>\n<p>Remember to change the host in the ingress file configuration</p>\n<pre><code>$ cat 03-ing-pytbak.yaml\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: pytbak-ingress\n  namespace: pytbak\n  annotations:\n    ingress.kubernetes.io/proxy-connect-timeout: \"10\"\n    ingress.kubernetes.io/proxy-read-timeout: \"30\"\n    ingress.kubernetes.io/proxy-send-timeout: \"30\"\nspec:\n  rules:\n  - host: pytbak.ing.h4x0r3d.lan\n    http:\n      paths:\n      - path: /\n        backend:\n          serviceName: pytbak-svc\n          servicePort: 5000\n</code></pre>\n<p><em>host: pytbak.ing.h4x0r3d.lan</em>Â this is my ingress dns resolution</p>\n<p>TIPS: for ingress endpoints you can manage multiple namespace creating an A record in your DNS (as a subdomain) with a wildcard dedicated only for ingress matching the namespace and the host created</p>\n<p>in my case i have the home dns asÂ <code>h4x0r3d.lan</code><br>andÂ <code>*.ing.h4x0r3d.lan</code>Â as a record A of my kubernetes ingress<br>in this way if i create a namespaceÂ <em>pippo</em>Â the dns that i have to call to reach it out will beÂ <em>pippo.ing.4x0r3d.lan</em>Â with no change on DNS.<br><br><br><br></p>\n<h3><a id=\"user-content-usage\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/py-test-backend#usage\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Usage</h3>\n<p>The application answer on /api/ with the main html page with methods</p>\n<table>\n<thead>\n<tr>\n<th>HTTP Method</th>\n<th align=\"center\">URI</th>\n<th>Action</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>GET</td>\n<td align=\"center\">http://[hostname]/api/get/context</td>\n<td>Retrieve list of context</td>\n</tr>\n<tr>\n<td>GET</td>\n<td align=\"center\">http://[hostname]/api/get/context/[context_id]</td>\n<td>Retrieve a context</td>\n</tr>\n<tr>\n<td>POST</td>\n<td align=\"center\">http://[hostname]/api/post/context</td>\n<td>Create a new context</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td align=\"center\">http://[hostname]/api/put/context/[context_id]</td>\n<td>Update an existing context</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td align=\"center\">http://[hostname]/api/delete/context/[context_id]</td>\n<td>Delete acontext</td>\n</tr>\n</tbody>\n</table>\n<p>Following the methods example</p>\n<pre><code>$ curl -i http://pytbak.ing.h4x0r3d.lan/api/get/context\nHTTP/1.1 200 OK\nServer: openresty/1.15.8.1\nDate: Wed, 28 Oct 2020 20:02:02 GMT\nContent-Type: application/json\nContent-Length: 696\nConnection: keep-alive\nVary: Accept-Encoding\n\n{\n  \"context\": [\n    {\n      \"description\": \"RHEL 6 based\",\n      \"done\": false,\n      \"title\": \"Cento 6\",\n      \"uri\": \"http://pytbak.ing.h4x0r3d.lan/api/get/context/1\"\n    },\n    {\n      \"description\": \"RHEL 7 based\",\n      \"done\": false,\n      \"title\": \"Centos 7\",\n      \"uri\": \"http://pytbak.ing.h4x0r3d.lan/api/get/context/2\"\n    },\n    {\n      \"description\": \"RHEL 8 based\",\n      \"done\": false,\n      \"title\": \"Centos 8\",\n      \"uri\": \"http://pytbak.ing.h4x0r3d.lan/api/get/context/3\"\n    },\n    {\n      \"description\": \"Fedora + RHEL based\",\n      \"done\": false,\n      \"title\": \"Centos stream\",\n      \"uri\": \"http://pytbak.ing.h4x0r3d.lan/api/get/context/4\"\n    }\n  ]\n</code></pre>\n<p><br><br></p>\n<pre><code>$ curl -i -H \"Content-Type: application/json\" -X POST -d '{\"title\":\"Ubuntu 20.04 LTS\", \"description\":\"focal\"}' http://pytbak.ing.h4x0r3d.lan/api/post/context\nHTTP/1.1 201 CREATED\nServer: openresty/1.15.8.1\nDate: Wed, 28 Oct 2020 19:49:31 GMT\nContent-Type: application/json\nContent-Length: 165\nConnection: keep-alive\n\n{\n  \"task\": {\n    \"description\": \"focal\",\n    \"done\": false,\n    \"title\": \"Ubuntu 20.04 LTS\",\n    \"uri\": \"http://pytbak.ing.h4x0r3d.lan/api/get/context/5\"\n  }\n}\n</code></pre>\n<p><br><br></p>\n<pre><code>$ curl -i -H \"Content-Type: application/json\" -X PUT -d '{\"description\":\"Focal Fossa\"}' http://pytbak.ing.h4x0r3d.lan/api/put/context/5\nHTTP/1.1 200 OK\nServer: openresty/1.15.8.1\nDate: Wed, 28 Oct 2020 20:02:43 GMT\nContent-Type: application/json\nContent-Length: 171\nConnection: keep-alive\n\n{\n  \"task\": {\n    \"description\": \"Focal Fossa\",\n    \"done\": false,\n    \"title\": \"Ubuntu 20.04 LTS\",\n    \"uri\": \"http://pytbak.ing.h4x0r3d.lan/api/get/context/5\"\n  }\n}\n</code></pre>\n<p><br><br></p>\n<pre><code>$ curl -i -H \"Content-Type: application/json\" -X DELETE http://pytbak.ing.h4x0r3d.lan/api/delete/context/5\nHTTP/1.1 200 OK\nServer: openresty/1.15.8.1\nDate: Wed, 28 Oct 2020 20:04:47 GMT\nContent-Type: application/json\nContent-Length: 21\nConnection: keep-alive\n\n{\n  \"result\": true\n}\n$ curl -i http://pytbak.ing.h4x0r3d.lan/api/get/context/5\nHTTP/1.1 404 NOT FOUND\nServer: openresty/1.15.8.1\nDate: Wed, 28 Oct 2020 20:04:54 GMT\nContent-Type: application/json\nContent-Length: 27\nConnection: keep-alive\n\n{\n  \"error\": \"Not found\"\n}</code><code></code></pre>",
            "image": "https://www.k8s.it/media/posts/15/Screenshot-2020-11-20-at-23.08.36.png",
            "author": {
                "name": "lgirardi"
            },
            "tags": [
                   "test",
                   "restapi",
                   "rest-api",
                   "rest",
                   "python",
                   "kubernetes",
                   "docker",
                   "backend",
                   "api",
                   "PUT",
                   "POST",
                   "GET",
                   "DELETE"
            ],
            "date_published": "2020-10-30T10:39:29+01:00",
            "date_modified": "2020-11-20T23:08:55+01:00"
        },
        {
            "id": "https://www.k8s.it/kubernetes-sitespeedio.html",
            "url": "https://www.k8s.it/kubernetes-sitespeedio.html",
            "title": "Kubernetes sitespeed.io",
            "summary": "Hello First of all, this is a thought around a website metrics management, is not the only way, but is one way for a high level overview. How to read this ... However you can reach the GOAL just using docker and crontab for example&hellip;",
            "content_html": "<p>Hello</p>\n<p>First of all, this is a thought around a website metrics management, is not the only way, but is one way for a high level overview.</p>\n<p>How to read this ...</p>\n<ul>\n<li>i'm focused to share some concept about website monitoring</li>\n<li>i'm sharing a possible way to manage in kubernetes</li>\n<li>i'm using some other tools in kubernetes just because i'm evaluating this for other purpose</li>\n</ul>\n<p>However you can reach the GOAL just using docker and crontab for example<br><br><br><br></p>\n<h2><a id=\"user-content-motivations\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-sitespeed.io#motivations\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Motivations</h2>\n<p>Well ... a website is a product itself,<br>it could be a Wordpress, a Magento ecommerce or a structured multiple applications that owns each ones a different section of the website.</p>\n<p>However if running a business on top, you should move your evolution as a customer perspective:</p>\n<ul>\n<li>how long does is take the website asnwer ?</li>\n<li>is the response time common for all sections ?</li>\n<li>new versions/deployments are better than before for the customer ?</li>\n</ul>\n<p>You know, if the response time is more than X seconds ... and you are selling a common gadgets that could be retrieved elsewhere , you are losing money and customer affiliation.</p>\n<p>There are also some others problems... when someone in your company or a customer will say ... the website il slow</p>\n<ul>\n<li>Faster from my fiber home connection</li>\n<li>Faster from my mobile premium plus SIM</li>\n<li>Slow from wireless</li>\n<li>Fast from wireless</li>\n<li>No idea</li>\n<li>Faster than â€¦ ?!?! compared to ... ?!?!</li>\n</ul>\n<p>No, look how it's slow (2g connection in the sahara desert)<br><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/3251fd1e9ec686be58b3f6c8669b185187843283/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f3238362f76313630313533343536332f6d6973632f53637265656e73686f745f323032302d31302d30315f61745f30382e34302e30362e706e67\"><img loading=\"lazy\" title=\"reaction\" src=\"https://camo.githubusercontent.com/3251fd1e9ec686be58b3f6c8669b185187843283/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f3238362f76313630313533343536332f6d6973632f53637265656e73686f745f323032302d31302d30315f61745f30382e34302e30362e706e67\" data-is-external-image=\"true\"  alt=\"reaction\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_286/v1601534563/misc/Screenshot_2020-10-01_at_08.40.06.png\"></a><br><br><br></p>\n<p>Now, we know what we need ... DATA<br>Evaluate those during a long therm periode looking for performance</p>\n<ul>\n<li>release by release</li>\n<li>feature by feature</li>\n<li>etc etc</li>\n</ul>\n<p>First of all we have to test our websites on the customer position... so no 1gbit inline connection with 0.00001 roundtrip :)</p>\n<p>From the multitude of products , webtest , lighthouse , selenium and so on i really like sitespeed.io<br><br><br></p>\n<h3><a id=\"user-content-goal\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-sitespeed.io#goal\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>GOAL</h3>\n<ul>\n<li>be able to have an objective trend</li>\n<li>check the goodness of releases</li>\n</ul>\n<p><br><br><br><br></p>\n<h2><a id=\"user-content-the-customer-point-of-view\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-sitespeed.io#the-customer-point-of-view\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>The customer point of view</h2>\n<p>You have to know your product and your customer ...</p>\n<p>If you own the product you know that the customer is \"forced\" to buy by you. Immgine to are Apple, you know that customers are affiliated to you... so if something is slow, probably even if the device is available in other websites the customer will wait the answer.</p>\n<p>On the opposite side if you are a retailer , and the product is quite common with no brandlove etc etc ... if the website is slow the user will change immediatly the website to land to somewhere else.<br><br></p>\n<h3><a id=\"user-content-speed\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-sitespeed.io#speed\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Speed</h3>\n<p>we usually define aÂ <em>slowness</em>Â by a perception.</p>\n<p>However , in 2020 you know the Data that comes from GA and understand when people leave a page , after some amount of time.</p>\n<p>Consider those, rate and the timing to tune the threadshold</p>\n<ul>\n<li>Bounce</li>\n<li>Leave/Exit</li>\n</ul>\n<p>andÂ <ins>create the awareness</ins>Â about the limits and improvements you can achieve.</p>\n<p>Example. If a search take more than 10seconds, sayÂ <em>ciao ciao</em>Â to the customer.</p>\n<p>As said, when you mesure the speed you have to move yourself in the customer side ... so not all people has 1gbit connection , maybe the major are using mobile , maybe your host is in US and the customer in KR.<br>So ... internet connection should reflect the avg/wrost scenario Believe me that those dataÂ <a href=\"https://www.speedtest.net/global-index\" rel=\"nofollow\">https://www.speedtest.net/global-index</a>Â are quite optimistic :) i appreciate instead the documentation of sitespeed that has classified 4 networks</p>\n<p><a href=\"https://www.sitespeed.io/documentation/sitespeed.io/connectivity/\" rel=\"nofollow\">https://www.sitespeed.io/documentation/sitespeed.io/connectivity/</a></p>\n<ul>\n<li>3g</li>\n<li>3gfast</li>\n<li>3gslow</li>\n<li>cable</li>\n</ul>\n<p>I'd like to say that in 2020Â <em>cable</em>Â andÂ <em>3gfast</em>Â cover perfectly the wrost scenario</p>\n<p>Even if you don't agree with the speed category, remember to look the graphs and the metrics considering the DELTA<br><br><br><br></p>\n<h2><a id=\"user-content-sitespeedio\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-sitespeed.io#sitespeedio\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Sitespeed.io</h2>\n<p>This tool is open source , has a huge extension , in this scenario<br>i'll use only parts of that since i don't need the video recording, or HAR files and so on.</p>\n<p>A full report could be useful to check all feature and you can find here<br><a href=\"https://lorenzogirardi.github.io/sitespeedio-results/\" rel=\"nofollow\">https://lorenzogirardi.github.io/sitespeedio-results/</a></p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/48cabf3aeb609d823d3b407a2eede60b8039c554/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313630313338373533332f6d6973632f7369746573706565642d726573756c74732e706e67\"><img loading=\"lazy\" title=\"sitespeed-results\" src=\"https://camo.githubusercontent.com/48cabf3aeb609d823d3b407a2eede60b8039c554/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313630313338373533332f6d6973632f7369746573706565642d726573756c74732e706e67\" data-is-external-image=\"true\"  alt=\"sitespeed-results\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/v1601387533/misc/sitespeed-results.png\"></a></p>\n<p>and you can have those results only with using the docker image</p>\n<p><code>docker run --rm -v \"$(pwd):/sitespeed.io\" sitespeedio/sitespeed.io:15.2.0 https://www.k8s.it/</code></p>\n<p>is know easy understand that you can extend in crontab this code and add some other option to store metrics and results files in s3 for example</p>\n<p><code>/usr/bin/docker run --privileged --shm-size=1g --rm --network=cable sitespeedio/sitespeed.io httos://www.example.com -v -b chrome --video --speedIndex -c cable --browsertime.iterations 1 --s3.key S3_KEY --s3.secret S3_SECRET --s3.bucketname S3_BUCKET --s3.removeLocalResult true --s3.path S3_PATH www.ecample.com --graphite.host GRAPHITE_HOST --graphite.port GRAPHITE_PORT --graphite.namespace GRAPHITE_PREFIX</code></p>\n<p><br><br><br><br></p>\n<h3><a id=\"user-content-case-of-study\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-sitespeed.io#case-of-study\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Case of study</h3>\n<p>Since we have identified the tool i have to specify the use case</p>\n<ul>\n<li>I need only metrics in this example because, so i don't need to store the output artifact</li>\n<li>I want to store the metrics in influxdb</li>\n<li>I want to run it not as a docker but inside kubernetes</li>\n<li>TBD i'd like to orchestrate actions</li>\n</ul>\n<p>The sitespeed.io docker fit perfectly in a kubernetes cronjob vision<br><a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/\" rel=\"nofollow\">https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/</a><br>is done to start, execute an action and exit</p>\n<p>However i'd like to explore a workflow manager ... not just for this case but also to exend some otherÂ <em>jobs</em><br><br><br></p>\n<h4><a id=\"user-content-argo\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-sitespeed.io#argo\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Argo</h4>\n<p>I chose this product because i was interested to have something similar to Rundeck , but with more extended capability in order to be possible build a ci/cd without spinnaker<br><a href=\"https://argoproj.github.io/\" rel=\"nofollow\">https://argoproj.github.io/</a></p>\n<p>The installation is quite easy , i've just trick a configmap due to volume mount problem genereted by my small kubernetes installation</p>\n<p>For a basic installation you need to create a dedicated namespace<br><code>kubectl create namespace argo</code></p>\n<p>and than deploy the argo infrastructure (server and workflow)<br><code>kubectl apply -n argo -f https://raw.githubusercontent.com/argoproj/argo/stable/manifests/install.yaml</code></p>\n<pre><code>NAMESPACE      NAME                                       READY   STATUS      RESTARTS   AGE\nargo           argo-server-6c886c5b77-l8jfv               1/1     Running     1          2d13h\nargo           workflow-controller-65948977d-zc9vt        1/1     Running     0          2d14h\n</code></pre>\n<p>As mentioned before i discover aÂ <em>bug</em>Â (just because i use containerd instead docker in microk8s) , running the firt job<br><code>MountVolume.SetUp failed for volume \"docker-lib\" : hostPath type check failed: /var/lib/docker is not a directory</code><br>However adding</p>\n<pre><code>data:\n  config: |\n    containerRuntimeExecutor: pns\n</code></pre>\n<p>inÂ <code>workflow-controller-configmap</code></p>\n<p>i fixed the issue.</p>\n<p><br><br></p>\n<p>Well now Argo is running and you can interact with the web UI or creating a services and a ingress configuration or with the port forwarding.<br>Since i'm now experimenting the solution i'm just using the second option.</p>\n<pre><code>$ kubectl -n argo port-forward deployment/argo-server 2746:2746\nForwarding from 127.0.0.1:2746 -&gt; 2746\nForwarding from [::1]:2746 -&gt; 2746\n</code></pre>\n<p>The UI interface is pretty clean and the authentication model follow the RBAC policy</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/c71a2d41217a3e5ddd0f1f0f5d8be257c5837273/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313535393038372f6d6973632f6172676f5f342e706e67\"><img loading=\"lazy\" title=\"argo_4\" src=\"https://camo.githubusercontent.com/c71a2d41217a3e5ddd0f1f0f5d8be257c5837273/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313535393038372f6d6973632f6172676f5f342e706e67\" data-is-external-image=\"true\"  alt=\"argo_4\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_1080/v1601559087/misc/argo_4.png\"></a></p>\n<p>The editor as well is really good and if i have to think about a solution to share to other teams/depts , this has a good level of abstraction (at least you need to know what is contab)</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/8018d2f4ee3abd5e64fab8b04a8a8942cd5be16f/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313535393038372f6d6973632f6172676f5f312e706e67\"><img loading=\"lazy\" title=\"argo_1\" src=\"https://camo.githubusercontent.com/8018d2f4ee3abd5e64fab8b04a8a8942cd5be16f/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313535393038372f6d6973632f6172676f5f312e706e67\" data-is-external-image=\"true\"  alt=\"argo_1\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_1080/v1601559087/misc/argo_1.png\"></a></p>\n<p>All informations are shared with the most relevant needs<br><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/edbf1e994dd7efc315e1d356c7222b3829b36891/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313535393038382f6d6973632f6172676f5f332e706e67\"><img loading=\"lazy\" title=\"argo_3\" src=\"https://camo.githubusercontent.com/edbf1e994dd7efc315e1d356c7222b3829b36891/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313535393038382f6d6973632f6172676f5f332e706e67\" data-is-external-image=\"true\"  alt=\"argo_3\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_1080/v1601559088/misc/argo_3.png\"></a></p>\n<p>Events could be retrieved and evaluated as well<br><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/a472dbd7228b9b098ad942a92a2f336a228f32d0/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f3432302f76313630313535393038372f6d6973632f6172676f5f362e706e67\"><img loading=\"lazy\" title=\"argo_6\" src=\"https://camo.githubusercontent.com/a472dbd7228b9b098ad942a92a2f336a228f32d0/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f3432302f76313630313535393038372f6d6973632f6172676f5f362e706e67\" data-is-external-image=\"true\"  alt=\"argo_6\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_420/v1601559087/misc/argo_6.png\"></a></p>\n<p>Last but not least .... logs are in the UIÂ <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/75169652516669d95b5549e5791198c3a937b5cc/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313535393038372f6d6973632f6172676f5f352e706e67\"><img loading=\"lazy\" title=\"argo_5\" src=\"https://camo.githubusercontent.com/75169652516669d95b5549e5791198c3a937b5cc/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313535393038372f6d6973632f6172676f5f352e706e67\" data-is-external-image=\"true\"  alt=\"argo_5\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_1080/v1601559087/misc/argo_5.png\"></a></p>\n<p><br><br></p>\n<h3><a id=\"user-content-results\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-sitespeed.io#results\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Results</h3>\n<p>We are now able to see the metrics in grafana...</p>\n<p>you have 2 option , what is used in the<br><code>001-argo-job-sitespeedio.yaml</code><br>is theÂ <em>influxdb</em>Â backend that could be rendered using</p>\n<p><a href=\"https://github.com/sitespeedio/grafana-bootstrap-docker/blob/main/dashboards/influxdb/pageSummary.json\">https://github.com/sitespeedio/grafana-bootstrap-docker/blob/main/dashboards/influxdb/pageSummary.json</a></p>\n<p>LIVE VIEWÂ <a href=\"https://services.k8s.it/grafana/d/000000053/pagesummary-influxdb?orgId=2&amp;refresh=15m\" rel=\"nofollow\">https://services.k8s.it/grafana/d/000000053/pagesummary-influxdb?orgId=2&amp;refresh=15m</a></p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/db62aefc87c98b7a8ded25c187d55e255a412a62/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313636313234342f6d6973632f67726166616e615f312e706e67\"><img loading=\"lazy\" title=\"grafana_1\" src=\"https://camo.githubusercontent.com/db62aefc87c98b7a8ded25c187d55e255a412a62/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313636313234342f6d6973632f67726166616e615f312e706e67\" data-is-external-image=\"true\"  alt=\"grafana_1\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_1080/v1601661244/misc/grafana_1.png\"></a></p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/3eebdf9d9e19c08aa1a4f21dfd711c20ecce1c6a/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313636313234332f6d6973632f67726166616e615f322e706e67\"><img loading=\"lazy\" title=\"grafana_2\" src=\"https://camo.githubusercontent.com/3eebdf9d9e19c08aa1a4f21dfd711c20ecce1c6a/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313636313234332f6d6973632f67726166616e615f322e706e67\" data-is-external-image=\"true\"  alt=\"grafana_2\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_1080/v1601661243/misc/grafana_2.png\"></a></p>\n<p>However you can also useÂ <em>graphite</em>Â backend with the same metrics (even more with provided dashboards)</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/cfd27795ad1dfe9a29dd6658313cb044de1b8a80/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313636313832382f6d6973632f67726170686974655f312e706e67\"><img loading=\"lazy\" title=\"graphite_1\" src=\"https://camo.githubusercontent.com/cfd27795ad1dfe9a29dd6658313cb044de1b8a80/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313636313832382f6d6973632f67726170686974655f312e706e67\" data-is-external-image=\"true\"  alt=\"graphite_1\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_1080/v1601661828/misc/graphite_1.png\"></a></p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/f9f4a443bf3d57412c65f77a94bc1eb149ba0d4e/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313636313832382f6d6973632f67726170686974655f322e706e67\"><img loading=\"lazy\" title=\"graphite_2\" src=\"https://camo.githubusercontent.com/f9f4a443bf3d57412c65f77a94bc1eb149ba0d4e/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313636313832382f6d6973632f67726170686974655f322e706e67\" data-is-external-image=\"true\"  alt=\"graphite_2\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_1080/v1601661828/misc/graphite_2.png\"></a></p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/7e56609ce946b33a53517c01bd7ab7e0f5516334/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313636313832382f6d6973632f67726170686974655f332e706e67\"><img loading=\"lazy\" title=\"graphite_3\" src=\"https://camo.githubusercontent.com/7e56609ce946b33a53517c01bd7ab7e0f5516334/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313636313832382f6d6973632f67726170686974655f332e706e67\" data-is-external-image=\"true\"  alt=\"graphite_3\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_1080/v1601661828/misc/graphite_3.png\"></a></p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/c6079d0125e7cc38de67e40345b234313a3bf107/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313636313832392f6d6973632f67726170686974655f342e706e67\"><img loading=\"lazy\" title=\"graphite_4\" src=\"https://camo.githubusercontent.com/c6079d0125e7cc38de67e40345b234313a3bf107/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f635f7363616c652c775f313038302f76313630313636313832392f6d6973632f67726170686974655f342e706e67\" data-is-external-image=\"true\"  alt=\"graphite_4\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/c_scale,w_1080/v1601661829/misc/graphite_4.png\"></a></p>\n<p><br><br><br><br></p>\n<h2><a id=\"user-content-whats-next\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-sitespeed.io#whats-next\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>WHAT'S NEXT</h2>\n<p>Sitespeed is really good to have an high level view but also details that probably could save load time.</p>\n<p>The introduction of Argo can orchestrate multiple checks on all pages/application you need to monitor without a specific crontab time for each job but considering a producer/consumer workflow.</p>",
            "author": {
                "name": "lgirardi"
            },
            "tags": [
                   "workflow",
                   "sitespeed.io",
                   "sitespeed",
                   "observability",
                   "metrics",
                   "kubernetes",
                   "grafana",
                   "customer-view",
                   "argo"
            ],
            "date_published": "2020-10-02T20:41:42+02:00",
            "date_modified": "2020-11-14T22:55:02+01:00"
        },
        {
            "id": "https://www.k8s.it/kubernetes-postfix.html",
            "url": "https://www.k8s.it/kubernetes-postfix.html",
            "title": "Â Kubernetes postfix",
            "summary": "Â Long story short my vps provider changed tha ammount for the small instance from 1$ to 3$ so i took the advantage to switch my postfix service from cloud to onprem. Why, since the world is moving to cloud ? Because my own domain is&hellip;",
            "content_html": "<h1>Â </h1>\n<p>Long story short my vps provider changed tha ammount for the small instance from 1$ to 3$<br>so i took the advantage to switch my postfix service from cloud to onprem.</p>\n<p>Why, since the world is moving to cloud ?<br>Because my own domain is used just for alerting and small other stuff and 3$ month is creazy :)<br>Anyway i'll lost some good stuff like static ip and possibility ti have a ptr dns.<br>Shit happens it's just for my stuff.</p>\n<p>However we have 3 different topics to describe in this project</p>\n<ul>\n<li>what is an email</li>\n<li>postfix configuration</li>\n<li>postfix in kubernetes</li>\n</ul>\n<h2><a id=\"user-content-what-is-an-email\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-postfix#what-is-an-email\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>what is an email</h2>\n<p>send email sometimes is a dedicated work in an enterprise company.<br>There are many aspect to consider , not only infrastructure , like che segmentation of domains strategy,<br>email answer engagement and each isp is using a different threashold to mark your email as a spam,<br>however now we will focus only on the generic configuration with some minimum requirements.</p>\n<p>Here some topic that you probably know:</p>\n<ul>\n<li>TLS (add an encrypted connection in delivery)</li>\n<li>Sender-Id (mostly used for microsoft ecosystem)</li>\n<li>PTR record (used to check the corrispondence of a real smtp)</li>\n<li>SPF record (used on TXT level to define an whitelist of \"smtp allowed to ...\")</li>\n<li>Dkim (a private and public certificate to match the smtp and emails)</li>\n<li>Dmarc (a mix with SPF and Dkim to protect the domain from unauthorized use )</li>\n</ul>\n<h2><a id=\"user-content-postfix-configuration\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-postfix#postfix-configuration\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>postfix configuration</h2>\n<p>The second one is more related to middleware behaviour<br>i have a domain \"example.com\" and i'd like to</p>\n<ul>\n<li>receive email from and to this domain</li>\n<li>have catchall system to do not configure any email account but using everythingÂ <a href=\"mailto:a@example.com\">a@example.com</a>,Â <a href=\"mailto:b@example.com\">b@example.com</a>,Â <a href=\"mailto:whatever@example.com\">whatever@example.com</a></li>\n<li>relay all the emails to my gmail account</li>\n<li>reject the email that are tried to sent outside my chosed domains</li>\n</ul>\n<p>For all those topics the main configuration is in virtual and transport map inÂ <em>postfix</em><br>There are some articles in internet, i'll avoid to reinvent hot water with the explanation.</p>\n<h2><a id=\"user-content-postfix-in-kubernetes\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-postfix#postfix-in-kubernetes\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>postfix in kubernetes</h2>\n<p>just as recap this was the configuration in the cloud vps</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/66d40f312601abf8ba03699a66366d6455c0805f/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313539383336363436332f6d6973632f7670732e706e67\"><img loading=\"lazy\" title=\"vps\" src=\"https://camo.githubusercontent.com/66d40f312601abf8ba03699a66366d6455c0805f/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313539383336363436332f6d6973632f7670732e706e67\" data-is-external-image=\"true\"  alt=\"vps\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/v1598366463/misc/vps.png\"></a></p>\n<p>now i just whitched the MX to my own microk8s lab</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/fd6de4c35300c6596ca2eafcfde2d501bd4c9576/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313539383336363436352f6d6973632f6d6963726f6b38732e706e67\"><img loading=\"lazy\" title=\"microk8s\" src=\"https://camo.githubusercontent.com/fd6de4c35300c6596ca2eafcfde2d501bd4c9576/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313539383336363436352f6d6973632f6d6963726f6b38732e706e67\" data-is-external-image=\"true\"  alt=\"microk8s\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/v1598366465/misc/microk8s.png\"></a></p>\n<p>However , inside the box a lot of implementation way can be taken</p>\n<h3><a id=\"user-content-scenario-1\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-postfix#scenario-1\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Scenario 1:</h3>\n<p>you can build an image for each dedicate purpose</p>\n<ul>\n<li>postfix</li>\n<li>rsyslog</li>\n<li>opendkim</li>\n<li>tls</li>\n</ul>\n<h3><a id=\"user-content-scenario-2\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-postfix#scenario-2\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Scenario 2:</h3>\n<p>looking the configuration adopted inÂ <em>Scenario 1</em>Â , you can add an ingress tcp forward where<br>you can also add a tls layer with cert-manager (the new kube-lego).</p>\n<h3><a id=\"user-content-scenario-3\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-postfix#scenario-3\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Scenario 3:</h3>\n<p><em>Scenario 2</em>Â plus external storage for logs<br>etc etc</p>\n<h3><a id=\"user-content-scenario-lazy\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-postfix#scenario-lazy\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Scenario Lazy:</h3>\n<p>Embedded docker images with all you need with a node port (used only because i have a standalone kubernetes node).</p>\n<p>Well having everything in one single container the docker image reflect the pachage used in a virtual machine</p>\n<pre><code>FROM debian:buster\nMAINTAINER lgirardi &lt;l@k8s.it&gt;\n\nEXPOSE 25/tcp\n\nRUN apt-get -y update &amp;&amp; apt-get -yq install \\\n\tpostfix \\\n\tbsd-mailx \\\n\topendkim \\\n\topendkim-tools \\\n\tsasl2-bin \\\n\trsyslog \\\n        supervisor\n\n\n# Add files\nADD run.sh /opt/run.sh\n\n# Run\nCMD /opt/run.sh;/usr/bin/supervisord -c /etc/supervisor/supervisord.conf\n</code></pre>\n<p>where theÂ <code>run.sh</code>Â is the supervisord daemon managing the process.</p>\n<ul>\n<li>postfix</li>\n<li>rsyslog</li>\n<li>opendkim</li>\n</ul>\n<p>The structure used is done to leave the configuration as a configmap and secrets<br>this will help in case you have to tune your system whiout regenerate the images that honestly make no sense to be build each deploy.</p>\n<p>As you see the deployment files has a huge number of volumes</p>\n<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: postfix\n  namespace: postfix\nspec:\n  replicas: 1\n  strategy:\n    type: RollingUpdate\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      app: postfix\n  template:\n    metadata:\n      labels:\n        app: postfix\n    spec:\n      containers:\n      - name: postfix\n        image: lgirardi/kubernetes-postfix:v0.2\n        lifecycle:\n          postStart:\n            exec:\n              command: [ \"bin/bash\", \"-c\", \"postmap /etc/postfix/virtual &amp;&amp; postmap /etc/postfix/transport &amp;&amp; supervisorctl restart postfix\" ]\n        securityContext:\n          capabilities:\n            add:\n            - NET_ADMIN\n        ports:\n        - name: smtp\n          containerPort: 25\n        volumeMounts:\n        - name: opendkim-key\n          mountPath: /etc/mail/dkim-k8s/keys/YOUR_DOMAIN/YOUR_DOMAIN.private\n          subPath: opendkim-key\n        - name: ca-crt\n          mountPath: /etc/postfix/tls/ca.crt\n          subPath: ca-crt\n        - name: ca-key\n          mountPath: /etc/postfix/tls/ca.key\n          subPath: ca-key\n        - name: postfix-transport\n          mountPath: /etc/postfix/transport\n          subPath: transport\n        - name: postfix-virtual\n          mountPath: /etc/postfix/virtual\n          subPath: virtual\n        - name: postfix-headerchecks\n          mountPath: /etc/postfix/header_checks\n          subPath: header_checks\n        - name: postfix-maincf\n          mountPath: /etc/postfix/main.cf\n          subPath: main.cf\n        - name: postfix-opendkimconf\n          mountPath: /etc/opendkim.conf\n          subPath: opendkim.conf\n        - name: postfix-keytable\n          mountPath: /etc/opendkim/KeyTable\n          subPath: KeyTable\n        - name: postfix-signingtable\n          mountPath: /etc/opendkim/SigningTable\n          subPath: SigningTable\n        - name: postfix-trustedhosts\n          mountPath: /etc/opendkim/TrustedHosts\n          subPath: TrustedHosts\n      volumes:\n        - name: postfix-transport\n          configMap:\n            name: postfix-conf\n            items:\n            - key: transport\n              path: transport\n        - name: postfix-virtual\n          configMap:\n            name: postfix-conf\n            items:\n            - key: virtual\n              path: virtual\n        - name: postfix-headerchecks\n          configMap:\n            name: postfix-conf\n            items:\n            - key: header_checks\n              path: header_checks\n        - name: postfix-maincf\n          configMap:\n            name: postfix-conf\n            items:\n            - key: main.cf\n              path: main.cf\n        - name: postfix-opendkimconf\n          configMap:\n            name: postfix-conf\n            items:\n            - key: opendkim.conf\n              path: opendkim.conf\n        - name: postfix-keytable\n          configMap:\n            name: postfix-conf\n            items:\n            - key: KeyTable\n              path: KeyTable\n        - name: postfix-signingtable\n          configMap:\n            name: postfix-conf\n            items:\n            - key: SigningTable\n              path: SigningTable\n        - name: postfix-trustedhosts\n          configMap:\n            name: postfix-conf\n            items:\n            - key: TrustedHosts\n              path: TrustedHosts\n        - name: opendkim-key\n          secret:\n            secretName: postfix-secret\n        - name: ca-crt\n          secret:\n            secretName: postfix-secret\n        - name: ca-key\n          secret:\n            secretName: postfix-secret\n</code></pre>\n<p>Here we have the configuration for:</p>\n<ul>\n<li>main.cf</li>\n<li>transport</li>\n<li>virtual</li>\n<li>header_checks</li>\n<li>opendkim.conf</li>\n<li>KeyTable</li>\n<li>SigningTable</li>\n<li>TrustedHosts</li>\n</ul>\n<p>You can change this aspect , is mostly related to the infrastructure where you fit the pod<br>and the company CI/CD</p>\n<p><strong>Remember to ADD your right values inside secrets and configmap where you have CAPS likeÂ <code>YOUR_DOMAIN</code></strong></p>\n<p>running theÂ <em>apply</em>Â on kubernetes folder you will have the pod running<br><code>postfix postfix-7d664f786c-rmf54 1/1 Running 0 29m</code></p>\n<p>and loogking the logs i can see</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/694d0f364b26c0474b15921ff1ff8a4135190933/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313539383336393033322f6d6973632f706f73746669786c6f672e706e67\"><img loading=\"lazy\" title=\"postfixlog\" src=\"https://camo.githubusercontent.com/694d0f364b26c0474b15921ff1ff8a4135190933/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313539383336393033322f6d6973632f706f73746669786c6f672e706e67\" data-is-external-image=\"true\"  alt=\"postfixlog\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/v1598369032/misc/postfixlog.png\"></a></p>\n<p>TheÂ <code>key data is not secure</code>Â just a working because i've enabled this option in the configmapÂ <code>RequireSafeKeys false</code><br>but the certificate is appliedÂ <code>opendkim[22]: 91E522A000C: DKIM-Signature field added</code></p>\n<p>Last one is the check on the client side with the righ option enabled</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/66fffe878e76dbeff1853c4abaf19f846af46529/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313539383336383833352f6d6973632f656d61696c6f7074696f6e2e706e67\"><img loading=\"lazy\" title=\"clientemail\" src=\"https://camo.githubusercontent.com/66fffe878e76dbeff1853c4abaf19f846af46529/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313539383336383833352f6d6973632f656d61696c6f7074696f6e2e706e67\" data-is-external-image=\"true\"  alt=\"clientemail\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/v1598368835/misc/emailoption.png\"></a></p>\n<h2><a id=\"user-content-conclusion\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-postfix#conclusion\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Conclusion</h2>\n<p>You can add postfix infrastructure to kubernetes with no problems at all ,<br>this project is aÂ <em>prototype</em>Â , in a production infrastructure you can work around this to let it rock solid and scalable</p>",
            "author": {
                "name": "lgirardi"
            },
            "tags": [
                   "tls",
                   "spf",
                   "postfix",
                   "mail",
                   "kubernetes",
                   "email",
                   "dmarc",
                   "dkim"
            ],
            "date_published": "2020-08-25T18:53:21+02:00",
            "date_modified": "2020-12-27T11:21:23+01:00"
        },
        {
            "id": "https://www.k8s.it/kubernetes-servicemesh.html",
            "url": "https://www.k8s.it/kubernetes-servicemesh.html",
            "title": "Kubernetes servicemesh",
            "summary": "Do we need a service mesh ?few years ago i started to evaluate this feature fitting in an existing infrastructure There are many concept to consider and many mistake the people usually think Better to start with what isÂ NOTÂ a work for a service mesh So&hellip;",
            "content_html": "<h2>Do we need a service mesh ?</h2>\n<p>few years ago i started to evaluate this feature fitting in an existing infrastructure</p>\n<p>There are many concept to consider and many mistake the people usually think<br>Better to start with what isÂ <em>NOT</em>Â a work for a service mesh</p>\n<ul>\n<li>is not an apigw (even if could share some components)</li>\n<li>is not the place to put firewall rules</li>\n<li>is not something magic that boost the applications</li>\n<li>is something that if not used with a know scope could generate a mess</li>\n</ul>\n<p>So what is ...<br>well short answer</p>\n<ul>\n<li>is the missing link in the infrastructure observability</li>\n<li>is a way to handle in a structured way the application routing</li>\n<li>is an internal ratelimit / anti ddos / infrastructure layer (be careful)</li>\n<li>could be a clever way to improve some application limits (expanded next)</li>\n</ul>\n<p>Anyway is this something that we can add in our infrastructure ?</p>\n<p>There no YES/NO , however we can evaluate the company and the maturity of microservices<br>internal rate limit , is usually a feature that could safe the infrastructure during snowball effects<br>however means that if the infrastructure is SYNC (no decoupling) have the rate limit can just<br>stop the application to serve requests , and this will propagated to the others below.</p>\n<p>result: no answer<br>threads safe</p>\n<p>Sometimes it's better to have a strategic business login using the a circuit breaker that bring a huge complexity in configuration.</p>\n<p>The other point related to rate limit is .. who will maintain those values ?<br>Should be part of deployment pipeline and directly correlated with the application scope<br>In a 200+ micro services infrastructure this could be a huge problem:</p>\n<ul>\n<li>project that lost ownership</li>\n<li>projects not well maintained</li>\n<li>new legacy projects</li>\n</ul>\n<p>So my idea about rate limit is to use it in a specific \"strategic\" applications and should not indiscriminately added to the whole infrastructure</p>\n<p>About the routing feature, we can consider as a more detailed and customized blue green deployment , this specific case it's really useful when we have to deploy new features in production andÂ <em>canary</em>Â deployment is not enough to cover the business measurement we need.</p>\n<p>This feature could be used to keep a specific affinity within the microservices and this is the real feature that some of you can consider, imagine a strict dependencies between application an cache (as usual)<br>So the applicationÂ <em>Pippo</em>Â is using the cacheÂ <em>Paperino</em></p>\n<p>Pippo is a namespace composed by 10 pods<br>Paperino is a cache composed by 6 pods</p>\n<p>Imagine that we have the cache as a replication/sharded and we have 2 availability zones</p>\n<p>With service mesh we can use labels to say to Pippo to use the cache Paperino only in the availability zone where the call start from Pippo av, this will reduce dramatically the roundtrip and the answer</p>\n<p>I played a bit with service mesh in order to answer some questions,<br>however related to firewall rules the right answer is Cilium :-)</p>\n<p>With this, I'd like to say that service mash give you a great value only<br>if your infrastructure is able to embrace it and only if you know what you are doing with this infrastructure.</p>\n<ul>\n<li>observability</li>\n<li>routing purpose (this is strictly related to the microservice architecture)</li>\n<li>rate limitng</li>\n</ul>\n<h2><a id=\"user-content-service-mesh-sample-lab\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-servicemesh#service-mesh-sample-lab\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Service Mesh sample lab</h2>\n<p>This lab is provided to discover and test the functionality w'd like to implement in our environment</p>\n<h3><a id=\"user-content-basic-setup\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-servicemesh#basic-setup\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Basic setup</h3>\n<ul>\n<li>minikube v1.6.2</li>\n<li>Kubernetes v1.17.0 on Docker '19.03.5'</li>\n</ul>\n<p><code>curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64</code>Â <code>chmod +x minikube</code><br><code>sudo install minikube /usr/local/bin/</code><br><code>minikube start --memory=3000 --cpus=3</code></p>\n<ul>\n<li>network (since in production we are using flannel that is not able to manage network policy we can start using no CNI to have the environment as much as close to lmn environment)</li>\n</ul>\n<h4><a id=\"user-content-namespaces\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-servicemesh#namespaces\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Namespaces</h4>\n<p>a â†’ traefik (ingress)<br>b â†’ apache<br>c â†’ application<br>d â†’ redis</p>\n<p>b is a namespaces that manage an apache used for some rewrite rules<br>c is a python application that is connected to a redis database, provide some function to set a time, get a time with /set context and /get context<br>d is the redis database</p>\n<p>c code</p>\n<pre><code>\"\"\"\n    Example app that integrates with redis and save/get timing\n\"\"\"\nfrom os import environ\nfrom datetime import datetime\nimport json\nimport redis\nfrom flask import Flask, redirect\n\nVERSION = \"1.1.1\"\nREDIS_ENDPOINT = environ.get(\"REDIS_ENDPOINT\", \"redis-svc.d-redis.svc.cluster.local\")\nREDIS_PORT = int(environ.get(\"REDIS_PORT\", \"6379\"))\n\n\nAPP = Flask(__name__)\n\n\n@APP.route(\"/\")\ndef redisapp():\n    \"\"\"Main redirect\"\"\"\n    return redirect(\"/get\", code=302)\n\n\n@APP.route(\"/set\")\ndef set_var():\n    \"\"\"Set the time\"\"\"\n    red = redis.StrictRedis(host=REDIS_ENDPOINT, port=REDIS_PORT, db=0)\n    red.set(\"time\", str(datetime.now()))\n    return json.dumps({\"time\": str(red.get(\"time\"))})\n\n\n@APP.route(\"/get\")\ndef get_var():\n    \"\"\"Get the time\"\"\"\n    red = redis.StrictRedis(host=REDIS_ENDPOINT, port=REDIS_PORT, db=0)\n    return json.dumps({\"time\": str(red.get(\"time\"))})\n\n\n@APP.route(\"/reset\")\ndef reset():\n    \"\"\"Reset the time\"\"\"\n    red = redis.StrictRedis(host=REDIS_ENDPOINT, port=REDIS_PORT, db=0)\n    red.delete(\"time\")\n    return json.dumps({\"time\": str(red.get(\"time\"))})\n\n\n@APP.route(\"/version\")\ndef version():\n    \"\"\"Get the app version\"\"\"\n    return json.dumps({\"version\": VERSION})\n\n\n@APP.route(\"/healthz\")\ndef health():\n    \"\"\"Check the app health\"\"\"\n    try:\n        red = redis.StrictRedis(host=REDIS_ENDPOINT, port=REDIS_PORT, db=0)\n        red.ping()\n    except redis.exceptions.ConnectionError:\n        return json.dumps({\"ping\": \"FAIL\"})\n\n    return json.dumps({\"ping\": red.ping()})\n\n\n@APP.route(\"/readyz\")\ndef ready():\n    \"\"\"Check the app readiness\"\"\"\n    return health()\n\n\nif __name__ == \"__main__\":\n    APP.run(debug=True, host=\"0.0.0.0\")\n</code></pre>\n<p>Dokerfile</p>\n<pre><code>FROM python:3.6-alpine\nCOPY . /app\nWORKDIR /app\nRUN pip install -r requirements.txt\nENTRYPOINT [\"python\"]\nCMD [\"app.py\"]\n</code></pre>\n<p>requirements.txt</p>\n<pre><code>Flask\nredis\npytest\npytest-flask\n</code></pre>\n<h3><a id=\"user-content-folders-structure\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-servicemesh#folders-structure\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Folders structure</h3>\n<pre><code>kubernetes/\nâ”œâ”€â”€ 00-traefik\nâ”‚Â Â  â”œâ”€â”€ A-00-traefik-ns.yaml\nâ”‚Â Â  â”œâ”€â”€ A-01-traefik-rbac.yaml\nâ”‚Â Â  â””â”€â”€ A-02-traefik-ds.yaml\nâ”œâ”€â”€ 01-apache\nâ”‚Â Â  â”œâ”€â”€ B-00-k8s-apacherr-ns.yaml\nâ”‚Â Â  â”œâ”€â”€ B-01-k8s-apacherr-svc.yaml\nâ”‚Â Â  â”œâ”€â”€ B-02-k8s-apacherr-ing.yaml\nâ”‚Â Â  â”œâ”€â”€ B-03-k8s-apacherr-dpl.yaml\nâ”‚Â Â  â””â”€â”€ B-04-k8s-apacherr-cfm.yaml\nâ”œâ”€â”€ 02-redis\nâ”‚Â Â  â”œâ”€â”€ D-00-lab-redis-ns.yaml\nâ”‚Â Â  â”œâ”€â”€ D-01-lab-redis-svc.yaml\nâ”‚Â Â  â””â”€â”€ D-02-lab-redis-dpl.yaml\nâ””â”€â”€ 03-app\n    â”œâ”€â”€ C-00-app-ns.yaml\n    â”œâ”€â”€ C-01-app-svc.yaml\n    â””â”€â”€ C-02-app-dpl.yaml\n</code></pre>\n<h3><a id=\"user-content-startup\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-servicemesh#startup\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Startup</h3>\n<p>kubernetes$ kubectl apply -f 00-traefik/</p>\n<pre><code>namespace/a-ingress-traefik created  \nclusterrole.rbac.authorization.k8s.io/traefik-ingress-controller created    \nserviceaccount/traefik-ingress-controller created  \nclusterrolebinding.rbac.authorization.k8s.io/traefik-ingress-controller created\nserviceaccount/traefik-ingress-controller created\ndaemonset.apps/traefik-ingress-controller created\nservice/traefik-ingress-service created\n</code></pre>\n<p>kubernetes$ kubectl apply -f 01-apache/</p>\n<pre><code>namespace/b-apacherr created\nservice/apacherr-svc created\ningress.extensions/apacherr-ingress created\ndeployment.apps/apacherr created\nconfigmap/apacherr-80-config created\n</code></pre>\n<p>kubernetes$ kubectl apply -f 02-redis/</p>\n<pre><code>namespace/d-redis created\nservice/redis-svc created\ndeployment.apps/redis created\n</code></pre>\n<p>kubernetes$ kubectl apply -f 03-app/</p>\n<pre><code>namespace/c-app-count created    \nservice/app-count-svc created  \ndeployment.apps/pythonapp created  \n</code></pre>\n<p>kubectl get po --all-namespaces</p>\n<pre><code>NAMESPACE           NAME                               READY   STATUS    RESTARTS   AGE\na-ingress-traefik   traefik-ingress-controller-jkppg   1/1     Running   0          5m29s\nb-apacherr          apacherr-8b786b45d-g9vcl           1/1     Running   0          5m19s\nc-app-count         pythonapp-555d6d88cd-slhfb         1/1     Running   0          4m55s\nd-redis             redis-b869b89d-pf6ms               1/1     Running   0          5m12s\nkube-system         coredns-6955765f44-6nrdr           1/1     Running   1          74m\nkube-system         coredns-6955765f44-9fbgt           1/1     Running   1          74m\nkube-system         etcd-minikube                      1/1     Running   1          74m\nkube-system         kube-addon-manager-minikube        1/1     Running   1          74m\nkube-system         kube-apiserver-minikube            1/1     Running   1          74m\nkube-system         kube-controller-manager-minikube   1/1     Running   1          74m\nkube-system         kube-proxy-cchls                   1/1     Running   1          74m\nkube-system         kube-scheduler-minikube            1/1     Running   1          74m\nkube-system         storage-provisioner                1/1     Running   2          74m\n</code></pre>\n<p>make sure virtualbox 8081 port should be available</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/f303afac85505ee6e02651c55518f1eb809a6f97/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313539343537333731352f6d6973632f696d675f7669727475616c626f782d706f7274666f7277617264696e672e706e67\"><img loading=\"lazy\" title=\"Virtualbox port forwarding\" src=\"https://camo.githubusercontent.com/f303afac85505ee6e02651c55518f1eb809a6f97/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313539343537333731352f6d6973632f696d675f7669727475616c626f782d706f7274666f7277617264696e672e706e67\" data-is-external-image=\"true\"  alt=\"Virtualbox port forwarding\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/v1594573715/misc/img_virtualbox-portforwarding.png\"></a></p>\n<h2><a id=\"user-content-flow\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-servicemesh#flow\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>flow</h2>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/70a420864968278b8940023ba6aa95dd7bf932a6/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313539343537333731342f6d6973632f696d675f666c6f772e706e67\"><img loading=\"lazy\" title=\"flow\" src=\"https://camo.githubusercontent.com/70a420864968278b8940023ba6aa95dd7bf932a6/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313539343537333731342f6d6973632f696d675f666c6f772e706e67\" data-is-external-image=\"true\"  alt=\"flow\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/v1594573714/misc/img_flow.png\"></a></p>\n<h5><a id=\"user-content-inizialize-the-redis-database\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-servicemesh#inizialize-the-redis-database\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>inizialize the redis database</h5>\n<p><code>$ curl http://pippo.lan/count/set</code><br>{\"time\": \"b'2019-12-28 20:06:33.919059'\"}</p>\n<h5><a id=\"user-content-test-from-apache-to-application-case-1\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-servicemesh#test-from-apache-to-application-case-1\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>test from apache to application (case 1)</h5>\n<p><code>$ curl http://pippo.lan/count/get</code><br>{\"time\": \"b'2019-12-28 20:06:33.919059'\"}</p>\n<h5><a id=\"user-content-test-from-apache-to-redis-case-2\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-servicemesh#test-from-apache-to-redis-case-2\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>test from apache to redis (case 2)</h5>\n<p><code>$ curl http://pippo.lan/redis/GET/time</code><br>{\"GET\":\"2019-12-28 20:06:33.919059\"}</p>\n<h5><a id=\"user-content-network-rule-example\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-servicemesh#network-rule-example\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>network rule example</h5>\n<p>cilium labels</p>\n<pre><code>ENDPOINT   POLICY (ingress)   POLICY (egress)   IDENTITY   LABELS (source:key[=value])                           IPv6   IPv4            STATUS   \n           ENFORCEMENT        ENFORCEMENT                                                                                               \n201        Disabled           Disabled          32580      k8s:app=redis                                                10.15.182.193   ready   \n                                                           k8s:io.cilium.k8s.namespace.labels.name=d-redis                                      \n                                                           k8s:io.cilium.k8s.policy.cluster=default                                             \n                                                           k8s:io.cilium.k8s.policy.serviceaccount=default                                      \n                                                           k8s:io.kubernetes.pod.namespace=d-redis                                              \n                                                           k8s:track=redis                                                                      \n1257       Disabled           Disabled          4          reserved:health                                              10.15.197.106   ready   \n1663       Disabled           Disabled          54130      k8s:app=apacherr                                             10.15.192.41    ready   \n                                                           k8s:io.cilium.k8s.namespace.labels.name=b-apacherr                                   \n                                                           k8s:io.cilium.k8s.policy.cluster=default                                             \n                                                           k8s:io.cilium.k8s.policy.serviceaccount=default                                      \n                                                           k8s:io.kubernetes.pod.namespace=b-apacherr                                           \n3167       Disabled           Disabled          33702      k8s:app=pythonapp                                            10.15.247.186   ready   \n                                                           k8s:io.cilium.k8s.namespace.labels.name=c-app-count                                  \n                                                           k8s:io.cilium.k8s.namespace.labels.purpose=app                                       \n                                                           k8s:io.cilium.k8s.policy.cluster=default                                             \n                                                           k8s:io.cilium.k8s.policy.serviceaccount=default                                      \n                                                           k8s:io.kubernetes.pod.namespace=c-app-count                                          \n                                                           k8s:track=pythonapp-stable         \n</code></pre>\n<p>network rule</p>\n<pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: isolate-namespace\n  namespace: d-redis\nspec:\n  podSelector: {}\n  policyTypes:\n  - Ingress\n  - Egress\n  ingress:\n  - from:\n    - namespaceSelector:\n        matchLabels:\n          name: c-app-count\n  egress:\n  - to:\n    - namespaceSelector:\n        matchLabels:\n          name: c-app-count\n\n</code></pre>\n<p>Â  Â </p>\n<p>cilium/hubbleÂ <a href=\"https://github.com/cilium/hubble\">https://github.com/cilium/hubble</a>Â <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/70234ad4768db6537d28a417f0e73061ce2e51b4/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313539343537343036392f6d6973632f687562626c652d64726f702e706e67\"><img loading=\"lazy\" title=\"hubble\" src=\"https://camo.githubusercontent.com/70234ad4768db6537d28a417f0e73061ce2e51b4/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313539343537343036392f6d6973632f687562626c652d64726f702e706e67\" data-is-external-image=\"true\"  alt=\"hubble\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/v1594574069/misc/hubble-drop.png\"></a></p>\n<p>Â </p>\n<p>istio/kialiÂ <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/79a5b07227e5651705810596cef972d074ed201f/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313539343537343036392f6d6973632f697374696f2d6b69616c692e706e67\"><img loading=\"lazy\" title=\"kiali\" src=\"https://camo.githubusercontent.com/79a5b07227e5651705810596cef972d074ed201f/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f6574687a65726f2f696d6167652f75706c6f61642f76313539343537343036392f6d6973632f697374696f2d6b69616c692e706e67\" data-is-external-image=\"true\"  alt=\"kiali\" data-canonical-src=\"https://res.cloudinary.com/ethzero/image/upload/v1594574069/misc/istio-kiali.png\"></a></p>\n<p>Â </p>\n<p>video Cilium example --&gt;Â <a href=\"https://res.cloudinary.com/ethzero/video/upload/v1594574074/misc/cilium.mkv\" rel=\"nofollow\">img/cilium.mkv</a></p>\n<p>video Istio + Cilium example --&gt;Â <a href=\"https://res.cloudinary.com/ethzero/video/upload/v1594574090/misc/istio.mkv\" rel=\"nofollow\">img/istio.mkv</a><br>Â </p>\n<h2><a id=\"user-content-requirements\" class=\"anchor\" aria-hidden=\"true\" href=\"https://github.com/lorenzogirardi/kubernetes-servicemesh#requirements\"><svg class=\"octicon octicon-link\" viewbox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>requirements</h2>\n<ul>\n<li>use service mesh to segregate redis \"d\" to accept connections only from application \"c\"<br>expected \"case 1\" still working, \"case 2\" stop working and receive an error</li>\n</ul>",
            "author": {
                "name": "lgirardi"
            },
            "tags": [
                   "service mesh",
                   "rate limit",
                   "observability",
                   "metrics",
                   "linkerd",
                   "kubernetes",
                   "kiali",
                   "istio",
                   "cilium",
                   "api"
            ],
            "date_published": "2020-08-11T20:50:36+02:00",
            "date_modified": "2020-11-14T22:55:12+01:00"
        }
    ]
}
